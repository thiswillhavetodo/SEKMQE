function Typewriter(){function c(c,d){b=c,a.time=d.time||Phaser.Timer.SECOND/10,a.sound=d.sound||null,a.soundMarker=d.soundMarker||null,a.writerFn=d.writerFn||null,a.endFn=d.endFn||null,a.times=d.times||10,a.text=d.text||"",a.x=d.x||100,a.y=d.y||100,a.maxWidth=d.maxWidth||200,a.fontFamily=d.fontFamily||"blackFont",a.fontSize=d.fontSize||28,a.writerObj=d.writerObj||null}function d(){f(a.text,a.x,a.y)}function e(){void 0!==a.timer&&(a.timer.stop(),b.time.events.remove(a.timer)),null!==a.sound&&a.sound.stop()}function f(c,d,e){null===a.writerObj?a.typedText=b.add.bitmapText(d,e,a.fontFamily,c,a.fontSize):a.typedText=a.writerObj,a.typedText.maxWidth=a.maxWidth,a.currentLetter=0;for(var f=a.typedText.children.length,i=0;i<f;i++){var j=a.typedText.getChildAt(i);j.alpha=0}null!==a.sound&&(null!==a.soundMarker?a.sound.play(a.soundMarker,null,1,!0,!0):a.sound.play("",null,1,!0,!0)),a.typedText.x=d,a.typedText.y=e,null!==a.endFn?g(h,f,a.endFn):g(h,f)}function g(c,d,e){var f=b.time.create(!1);f.start(),e=e||function(){b.time.events.remove(f),null!==a.sound&&a.sound.stop()},f.onComplete.add(e),f.repeat(a.time,d,c,this),a.timer=f}function h(b){null!==a.sound&&a.sound.isPlaying===!1&&a.sound.play();var c=a.typedText.getChildAt(a.currentLetter);c.alpha=1,a.currentLetter++}this.typedText,this.timer,this.pickedQuote;var b,a=this;return{init:function(a,b){c(a,b)},start:function(){e(),d()},destroy:function(){a.typedText.destroy()},hideText:function(){a.typedText.visible=!1},showText:function(){a.typedText.visible=!0},moveToTop:function(){b.bringToTop(a.typedText)},scroll:function(){a.typedText.y-=.5}}}var titlePlayer,themeSound,currentTimeHolder,previousTime,weaponsmithTimerHolder,wandTimerHolder,shieldTimerHolder,armourerTimerHolder,armourTimerHolder,hatTimerHolder,bootTimerHolder,enchanterTimerHolder,ringTimerHolder,amuletTimerHolder,trainerTimerHolder,enduranceTimerHolder,skillTimerHolder,weaponsmithAdTimerHolder,armourerAdTimerHolder,enchanterAdTimerHolder,trainerAdTimerHolder,menuBackground,loggedIn=!1,menuState={create:function(){menuBackground=game.add.sprite(0,0,"menuBackground"),menuBackground.scale.x=.356,menuBackground.scale.y=.376;game.add.button(0,0,"creditsButton",this.credits,this),game.add.button(210,420,"startButton",this.start,this),game.add.button(450,420,"loadButton",this.loadSave,this);themeSound=game.add.audio("titleTheme"),themeSound.play()},start:function(){game.world.removeAll(),game.device.desktop||(game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,canvasElement.style.top="0vh"),game.state.start("intro"),themeSound.stop()},credits:function(){game.world.removeAll(),game.state.start("credits"),themeSound.stop()},loadSave:function(){var a;for(console.log("local storage"),a=0;a<localStorage.length;a++)console.log(localStorage.key(a)+"=["+localStorage.getItem(localStorage.key(a))+"]");var b=localStorage.getItem("save");saveObject=JSON.parse(b),previousTime=saveObject.time,playerLevel=saveObject.playerLevel,bulletSpacing=saveObject.bulletSpacing,invulnerableSpacing=saveObject.invulnerableSpacing,shotSpeed=saveObject.shotSpeed,manaRegenHolder=saveObject.manaRegenHolder,bossZombieKilled=saveObject.bossZombieKilled,bossTreeBeastKilled=saveObject.bossTreeBeastKilled,bossSkeletonKilled=saveObject.bossSkeletonKilled,bossZombieBirdKilled=saveObject.bossZombieBirdKilled,bossMummyKilled=saveObject.bossMummyKilled,coins=saveObject.coins,stage=saveObject.stage,bestStage=saveObject.bestStage,xp=saveObject.xp,nextLevelXp=saveObject.nextLevelXp,maxHealth=saveObject.maxHealth,maxMana=saveObject.maxMana,shotPower=saveObject.shotPower,knockback=saveObject.knockback,runSpeed=saveObject.runSpeed,currentTimeHolder=saveObject.currentTime,currentTime=currentTimeHolder-previousTime,year=saveObject.year,population=saveObject.population,happiness=saveObject.happiness,popScore=saveObject.popScore,housing=saveObject.housing,commercial=saveObject.commercial,industrial=saveObject.industrial,education=saveObject.education,popHealth=saveObject.popHealth,justice=saveObject.justice,defence=saveObject.defence,utilities=saveObject.utilities,weaponsmith=saveObject.weaponsmith,armourer=saveObject.armourer,enchanter=saveObject.enchanter,trainer=saveObject.trainer,tax=saveObject.tax,income=saveObject.income,expenditure=saveObject.expenditure,totalFunding=saveObject.totalFunding,netIncome=saveObject.netIncome,defending=saveObject.defending,defenceChance=saveObject.defenceChance,assistant=saveObject.assistant,tutorial=saveObject.tutorial,tutorialDefence=saveObject.tutorialDefence,first=saveObject.first,housingFunding=saveObject.housingFunding,commercialFunding=saveObject.commercialFunding,industrialFunding=saveObject.industrialFunding,educationFunding=saveObject.educationFunding,healthFunding=saveObject.healthFunding,justiceFunding=saveObject.justiceFunding,defenceFunding=saveObject.defenceFunding,utilitiesFunding=saveObject.utilitiesFunding,weaponsmithFunding=saveObject.weaponsmithFunding,armourerFunding=saveObject.armourerFunding,enchanterFunding=saveObject.enchanterFunding,trainerFunding=saveObject.trainerFunding,averageFunding=saveObject.averageFunding,weaponsmithDropReward=saveObject.weaponsmithDropReward,weaponsmithTimerHolder=saveObject.weaponsmithTimer,weaponsmithTimer=weaponsmithTimerHolder-previousTime,wandTimerHolder=saveObject.wandTimer,wandTimer=wandTimerHolder-previousTime,wandShotPower=saveObject.wandShotPower,wandShotSpeed=saveObject.wandShotSpeed,wandBulletSpacing=saveObject.wandBulletSpacing,shieldTimerHolder=saveObject.shieldTimer,shieldTimer=shieldTimerHolder-previousTime,shieldKnockback=saveObject.shieldKnockback,shieldMaxHealth=saveObject.shieldMaxHealth,shieldInvulnerableSpacing=saveObject.shieldInvulnerableSpacing,armourerDropReward=saveObject.armourerDropReward,armourerTimerHolder=saveObject.armourerTimer,armourerTimer=armourerTimerHolder-previousTime,armourTimerHolder=saveObject.armourTimer,armourTimer=armourTimerHolder-previousTime,armourMaxHealth=saveObject.armourMaxHealth,armourManaRegenInterval=saveObject.armourManaRegenInterval,armourInvulnerableSpacing=saveObject.armourInvulnerableSpacing,hatTimerHolder=saveObject.hatTimer,hatTimer=hatTimerHolder-previousTime,hatMaxHealth=saveObject.hatMaxHealth,hatManaRegenInterval=saveObject.hatManaRegenInterval,hatMaxMana=saveObject.hatMaxMana,bootTimerHolder=saveObject.bootTimer,bootTimer=bootTimerHolder-previousTime,bootRunSpeed=saveObject.bootRunSpeed,bootManaRegenInterval=saveObject.bootManaRegenInterval,bootInvulnerableSpacing=saveObject.bootInvulnerableSpacing,enchanterDropReward=saveObject.enchanterDropReward,enchanterTimerHolder=saveObject.enchanterTimer,enchanterTimer=enchanterTimerHolder-previousTime,ringTimerHolder=saveObject.ringTimer,ringTimer=ringTimerHolder-previousTime,ringShotPower=saveObject.ringShotPower,ringMaxMana=saveObject.ringMaxMana,ringKnockback=saveObject.ringKnockback,amuletTimerHolder=saveObject.amuletTimer,amuletTimer=amuletTimerHolder-previousTime,amuletRunSpeed=saveObject.amuletRunSpeed,amuletShotSpeed=saveObject.amuletShotSpeed,amuletBulletSpacing=saveObject.amuletBulletSpacing,trainerDropReward=saveObject.trainerDropReward,trainerTimerHolder=saveObject.trainerTimer,trainerTimer=trainerTimerHolder-previousTime,skillTimerHolder=saveObject.skillTimer,skillTimer=skillTimerHolder-previousTime,skillShotPower=saveObject.skillShotPower,skillMaxMana=saveObject.skillMaxMana,skillKnockback=saveObject.skillKnockback,enduranceTimerHolder=saveObject.enduranceTimer,enduranceTimer=enduranceTimerHolder-previousTime,enduranceRunSpeed=saveObject.enduranceRunSpeed,enduranceShotSpeed=saveObject.enduranceShotSpeed,enduranceBulletSpacing=saveObject.enduranceBulletSpacing,attackStrength=saveObject.attackStrength,tutorialDefence=saveObject.tutorialDefence,weaponsmithUpgradeCost=saveObject.weaponsmithUpgradeCost,armourerUpgradeCost=saveObject.armourerUpgradeCost,enchanterUpgradeCost=saveObject.enchanterUpgradeCost,trainerUpgradeCost=saveObject.trainerUpgradeCost,previousPopulation=saveObject.previousPopulation,previousEconomyMod=saveObject.previousEconomyMod,previousIncome=saveObject.previousIncome,previousExpenditure=saveObject.previousExpenditure,previousNetIncome=saveObject.previousNetIncome,previousCoins=saveObject.previousCoins,startingGoldIncrease=saveObject.startingGoldIncrease,startingPopIncrease=saveObject.startingPopIncrease,deptEffectIncrease=saveObject.deptEffectIncrease,beamUnlockShown=saveObject.beamUnlockShown,manaRefillUnlockShown=saveObject.manaRefillUnlockShown,weaponsmithAdTimerHolder=saveObject.weaponsmithAdTimer,armourerAdTimerHolder=saveObject.armourerAdTimer,enchanterAdTimerHolder=saveObject.enchanterAdTimer,trainerAdTimerHolder=saveObject.trainerAdTimer,weaponsmithAdTimer=weaponsmithAdTimerHolder-previousTime,armourerAdTimer=armourerAdTimerHolder-previousTime,enchanterAdTimer=enchanterAdTimerHolder-previousTime,trainerAdTimer=trainerAdTimerHolder-previousTime,null!=saveObject.baddieAdjuster?(baddieAdjuster=saveObject.baddieAdjuster,baddieDamageAdjuster=saveObject.baddieDamageAdjuster,baddieHpAdjuster=saveObject.baddieHpAdjuster,baddieXpAdjuster=saveObject.baddieXpAdjuster,baddieSpeedAdjuster=saveObject.baddieSpeedAdjuster):(baddieAdjuster=0,baddieDamageAdjuster=1,baddieHpAdjuster=1,baddieXpAdjuster=1,baddieSpeedAdjuster=1),null!=saveObject.stageMilestone?(stageMilestone=saveObject.stageMilestone,bossFinalKilled=saveObject.bossFinalKilled):(stageMilestone=100*Math.floor(bestStage/100),bossFinalKilled=!1),null!=saveObject.weaponsmithPerkAnnounced?(weaponsmithPerkAnnounced=saveObject.weaponsmithPerkAnnounced,armourerPerkAnnounced=saveObject.armourerPerkAnnounced,enchanterPerkAnnounced=saveObject.enchanterPerkAnnounced,trainerPerkAnnounced=saveObject.trainerPerkAnnounced):(weaponsmithPerkAnnounced=!1,armourerPerkAnnounced=!1,enchanterPerkAnnounced=!1,trainerPerkAnnounced=!1),null!=saveObject.troopNumber?(saveObject.troopNumber=troopNumber,saveObject.previousTroopNumber=previousTroopNumber,saveObject.previousHappiness=previousHappiness):(saveObject.troopNumber=Math.round(defence/4),saveObject.previousTroopNumber=Math.round(defence/4),saveObject.previousHappiness=44),game.world.removeAll(),game.device.desktop||(game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,canvasElement.style.top="0vh"),game.state.start("city"),themeSound.stop()}},preloadState={preload:function(){game.preloadBar=game.add.sprite(game.world.centerX-64,game.world.centerY+128,"preloadBar"),game.preloadBar.anchor.setTo(0),game.load.setPreloadSprite(game.preloadBar),game.load.audio("pew","assets/laserfire01.ogg"),game.load.audio("collect","assets/itemCollect.ogg"),game.load.audio("reduce","assets/reduceFunds.ogg"),game.load.audio("slotMachine","assets/slotMachine.ogg"),game.load.audio("shortExplode","assets/shorter-explosion.ogg"),game.load.audio("flameShot","assets/flameShot.ogg"),game.load.audio("sizzle","assets/sizzle.ogg"),game.load.audio("skeletonDeath","assets/skeletonDeath.ogg"),game.load.audio("maleDeath","assets/maleDeath.ogg"),game.load.audio("femaleDeath","assets/femaleDeath.ogg"),game.load.audio("spiderDeath","assets/spiderDeath.ogg"),game.load.audio("mummyDeath","assets/mummyDeath.ogg"),game.load.audio("grunt","assets/grunt.ogg"),game.load.audio("zombieRising","assets/mnstr9.ogg"),game.load.audio("birdDeath","assets/birdDeath.ogg"),game.load.audio("zombieDeath","assets/zombieDeath.ogg"),game.load.audio("woodSmash","assets/woodSmash.ogg"),game.load.audio("teleport","assets/teleport.ogg"),game.load.audio("levelUpSound","assets/Accept.ogg"),game.load.audio("titleTheme","assets/titleTheme.ogg"),game.load.audio("bubble","assets/bubbles.ogg"),game.load.audio("creakylightwoodendoor1","assets/creakylightwoodendoor1.ogg"),game.load.audio("shotSFX","assets/shotSFX.ogg"),game.load.audio("swampCreatureDeath","assets/swampCreatureDeath.ogg"),game.load.audio("defence","assets/Tower-Defense.ogg"),game.load.audio("forestMusic","assets/Fantasy-Forest-Battle.ogg"),game.load.audio("ruinsMusic","assets/Ominous_Goings-On.ogg"),game.load.audio("wastelandMusic","assets/The-Castle-Beyond-the-Forest.ogg"),game.load.audio("introCreditsMusic","assets/Fantasy_Game_Background.ogg"),game.load.audio("tutorialMusic","assets/Left-Behind.ogg"),game.load.audio("cityMusic","assets/Our_Mountain_v003.ogg"),game.load.image("rock","assets/boulder.png"),game.load.image("tree","assets/Tree.png"),game.load.image("treeShadow","assets/treeShadow.png"),game.load.image("field","assets/wasteland.png"),game.load.image("gravestone","assets/gravestone.png"),game.load.image("ChestRed","assets/ChestRed.png"),game.load.image("ChestBlue","assets/ChestBlue.png"),game.load.image("ChestYellow","assets/ChestYellow.png"),game.load.image("ChestGreen","assets/ChestGreen.png"),game.load.spritesheet("iceBeamMini","assets/lightning.png",64,32),game.load.image("doorway","assets/doorway.png"),game.load.image("stonepaving","assets/stonepaving.png"),game.load.image("HousingDpt","assets/HousingDpt.png"),game.load.image("CommerceDpt","assets/CommerceDpt.png"),game.load.image("IndustryDpt","assets/IndustryDpt.png"),game.load.image("EducationDpt","assets/EducationDpt.png"),game.load.image("HealthDpt","assets/HealthDpt.png"),game.load.image("JusticeDpt","assets/JusticeDpt.png"),game.load.image("DefenceDpt","assets/DefenceDpt.png"),game.load.image("UtilitiesDpt","assets/UtilitiesDpt.png"),game.load.image("weaponsmith","assets/weaponsmith.png"),game.load.image("armourer","assets/armourer.png"),game.load.image("enchanter","assets/enchanter.png"),game.load.image("trainer","assets/trainer.png"),game.load.image("castle","assets/castle.png"),game.load.image("deptHighlight","assets/deptHighlight.png"),game.load.image("shopBackground","assets/shopBackground.png"),game.load.spritesheet("animateddoor","assets/animateddoor.png",63.5,72),game.load.spritesheet("zombieBird","assets/zombieBird.png",82,62),game.load.spritesheet("miniZombieBird","assets/miniZombieBird.png",16,13),game.load.spritesheet("blueCharge","assets/blueCharge.png",16,16),game.load.spritesheet("evilWizard","assets/evilWizard.png",32,36),game.load.spritesheet("coin","assets/coin.png",26,26),game.load.spritesheet("bullet","assets/bullet1.png",16,16),game.load.spritesheet("bulletParticles","assets/bulletParticles.png",12,12),game.load.spritesheet("explosionMini","assets/explosionMini.png",16,16),game.load.spritesheet("levelUp","assets/levelUp.png",570,80),game.load.spritesheet("spider","assets/spiderGreen.png",32,32),game.load.spritesheet("controlLeftRight","assets/controlLeftRight79x49.png",79,49),game.load.spritesheet("controlUpDown","assets/controlUpDown49x79.png",49,79),game.load.image("menuBackground","assets/titlescreeenArtwork.png"),game.load.image("startButton","assets/START.png"),game.load.image("loadButton","assets/LOAD.png"),game.load.image("creditsButton","assets/CREDITS.png"),game.load.image("blankButton","assets/blankButton.png"),game.load.image("plusButton","assets/plusButton.png"),game.load.image("minusButton","assets/minusButton.png"),game.load.image("questButton","assets/QUEST-NOW.png"),game.load.image("defendButton","assets/DEFEND-THE-CITY.png"),game.load.image("border","assets/border.png"),game.load.image("smileyFace","assets/smileyFace.png"),game.load.image("wand","assets/W_Mace007.png"),game.load.image("armour","assets/A_Armour02.png"),game.load.image("ring","assets/Ac_Ring04.png"),game.load.image("buff","assets/S_Buff01.png"),game.load.image("assistant","assets/assistant.png"),game.load.image("speechBubble","assets/speechBubble.png"),game.load.image("leftArrow","assets/leftArrow.png"),game.load.image("rightArrow","assets/rightArrow.png"),game.load.image("leftControl","assets/leftControl.png"),game.load.image("rightControl","assets/rightControl.png"),game.load.spritesheet("statue","assets/statue.png",32,68),game.load.spritesheet("pillars","assets/pillars.png",32,96),game.load.image("shopBorder","assets/shopBorder.png"),game.load.image("barrel","assets/barrel.png"),game.load.image("chestWooden","assets/chestWooden.png"),game.load.image("cityOutskirts","assets/cityOutskirts.png"),game.load.image("stonepavingOvergrown","assets/stonepavingOvergrown.png"),game.load.image("forestBackground","assets/forestBackground.png"),game.load.image("largeTree","assets/largeTree.png"),game.load.image("scrollBox","assets/ui_square.png"),game.load.image("ui_213x220","assets/ui_213x220.png"),game.load.image("ui_213x150","assets/ui_213x150.png"),game.load.image("ui_213x255","assets/ui_213x255.png"),game.load.image("scrollStrip","assets/dialog_box.png"),game.load.image("dialog_box_thin","assets/dialog_box_thin.png"),game.load.image("dbox_thinShort","assets/dbox_thinShort.png"),game.load.image("waterShot","assets/waterShot.png"),game.load.image("rubble","assets/rubble.png"),game.load.image("trainerSprite","assets/trainerSprite.png"),game.load.image("introCutscene","assets/introCutscene.png"),game.load.image("marriageCutscene","assets/marriageCutscene.png"),game.load.image("cutsceneBorder","assets/cutsceneBorder.png"),game.load.image("tutorialBackground","assets/tutorialBackground.png"),game.load.image("hudBarBlue","assets/hudBarBlue.png"),game.load.image("hudBarGreen","assets/hudBarGreen.png"),game.load.image("hudBarRed","assets/hudBarRed.png"),game.load.image("hudDisplay","assets/hudDisplay.png"),game.load.image("hudManaWarning","assets/hudManaWarning.png"),game.load.image("closeButton","assets/closeButton.png"),game.load.spritesheet("tutorialBarriers32x32","assets/tutorialBarriers32x32.png",32,32),game.load.spritesheet("tutorialDecorations36x32","assets/tutorialDecorations36x32.png",36,32),game.load.spritesheet("tutorialObstacles32x44","assets/tutorialObstacles32x44.png",32,44),game.load.spritesheet("swordZombie","assets/swordZombie.png",31,42),game.load.spritesheet("forestScenery","assets/forestScenery.png",27,24),game.load.spritesheet("wandAnimation","assets/wandAnimation.png",68,68),game.load.spritesheet("shieldAnimation","assets/shieldAnimation.png",68,68),game.load.spritesheet("armourAnimation","assets/armourAnimation.png",68,68),game.load.spritesheet("hatAnimation","assets/hatAnimation.png",68,68),game.load.spritesheet("bootAnimation","assets/bootAnimation.png",68,68),game.load.spritesheet("ringAnimation","assets/ringAnimation.png",68,68),game.load.spritesheet("amuletAnimation","assets/animatedAmulet.png",68,68),game.load.spritesheet("skillAnimation","assets/skillAnimation.png",68,68),game.load.spritesheet("enduranceAnimation","assets/enduranceAnimation.png",68,68),game.load.spritesheet("dude","assets/king.png",31.3,36),game.load.spritesheet("playerTeleport","assets/playerTeleport.png",38,38),game.load.spritesheet("attacker","assets/attacker.png",32,36),game.load.spritesheet("baddie","assets/zombie.png",24,42),game.load.spritesheet("zombieRising","assets/zombieRising.png",24,41),game.load.spritesheet("zombieRed","assets/zombieRed.png",24,42),game.load.spritesheet("bossZombie","assets/bossZombie.png",72,126),game.load.spritesheet("flame","assets/flames.png",16,24),game.load.spritesheet("skeleton","assets/skeleton.png",31,48),game.load.spritesheet("townWoman","assets/townfolk1_f.png",32,36),game.load.spritesheet("townMan","assets/townfolk1_m.png",32,36),game.load.spritesheet("children","assets/children.png",33,36),game.load.spritesheet("warriorWoman","assets/warrior_f.png",32,36),game.load.spritesheet("warriorMan","assets/warrior_m.png",31.5,36),game.load.spritesheet("sword","assets/sword.png",24,24),game.load.spritesheet("mummy","assets/mummy.png",31,36),game.load.spritesheet("swampCreature","assets/swampCreature.png",36,36),game.load.spritesheet("deathSheet","assets/deathSheet.png",48,48),game.load.spritesheet("golem","assets/golem.png",64,64),game.load.spritesheet("princesses","assets/princesses.png",64,72),game.load.spritesheet("treeBeast","assets/treeBeast1.png",105,53),game.load.spritesheet("bottle","assets/bottle.png",34,34),game.load.spritesheet("beamIcon","assets/beamIcon.png",68,34),game.load.spritesheet("evilRoot","assets/evilRoot.png",22,30),game.load.spritesheet("vampire","assets/vampire.png",32,36),game.load.spritesheet("smokeAnimation","assets/smokeAnimation.png",32,16),game.load.bitmapFont("font","assets/font.png","assets/font.fnt"),game.load.bitmapFont("fontWhite","assets/fontWhite.png","assets/fontWhite.fnt"),game.load.bitmapFont("fontBorder","assets/fontWhiteBorder.png","assets/fontWhiteBorder.fnt")},create:function(){game.state.start("menu")},gofull:function(){game.scale.startFullScreen(!1)}},resetCutScene,resetTypewriter,resetLowerTypewriter,skipText,introMusic,resetState={create:function(){introMusic=game.add.audio("introCreditsMusic"),introMusic.play(),resetCutScene=game.add.sprite(0,0,"marriageCutscene"),game.add.sprite(0,0,"cutsceneBorder"),game.add.button(-5,-5,"blankButton",this.skip,this),skipText=game.add.bitmapText(40,20,"font","Skip Cutscene",16),resetLowerTypewriter=new Typewriter,resetLowerTypewriter.init(game,{x:116,y:490,time:Phaser.Timer.SECOND/18,fontFamily:"font",fontSize:16,maxWidth:600,endFn:this.startButtonTextChange,text:"Many years later, you received troubling news from a small kingdom bordering the badlands. Your years of questing had beaten back the horrors, but some had fled and sought easier prey. The King and Queen of this kingdom had died valiantly defending their land, extinguishing their line. The kingdom pleaded for your aid and so, with a heavy heart, you sent your youngest child with their personal guard and a modest sum of gold to take the throne."}),resetTypewriter=new Typewriter,resetTypewriter.init(game,{x:116,y:65,time:Phaser.Timer.SECOND/18,fontFamily:"font",fontSize:16,maxWidth:600,text:"The Alliance with your neighbour made a strong Kingdom even stronger, bringing peace and prosperity to the whole region. Your marriage was a happy one and together you raised many children to continue your line. Although you no longer had need to quest in the badlands you ensured your sons and daughters were well trained to defend their city should the need ever arise again.",endFn:this.lowerTypewriterStart}),resetTypewriter.start()},update:function(){resetCutScene.scale.x+=.001,resetCutScene.scale.y+=.001,resetCutScene.x=-Math.floor(400*(resetCutScene.scale.x-1)),resetCutScene.y=-Math.floor(290*(resetCutScene.scale.y-1))},skip:function(){introMusic.stop(),game.state.start("city")},lowerTypewriterStart:function(){game.time.events.add(1*Phaser.Timer.SECOND,function(){resetLowerTypewriter.start()})},startButtonTextChange:function(){skipText.text="Start Game"}},shop,close,closeText,shopPopText,shopCoinsText,shopMessageBackground,shopMessageText,taxHolder,taxLevelText,taxPlusButton,taxMinusButton,housingHolder,housingLevelText,housingFunding=40,housingPlusButton,housingMinusButton,commercialHolder,commercialLevelText,commercialFunding=40,commercialPlusButton,commercialMinusButton,industrialHolder,industrialLevelText,industrialFunding=40,industrialPlusButton,industrialMinusButton,educationHolder,educationLevelText,educationFunding=40,educationPlusButton,educationMinusButton,healthHolder,healthLevelText,healthFunding=40,healthPlusButton,healthMinusButton,justiceHolder,justiceLevelText,justiceFunding=40,justicePlusButton,justiceMinusButton,defenceHolder,defenceLevelText,defenceFunding=40,defencePlusButton,defenceMinusButton,utilitiesHolder,utilitiesLevelText,utilitiesFunding=40,utilitiesPlusButton,utilitiesMinusButton,weaponsmithHolder,weaponsmithLevelText,weaponsmithFunding=40,weaponsmithPlusButton,weaponsmithMinusButton,armourerHolder,armourerLevelText,armourerFunding=40,armourerPlusButton,armourerMinusButton,enchanterHolder,enchanterLevelText,enchanterFunding=40,enchanterPlusButton,enchanterMinusButton,trainerHolder,trainerLevelText,trainerFunding=40,trainerPlusButton,trainerMinusButton,averageFunding=40,baseChance,weaponsmithDropReward=0,weaponsmithDRBoost=1,weaponsmithTimer=0,weaponsmithAdTimer=0,wandTimer=0,wandImage,wandPerkButton,wandPerkText,wandPerkText2,wandShotPower=0,wandShotPowerUpgrade,wandShotSpeed=0,wandShotSpeedUpgrade,wandBulletSpacing=0,wandBulletSpacingUpgrade,shieldTimer=0,shieldImage,shieldPerkButton,shieldPerkText,shieldPerkText2,shieldKnockback=0,shieldKnockbackUpgrade,shieldMaxHealth=0,shieldMaxHealthUpgrade,shieldInvulnerableSpacing=0,shieldInvulnerableSpacingUpgrade,armourerDropReward=0,armourerDRBoost=1,armourerTimer=0,armourerAdTimer=0,armourTimer=0,armourImage,armourPerkButton,armourPerkText,armourPerkText2,armourMaxHealth=0,armourMaxHealthUpgrade,armourManaRegenInterval=0,armourManaRegenIntervalUpgrade,armourInvulnerableSpacing=0,armourInvulnerableSpacingUpgrade,hatTimer=0,hatImage,hatPerkButton,hatPerkText,hatPerkText2,hatMaxHealth=0,hatMaxHealthUpgrade,hatManaRegenInterval=0,hatManaRegenIntervalUpgrade,hatMaxMana=0,hatMaxManaUpgrade,bootTimer=0,bootImage,bootPerkButton,bootPerkText,bootPerkText2,bootRunSpeed=0,bootRunSpeedUpgrade,bootManaRegenInterval=0,bootManaRegenIntervalUpgrade,bootInvulnerableSpacing=0,bootInvulnerableSpacingUpgrade,enchanterDropReward=0,enchanterDRBoost=1,enchanterTimer=0,enchanterAdTimer=0,ringTimer=0,ringImage,ringPerkButton,ringPerkText,ringPerkText2,ringShotPower=0,ringShotPowerUpgrade,ringMaxMana=0,ringMaxManaUpgrade,ringKnockback=0,ringKnockbackUpgrade,amuletTimer=0,amuletImage,amuletPerkButton,amuletPerkText,amuletPerkText2,amuletRunSpeed=0,amuletRunSpeedUpgrade,amuletShotSpeed=0,amuletShotSpeedUpgrade,amuletBulletSpacing=0,amuletBulletSpacingUpgrade,trainerDropReward=0,trainerDRBoost=1,trainerTimer=0,trainerAdTimer=0,skillTimer=0,skillImage,skillPerkButton,skillPerkText,skillPerkText2,skillShotPower=0,skillShotPowerUpgrade,skillMaxMana=0,skillMaxManaUpgrade,skillKnockback=0,skillKnockbackUpgrade,enduranceTimer=0,enduranceImage,endurancePerkButton,endurancePerkText,endurancePerkText2,enduranceRunSpeed=0,enduranceRunSpeedUpgrade,enduranceShotSpeed=0,enduranceShotSpeedUpgrade,enduranceBulletSpacing=0,enduranceBulletSpacingUpgrade,maxFunding=!1,wellfunded=!1,priorityService=!0,shopSpeechBubble,shopText="",shopText2="",shopText3="",shopText4="",shopText5="",shopText6="",efffectivenessScoreBackground,efffectivenessScoreText,nextHousing,nextCommercial,nextIndustrial,nextEducation,nextPopHealth,nextJustice,nextDefence,nextUtilities,nextWeaponsmith,nextArmourer,nextEnchanter,nextTrainer,nextPopulation,nextCoins,nextHappiness,nextEconomyMod,nextIncome,nextExpenditure,nextNetIncome,nextYearStatText,nextPopulationStatText,nextIncomeStatText,nextExpenditureStatText,nextNetIncomeStatText,nextBalanceStatText,nextYear,weaponsmithUpgradeText,weaponsmithUpgradeCost=200,armourerUpgradeText,armourerUpgradeCost=200,enchanterUpgradeText,enchanterUpgradeCost=200,trainerUpgradeText,trainerUpgradeCost=200,advert=!1,advertImage,adStopTime,adTimeText,adCloseButton,addStartButton,addStartText,addRejectButton,addRejectText,bonusType="",beamUnlockShown=!1,manaRefillUnlockShown=!1,spaceBar,weaponsmithSkillLevelText,wandPowerText,wandShotSpeedText,wandAttackSpeedText,shieldKnockbackText,shieldHealthText,shieldInvulnerableText,armourerSkillLevelText,armourHealthBonusText,armourManaRegenBonus,armourInvulnerableText,crownHealthText,crownManaRegenText,crownManaText,bootsRunSpeedText,bootManaRegenText,bootsInvulnerableText,enchanterSkillLevelText,ringPowerText,ringManaText,ringKnockbackText,amuletRunSpeedText,amuletShotSpeedText,amuletAttackSpeedText,trainerSkillLevelText,skillPowerText,skillManaText,skillKnockbackText,staminaRunSpeedText,staminaShotSpeedText,staminaAttackSpeedText,increaseSFX,reduceSFX,slotMachineSFX,shopState={create:function(){switch(advert=!1,wellfunded=!1,game.world.removeAll(),increaseSFX=game.add.audio("collect"),reduceSFX=game.add.audio("reduce"),slotMachineSFX=game.add.audio("slotMachine"),game.add.sprite(0,0,"shopBackground"),close=game.add.button(607,565,"blankButton",this.shopClose,this),closeText=game.add.bitmapText(657,595,"font","Return to Town",18),popDisplay=game.add.sprite(130,6,"townWoman"),popDisplay.frame=7,shopPopText=game.add.bitmapText(170,10,"font",population,26),coinDisplay=game.add.sprite(510,8,"coin"),coinDisplay.frame=0,shopCoinsText=game.add.bitmapText(550,10,"font",coins,26),shopMessageBackground=game.add.sprite(-1e3,357,"dialog_box_thin"),shopMessageText=game.add.bitmapText(200,375,"font","",18),game.add.button(0,250,"leftArrow",this.shopLeft,this),game.add.button(755,250,"rightArrow",this.shopRight,this),shopSpeechBubble=game.add.sprite(180,35,"speechBubble"),shopText=game.add.bitmapText(230,45,"fontBorder","",15),shopText2=game.add.bitmapText(200,60,"fontBorder","",15),shopText3=game.add.bitmapText(188,75,"fontBorder","",15),shopText4=game.add.bitmapText(188,90,"fontBorder","",15),shopText5=game.add.bitmapText(200,105,"fontBorder","",15),shopText6=game.add.bitmapText(220,120,"fontBorder","",15),shopText.tint=0,shopText2.tint=0,shopText3.tint=0,shopText4.tint=0,shopText5.tint=0,shopText6.tint=0,efffectivenessScoreBackground=game.add.sprite(500,60,"dbox_thinShort"),efffectivenessScoreText=game.add.bitmapText(515,75,"font","",17),this.dropRewardDiminishingReturns(),spaceBar=game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),shop){case"castle":taxHolder=game.add.sprite(305,250,"blankButton"),taxLevelText=game.add.bitmapText(360,278,"font","Tax Level: "+tax,20),taxPlusButton=game.add.button(530,250,"plusButton",this.taxPlus,this),taxMinusButton=game.add.button(225,250,"minusButton",this.taxMinus,this),priorityService=!1,efffectivenessScoreText.text="     Approval Rating: "+Math.round((housing+commercial+industrial+education+popHealth+justice+defence+utilities+weaponsmith+armourer+enchanter+trainer)/12),happiness>1.65*tax+10?(shopText.text=" Your Majesty!",shopText2.text="  I believe the people",shopText3.text="      would be willing to",shopText4.text="  pay higher taxes to help",shopText5.text="       fund our vital",shopText6.text="      services."):happiness<=tax+5?(shopText.text=" Your Majesty!",shopText2.text="Your people are troubled.",shopText3.text="    I'm sure they would",shopText4.text=" welcome a cut in taxes if",shopText5.text="    you feel the treasury",shopText6.text="    can afford it."):(shopText.text=" Your Majesty!",shopText2.text="  The general feeling",shopText3.text="   among your people is",shopText4.text="         that the level of ",shopText5.text="       taxation is just ",shopText6.text="    about right."),game.add.sprite(150,340,"scrollBox"),game.add.bitmapText(180,350,"font","Last Year",18);game.add.bitmapText(165,385,"font","Year: "+(year-1),14),game.add.bitmapText(165,400,"font","Population: "+previousPopulation,14),game.add.bitmapText(165,415,"font","Income: "+Math.round(previousIncome),14),game.add.bitmapText(165,430,"font","Expenditure: "+Math.round(previousExpenditure),14),game.add.bitmapText(165,445,"font","Net Income: "+Math.round(previousNetIncome),14),game.add.bitmapText(165,460,"font","Balance: "+previousCoins,14);game.add.sprite(350,340,"scrollBox"),game.add.bitmapText(380,350,"font","This Year",18);game.add.bitmapText(365,385,"font","Year: "+year,14),game.add.bitmapText(365,400,"font","Population: "+population,14),game.add.bitmapText(365,415,"font","Income: "+Math.round(income),14),game.add.bitmapText(365,430,"font","Expenditure: "+Math.round(expenditure),14),game.add.bitmapText(365,445,"font","Net Income: "+Math.round(netIncome),14),game.add.bitmapText(365,460,"font","Balance: "+coins,14);game.add.sprite(550,340,"scrollBox"),game.add.bitmapText(580,350,"font","Next Year",18),nextYearStatText=game.add.bitmapText(565,385,"font","Year: "+(year+1),14),nextPopulationStatText=game.add.bitmapText(565,400,"font","Population: "+nextPopulation,14),nextIncomeStatText=game.add.bitmapText(565,415,"font","Income: "+Math.round(nextIncome),14),nextExpenditureStatText=game.add.bitmapText(565,430,"font","Expenditure: "+Math.round(nextExpenditure),14),nextNetIncomeStatText=game.add.bitmapText(565,445,"font","Net Income: "+Math.round(nextNetIncome),14),nextBalanceStatText=game.add.bitmapText(565,460,"font","Balance: "+nextCoins,14),this.nextYearEstimate();break;case"housing":housingHolder=game.add.sprite(305,250,"blankButton"),housingLevelText=game.add.bitmapText(325,280,"font","   Homestead Fund: "+housingFunding,16),
housingPlusButton=game.add.button(530,250,"plusButton",this.housingPlus,this),housingMinusButton=game.add.button(225,250,"minusButton",this.housingMinus,this),maxFunding=!(housingFunding<100),wellfunded=housingFunding>=averageFunding+1,priorityService=!1,efffectivenessScoreText.text="Department Effectiveness: "+Math.round(housing);break;case"commercial":commercialHolder=game.add.sprite(305,250,"blankButton"),commercialLevelText=game.add.bitmapText(325,280,"font","   City Market Fund: "+commercialFunding,16),commercialPlusButton=game.add.button(530,250,"plusButton",this.commercialPlus,this),commercialMinusButton=game.add.button(225,250,"minusButton",this.commercialMinus,this),maxFunding=!(commercialFunding<100),wellfunded=commercialFunding>=happiness,priorityService=!0,efffectivenessScoreText.text="Department Effectiveness: "+Math.round(commercial);break;case"industrial":industrialHolder=game.add.sprite(305,250,"blankButton"),industrialLevelText=game.add.bitmapText(325,280,"font","    Farmland Fund: "+industrialFunding,16),industrialPlusButton=game.add.button(530,250,"plusButton",this.industrialPlus,this),industrialMinusButton=game.add.button(225,250,"minusButton",this.industrialMinus,this),maxFunding=!(industrialFunding<100),wellfunded=industrialFunding>=happiness,priorityService=!0,efffectivenessScoreText.text="Department Effectiveness: "+Math.round(industrial);break;case"education":educationHolder=game.add.sprite(305,250,"blankButton"),educationLevelText=game.add.bitmapText(325,280,"font","      School Fund: "+educationFunding,16),educationPlusButton=game.add.button(530,250,"plusButton",this.educationPlus,this),educationMinusButton=game.add.button(225,250,"minusButton",this.educationMinus,this),maxFunding=!(educationFunding<100),wellfunded=educationFunding>=happiness,priorityService=!0,efffectivenessScoreText.text="Department Effectiveness: "+Math.round(education);break;case"health":healthHolder=game.add.sprite(305,250,"blankButton"),healthLevelText=game.add.bitmapText(325,280,"font","     Hospital Fund: "+healthFunding,16),healthPlusButton=game.add.button(530,250,"plusButton",this.healthPlus,this),healthMinusButton=game.add.button(225,250,"minusButton",this.healthMinus,this),maxFunding=!(healthFunding<100),wellfunded=healthFunding>=happiness,priorityService=!0,efffectivenessScoreText.text="Department Effectiveness: "+Math.round(popHealth);break;case"justice":justiceHolder=game.add.sprite(305,250,"blankButton"),justiceLevelText=game.add.bitmapText(325,280,"font","       Police Fund: "+justiceFunding,16),justicePlusButton=game.add.button(530,250,"plusButton",this.justicePlus,this),justiceMinusButton=game.add.button(225,250,"minusButton",this.justiceMinus,this),maxFunding=!(justiceFunding<100),wellfunded=justiceFunding>=averageFunding+1,priorityService=!1,efffectivenessScoreText.text="Department Effectiveness: "+Math.round(justice);break;case"defence":defenceHolder=game.add.sprite(305,250,"blankButton"),defenceLevelText=game.add.bitmapText(325,280,"font","     Defence Fund: "+defenceFunding,16),defencePlusButton=game.add.button(530,250,"plusButton",this.defencePlus,this),defenceMinusButton=game.add.button(225,250,"minusButton",this.defenceMinus,this),maxFunding=!(defenceFunding<100),wellfunded=defenceFunding>=happiness,priorityService=!0,efffectivenessScoreText.text="Department Effectiveness: "+Math.round(defence);break;case"utilities":utilitiesHolder=game.add.sprite(305,250,"blankButton"),utilitiesLevelText=game.add.bitmapText(325,280,"font","      Sewers Fund: "+utilitiesFunding,16),utilitiesPlusButton=game.add.button(530,250,"plusButton",this.utilitiesPlus,this),utilitiesMinusButton=game.add.button(225,250,"minusButton",this.utilitiesMinus,this),maxFunding=!(utilitiesFunding<100),wellfunded=utilitiesFunding>=averageFunding+1,priorityService=!1,efffectivenessScoreText.text="Department Effectiveness: "+Math.round(utilities);break;case"weaponsmith":weaponsmithHolder=game.add.sprite(129,175,"blankButton"),weaponsmithLevelText=game.add.bitmapText(149,205,"font"," Weaponsmith Fund: "+weaponsmithFunding,16),weaponsmithPlusButton=game.add.button(354,175,"plusButton",this.weaponsmithPlus,this),weaponsmithMinusButton=game.add.button(49,175,"minusButton",this.weaponsmithMinus,this),game.add.sprite(310,410,"ui_213x150"),weaponsmithSkillLevelText=game.add.bitmapText(317,425,"font","Weaponsmith Skill Level: "+Math.round(10*weaponsmithDropReward)/10,14),wandPowerText=game.add.bitmapText(317,450,"font","Wand Power Bonus: "+wandShotPower,14),wandShotSpeedText=game.add.bitmapText(317,465,"font","Wand Shot Speed Bonus: "+wandShotSpeed,14),wandAttackSpeedText=game.add.bitmapText(317,480,"font","Wand Attack Speed Bonus: "+wandBulletSpacing,14),shieldKnockbackText=game.add.bitmapText(317,500,"font","Shield Knockback Bonus: "+shieldKnockback,14),shieldHealthText=game.add.bitmapText(317,515,"font","Shield Health Bonus: "+shieldMaxHealth,14),shieldInvulnerableText=game.add.bitmapText(317,530,"font","Shield Invulnerable Bonus: "+shieldInvulnerableSpacing,14),game.add.sprite(483,175,"blankButton"),weaponsmithUpgradeText=game.add.bitmapText(503,205,"font"," Buy Skill Material: "+weaponsmithUpgradeCost,16),weaponsmithUpgradeCost>=1e6?weaponsmithUpgradeText.text=" Buy Skill Material: "+Math.round(weaponsmithUpgradeCost/1e5)/10+"M":weaponsmithUpgradeText.text=" Buy Skill Material: "+weaponsmithUpgradeCost,game.add.button(708,175,"plusButton",this.weaponsmithUpgrade,this),maxFunding=!(weaponsmithFunding<100),wellfunded=weaponsmithFunding>=averageFunding+1,priorityService=!1,this.weaponsmithImprove(),efffectivenessScoreText.text="  Artisan Effectiveness: "+Math.round(weaponsmith),population>111&&weaponsmithTimer>game.time.now&&weaponsmithAdTimer<game.time.now&&(advert=!0);break;case"armourer":armourerHolder=game.add.sprite(129,175,"blankButton"),armourerLevelText=game.add.bitmapText(145,205,"font","     Armourer Fund: "+armourerFunding,16),armourerPlusButton=game.add.button(354,175,"plusButton",this.armourerPlus,this),armourerMinusButton=game.add.button(49,175,"minusButton",this.armourerMinus,this),game.add.sprite(310,410,"ui_213x220"),armourerSkillLevelText=game.add.bitmapText(317,425,"font","Armourer Skill Level: "+Math.round(10*armourerDropReward)/10,14),armourHealthBonusText=game.add.bitmapText(317,455,"font","Armour Health Bonus: "+armourMaxHealth,14),armourManaRegenBonus=game.add.bitmapText(317,470,"font","Armour Mana Regen Bonus: "+armourManaRegenInterval,14),armourInvulnerableText=game.add.bitmapText(317,485,"font","Armour Invulnerable Bonus: "+armourInvulnerableSpacing,14),crownHealthText=game.add.bitmapText(317,510,"font","Crown Health Bonus: "+hatMaxHealth,14),crownManaRegenText=game.add.bitmapText(317,525,"font","Crown Mana Regen Bonus: "+hatManaRegenInterval,14),crownManaText=game.add.bitmapText(317,540,"font","Crown Mana Bonus: "+hatMaxMana,14),bootsRunSpeedText=game.add.bitmapText(317,565,"font","Boots Run Speed Bonus: "+bootRunSpeed,14),bootManaRegenText=game.add.bitmapText(317,580,"font","Boots Mana Regen Bonus: "+bootManaRegenInterval,14),bootsInvulnerableText=game.add.bitmapText(317,595,"font","Boots Invulnerable Bonus: "+bootInvulnerableSpacing,14),game.add.sprite(483,175,"blankButton"),armourerUpgradeText=game.add.bitmapText(503,205,"font"," Buy Skill Material: "+armourerUpgradeCost,16),armourerUpgradeCost>=1e6?armourerUpgradeText.text=" Buy Skill Material: "+Math.round(armourerUpgradeCost/1e5)/10+"M":armourerUpgradeText.text=" Buy Skill Material: "+armourerUpgradeCost,game.add.button(708,175,"plusButton",this.armourerUpgrade,this),maxFunding=!(armourerFunding<100),wellfunded=armourerFunding>=averageFunding+1,priorityService=!1,this.armourerImprove(),efffectivenessScoreText.text="  Artisan Effectiveness: "+Math.round(armourer),population>127&&armourerTimer>game.time.now&&armourerAdTimer<game.time.now&&(advert=!0);break;case"enchanter":enchanterHolder=game.add.sprite(129,175,"blankButton"),enchanterLevelText=game.add.bitmapText(149,205,"font","    Enchanter Fund: "+enchanterFunding,16),enchanterPlusButton=game.add.button(354,175,"plusButton",this.enchanterPlus,this),enchanterMinusButton=game.add.button(49,175,"minusButton",this.enchanterMinus,this),game.add.sprite(310,410,"ui_213x150"),enchanterSkillLevelText=game.add.bitmapText(317,425,"font","Enchanter Skill Level: "+Math.round(10*enchanterDropReward)/10,14),ringPowerText=game.add.bitmapText(317,450,"font","Ring Power Bonus: "+ringShotPower,14),ringManaText=game.add.bitmapText(317,465,"font","Ring Mana Bonus: "+ringMaxMana,14),ringKnockbackText=game.add.bitmapText(317,480,"font","Ring Knockback Bonus: "+ringKnockback,14),amuletRunSpeedText=game.add.bitmapText(317,500,"font","Amulet Run Speed Bonus: "+amuletRunSpeed,14),amuletShotSpeedText=game.add.bitmapText(317,515,"font","Amulet Shot Speed Bonus: "+amuletShotSpeed,14),amuletAttackSpeedText=game.add.bitmapText(317,530,"font","Amulet Attack Speed Bonus: "+amuletBulletSpacing,14),game.add.sprite(483,175,"blankButton"),enchanterUpgradeText=game.add.bitmapText(503,205,"font"," Buy Skill Material: "+enchanterUpgradeCost,16),enchanterUpgradeCost>=1e6?enchanterUpgradeText.text=" Buy Skill Material: "+Math.round(enchanterUpgradeCost/1e5)/10+"M":enchanterUpgradeText.text=" Buy Skill Material: "+enchanterUpgradeCost,game.add.button(708,175,"plusButton",this.enchanterUpgrade,this),maxFunding=!(enchanterFunding<100),wellfunded=enchanterFunding>=averageFunding+1,priorityService=!1,this.enchanterImprove(),efffectivenessScoreText.text="  Artisan Effectiveness: "+Math.round(enchanter),population>153&&enchanterTimer>game.time.now&&enchanterAdTimer<game.time.now&&(advert=!0);break;case"trainer":trainerHolder=game.add.sprite(129,175,"blankButton"),trainerLevelText=game.add.bitmapText(149,205,"font","     Trainer Fund: "+trainerFunding,16),trainerPlusButton=game.add.button(354,175,"plusButton",this.trainerPlus,this),trainerMinusButton=game.add.button(49,175,"minusButton",this.trainerMinus,this),game.add.sprite(310,410,"ui_213x150"),trainerSkillLevelText=game.add.bitmapText(317,425,"font","Trainer Skill Level: "+Math.round(10*trainerDropReward)/10,14),skillPowerText=game.add.bitmapText(317,450,"font","Skill Power Bonus: "+skillShotPower,14),skillManaText=game.add.bitmapText(317,465,"font","Skill Mana Bonus: "+skillMaxMana,14),skillKnockbackText=game.add.bitmapText(317,480,"font","Skill Knockback Bonus: "+skillKnockback,14),staminaRunSpeedText=game.add.bitmapText(317,500,"font","Stamina Run Speed Bonus: "+enduranceRunSpeed,14),staminaShotSpeedText=game.add.bitmapText(317,515,"font","Stamina Shot Speed Bonus: "+enduranceShotSpeed,14),staminaAttackSpeedText=game.add.bitmapText(317,530,"font","Stamina Attack Speed Bonus: "+enduranceBulletSpacing,14),game.add.sprite(483,175,"blankButton"),trainerUpgradeText=game.add.bitmapText(503,205,"font"," Buy Skill Material: "+trainerUpgradeCost,16),trainerUpgradeCost>=1e6?trainerUpgradeText.text=" Buy Skill Material: "+Math.round(trainerUpgradeCost/1e5)/10+"M":trainerUpgradeText.text=" Buy Skill Material: "+trainerUpgradeCost,game.add.button(708,175,"plusButton",this.trainerUpgrade,this),maxFunding=!(trainerFunding<100),wellfunded=trainerFunding>=averageFunding+1,priorityService=!1,this.trainerImprove(),efffectivenessScoreText.text="  Artisan Effectiveness: "+Math.round(trainer),population>205&&trainerTimer>game.time.now&&trainerAdTimer<game.time.now&&(advert=!0)}this.shopTextSelect()},update:function(){""!=bonusType&&spaceBar.isDown&&this.create()},shopClose:function(){game.world.removeAll(),game.state.start("city")},taxPlus:function(){tax<100&&happiness>tax?(tax+=1,taxLevelText.text="Tax Level: "+tax,this.nextYearEstimate(),increaseSFX.play(),this.create()):(shopMessageBackground.x=196,shopMessageText.text="              Taxes can't be increased further.")},taxMinus:function(){tax>=10?(tax-=1,taxLevelText.text="Tax Level: "+tax,this.nextYearEstimate(),reduceSFX.play(),this.create()):(shopMessageBackground.x=196,shopMessageText.text="              Taxes can't be decreased further.")},housingPlus:function(){housingFunding<100&&happiness>housingFunding?(housingFunding+=1,housingLevelText.text="   Homestead Fund: "+housingFunding,increaseSFX.play(),this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be increased further.")},housingMinus:function(){housingFunding>=10?(housingFunding-=1,housingLevelText.text="   Homestead Fund: "+housingFunding,reduceSFX.play(),this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be decreased further.")},commercialPlus:function(){commercialFunding<100&&happiness>commercialFunding?(commercialFunding+=1,commercialLevelText.text="   City Market Fund: "+commercialFunding,increaseSFX.play(),this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be increased further.")},commercialMinus:function(){commercialFunding>=10?(commercialFunding-=1,commercialLevelText.text="   City Market Fund: "+commercialFunding,reduceSFX.play(),this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be decreased further.")},industrialPlus:function(){industrialFunding<100&&happiness>industrialFunding?(industrialFunding+=1,industrialLevelText.text="    Farmland Fund: "+industrialFunding,increaseSFX.play(),this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be increased further.")},industrialMinus:function(){industrialFunding>=10?(industrialFunding-=1,industrialLevelText.text="    Farmland Fund: "+industrialFunding,reduceSFX.play(),this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be decreased further.")},educationPlus:function(){educationFunding<100&&happiness>educationFunding?(educationFunding+=1,educationLevelText.text="      School Fund: "+educationFunding,increaseSFX.play(),this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be increased further.")},educationMinus:function(){educationFunding>=10?(educationFunding-=1,educationLevelText.text="      School Fund: "+educationFunding,reduceSFX.play(),this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be decreased further.")},healthPlus:function(){healthFunding<100&&happiness>healthFunding?(healthFunding+=1,healthLevelText.text="     Hospital Fund: "+healthFunding,increaseSFX.play(),this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be increased further.")},healthMinus:function(){healthFunding>=10?(healthFunding-=1,reduceSFX.play(),healthLevelText.text="     Hospital Fund: "+healthFunding,this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be decreased further.")},justicePlus:function(){justiceFunding<100&&happiness>justiceFunding?(justiceFunding+=1,justiceLevelText.text="       Police Fund: "+justiceFunding,increaseSFX.play(),this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be increased further.")},justiceMinus:function(){justiceFunding>=10?(justiceFunding-=1,reduceSFX.play(),justiceLevelText.text="       Police Fund: "+justiceFunding,this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be decreased further.")},defencePlus:function(){defenceFunding<100&&happiness>defenceFunding?(defenceFunding+=1,defenceLevelText.text="     Defence Fund: "+defenceFunding,increaseSFX.play(),this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be increased further.")},defenceMinus:function(){defenceFunding>=10?(defenceFunding-=1,reduceSFX.play(),defenceLevelText.text="     Defence Fund: "+defenceFunding,this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be decreased further.")},utilitiesPlus:function(){utilitiesFunding<100&&happiness>utilitiesFunding?(utilitiesFunding+=1,utilitiesLevelText.text="      Sewers Fund: "+utilitiesFunding,increaseSFX.play(),this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be increased further.")},utilitiesMinus:function(){utilitiesFunding>=10?(utilitiesFunding-=1,reduceSFX.play(),utilitiesLevelText.text="      Sewers Fund: "+utilitiesFunding,this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be decreased further.")},weaponsmithPlus:function(){weaponsmithFunding<100&&happiness>weaponsmithFunding?(weaponsmithFunding+=1,weaponsmithLevelText.text=" Weaponsmith Fund: "+weaponsmithFunding,increaseSFX.play(),this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be increased further.")},weaponsmithMinus:function(){weaponsmithFunding>=10?(weaponsmithFunding-=1,reduceSFX.play(),weaponsmithLevelText.text=" Weaponsmith Fund: "+weaponsmithFunding,this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be decreased further.")},armourerPlus:function(){armourerFunding<100&&happiness>armourerFunding?(armourerFunding+=1,armourerLevelText.text="     Armourer Fund: "+armourerFunding,increaseSFX.play(),this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be increased further.")},armourerMinus:function(){armourerFunding>=10?(armourerFunding-=1,armourerLevelText.text="     Armourer Fund: "+armourerFunding,reduceSFX.play(),this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be decreased further.")},enchanterPlus:function(){enchanterFunding<100&&happiness>enchanterFunding?(enchanterFunding+=1,enchanterLevelText.text="    Enchanter Fund: "+enchanterFunding,increaseSFX.play(),this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be increased further.")},enchanterMinus:function(){enchanterFunding>=10?(enchanterFunding-=1,reduceSFX.play(),enchanterLevelText.text="    Enchanter Fund: "+enchanterFunding,this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be decreased further.")},trainerPlus:function(){trainerFunding<100&&happiness>trainerFunding?(trainerFunding+=1,trainerLevelText.text="     Trainer Fund: "+trainerFunding,increaseSFX.play(),this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be increased further.")},trainerMinus:function(){trainerFunding>=10?(trainerFunding-=1,reduceSFX.play(),trainerLevelText.text="     Trainer Fund: "+trainerFunding,this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be decreased further.")},weaponsmithImprove:function(){game.time.now>weaponsmithTimer&&population>=110?(baseChance=Math.round((.15*popScore+.25*weaponsmith+.6*weaponsmithDropReward)/2),game.add.sprite(100,250,"border"),wandImage=game.add.sprite(108,258,"wandAnimation"),wandImage.frame=0,wandImage.animations.add("spin",[0,1,2,3,4,5],10,!0),wandPerkButton=game.add.button(30,330,"blankButton",this.wandPerk,this),wandPerkText=game.add.bitmapText(100,350,"font","  Request",15),wandPerkText2=game.add.bitmapText(65,370,"font","  Wand Improvement",15),game.add.sprite(650,250,"border"),shieldImage=game.add.sprite(658,258,"shieldAnimation"),shieldImage.frame=0,shieldImage.animations.add("spin",[0,1,2,3,4,5],10,!0),shieldPerkButton=game.add.button(580,330,"blankButton",this.shieldPerk,this),shieldPerkText=game.add.bitmapText(650,350,"font","  Request",15),shieldPerkText2=game.add.bitmapText(615,370,"font"," Shield Improvement",15)):population<110?(shopMessageBackground.x=196,shopMessageText.text="    Weaponsmith Perks unlock at 110 population."):(shopMessageBackground.x=196,shopMessageText.text=" The Weaponsmith offers upgrades every 30 minutes.")},wandPerk:function(){if(game.time.now>wandTimer){wandTimer=game.time.now+18e5,shieldTimer>game.time.now&&wandTimer>game.time.now&&(weaponsmithTimer=game.time.now+18e5);var a=5*Math.random();wandImage.animations.play("spin"),slotMachineSFX.play();var b=this;game.time.events.add(2*Phaser.Timer.SECOND,function(){a<=1.66?(wandShotPowerUpgrade=Math.round(baseChance+a),wandShotPowerUpgrade>wandShotPower?(shotPower+=.01*(wandShotPowerUpgrade-wandShotPower),wandShotPower=wandShotPowerUpgrade,wandImage.animations.stop(),wandImage.frame=0,wandPerkText.text="  Upgrade:",wandPerkText2.text="    Wand Power +"+wandShotPower,wandPowerText.text="Wand Power Bonus: "+wandShotPower,increaseSFX.play()):(wandPerkText.x=70,wandPerkText.text="No upgrade this time",weaponsmithDropReward+=weaponsmithDRBoost,b.dropRewardDiminishingReturns(),weaponsmithSkillLevelText.text="Weaponsmith Skill Level: "+Math.round(10*weaponsmithDropReward)/10,reduceSFX.play(),wandImage.animations.stop(),wandImage.frame=0)):a>=3.34?(wandShotSpeedUpgrade=Math.round(baseChance+a),wandShotSpeedUpgrade>wandShotSpeed?(shotSpeed+=(wandShotSpeedUpgrade-wandShotSpeed)/2,wandShotSpeed=wandShotSpeedUpgrade,wandImage.animations.stop(),wandImage.frame=2,wandPerkText.text="  Upgrade:",wandPerkText2.text=" Projectile Speed +"+wandShotSpeed,wandShotSpeedText.text="Wand Shot Speed Bonus: "+wandShotSpeed,b.bonusCheck(),increaseSFX.play()):(wandPerkText.x=70,wandPerkText.text="No upgrade this time",weaponsmithDropReward+=weaponsmithDRBoost,b.dropRewardDiminishingReturns(),weaponsmithSkillLevelText.text="Weaponsmith Skill Level: "+Math.round(10*weaponsmithDropReward)/10,reduceSFX.play(),wandImage.animations.stop(),wandImage.frame=2)):(wandBulletSpacingUpgrade=Math.round(baseChance+a),wandBulletSpacingUpgrade>wandBulletSpacing?(bulletSpacing-=(wandBulletSpacingUpgrade-wandBulletSpacing)/2.5,wandBulletSpacing=wandBulletSpacingUpgrade,wandImage.animations.stop(),wandImage.frame=4,wandPerkText.text="  Upgrade:",wandPerkText2.text="Wand Attack Speed +"+wandBulletSpacing,wandAttackSpeedText.text="Wand Attack Speed Bonus: "+wandBulletSpacing,increaseSFX.play()):(wandPerkText.x=70,wandPerkText.text="No upgrade this time",weaponsmithDropReward+=weaponsmithDRBoost,b.dropRewardDiminishingReturns(),weaponsmithSkillLevelText.text="Weaponsmith Skill Level: "+Math.round(10*weaponsmithDropReward)/10,reduceSFX.play(),wandImage.animations.stop(),wandImage.frame=4))})}},shieldPerk:function(){if(game.time.now>shieldTimer){shieldTimer=game.time.now+18e5,shieldTimer>game.time.now&&wandTimer>game.time.now&&(weaponsmithTimer=game.time.now+18e5);var a=5*Math.random();shieldImage.animations.play("spin"),slotMachineSFX.play();var b=this;game.time.events.add(2*Phaser.Timer.SECOND,function(){a<=1.66?(shieldKnockbackUpgrade=Math.round(baseChance+a),shieldKnockbackUpgrade>shieldKnockback?(knockback+=.1*(shieldKnockbackUpgrade-shieldKnockback),shieldKnockback=shieldKnockbackUpgrade,shieldImage.animations.stop(),shieldImage.frame=0,shieldPerkText.text="  Upgrade:",shieldPerkText2.text="Shield Knockback +"+shieldKnockback,shieldKnockbackText.text="Shield Knockback Bonus: "+shieldKnockback,increaseSFX.play()):(shieldPerkText.x=620,shieldPerkText.text="No upgrade this time",weaponsmithDropReward+=weaponsmithDRBoost,b.dropRewardDiminishingReturns(),weaponsmithSkillLevelText.text="Weaponsmith Skill Level: "+Math.round(10*weaponsmithDropReward)/10,reduceSFX.play(),shieldImage.animations.stop(),shieldImage.frame=0)):a>=3.34?(shieldMaxHealthUpgrade=Math.round((baseChance+a)/2),shieldMaxHealthUpgrade>shieldMaxHealth?(maxHealth+=shieldMaxHealthUpgrade-shieldMaxHealth,shieldMaxHealth=shieldMaxHealthUpgrade,shieldImage.animations.stop(),shieldImage.frame=2,shieldPerkText.text="  Upgrade:",shieldPerkText2.text="    Max Health +"+shieldMaxHealth,shieldHealthText.text="Shield Health Bonus: "+shieldMaxHealth,increaseSFX.play()):(shieldPerkText.x=620,shieldPerkText.text="No upgrade this time",weaponsmithDropReward+=weaponsmithDRBoost,b.dropRewardDiminishingReturns(),weaponsmithSkillLevelText.text="Weaponsmith Skill Level: "+Math.round(10*weaponsmithDropReward)/10,reduceSFX.play(),shieldImage.animations.stop(),shieldImage.frame=2)):(shieldInvulnerableSpacingUpgrade=Math.round(baseChance+a),shieldInvulnerableSpacingUpgrade>shieldInvulnerableSpacing?(invulnerableSpacing+=(shieldInvulnerableSpacingUpgrade-shieldInvulnerableSpacing)/2,shieldInvulnerableSpacing=shieldInvulnerableSpacingUpgrade,shieldImage.animations.stop(),shieldImage.frame=4,shieldPerkText.text="  Upgrade:",shieldPerkText2.text="Invincible Period +"+shieldInvulnerableSpacing,shieldInvulnerableText.text="Shield Invulnerable Bonus: "+shieldInvulnerableSpacing,increaseSFX.play()):(shieldPerkText.x=620,shieldPerkText.text="No upgrade this time",weaponsmithDropReward+=weaponsmithDRBoost,b.dropRewardDiminishingReturns(),weaponsmithSkillLevelText.text="Weaponsmith Skill Level: "+Math.round(10*weaponsmithDropReward)/10,reduceSFX.play(),shieldImage.animations.stop(),shieldImage.frame=4))})}},weaponsmithUpgrade:function(){if(coins>=weaponsmithUpgradeCost){coins-=weaponsmithUpgradeCost;var a=1.1+weaponsmithUpgradeCost/1e4;weaponsmithUpgradeCost=Math.round(weaponsmithUpgradeCost*a),weaponsmithDropReward+=weaponsmithDRBoost,this.dropRewardDiminishingReturns(),weaponsmithUpgradeCost>=1e6?weaponsmithUpgradeText.text=" Buy Skill Material: "+Math.round(weaponsmithUpgradeCost/1e5)/10+"M":weaponsmithUpgradeText.text=" Buy Skill Material: "+weaponsmithUpgradeCost,shopCoinsText.text=coins,weaponsmithSkillLevelText.text="Weaponsmith Skill Level: "+Math.round(10*weaponsmithDropReward)/10,increaseSFX.play(),this.weaponsmithImprove()}else shopMessageBackground.x=196,shopMessageText.text="                        Not enough coins.",reduceSFX.play()},armourerUpgrade:function(){if(coins>=armourerUpgradeCost){coins-=armourerUpgradeCost;var a=1.1+armourerUpgradeCost/1e4;armourerUpgradeCost=Math.round(armourerUpgradeCost*a),armourerDropReward+=armourerDRBoost,this.dropRewardDiminishingReturns(),armourerUpgradeCost>=1e6?armourerUpgradeText.text=" Buy Skill Material: "+Math.round(armourerUpgradeCost/1e5)/10+"M":armourerUpgradeText.text=" Buy Skill Material: "+armourerUpgradeCost,shopCoinsText.text=coins,armourerSkillLevelText.text="Armourer Skill Level: "+Math.round(10*armourerDropReward)/10,increaseSFX.play(),this.armourerImprove()}else shopMessageBackground.x=196,shopMessageText.text="                        Not enough coins.",reduceSFX.play()},enchanterUpgrade:function(){if(coins>=enchanterUpgradeCost){coins-=enchanterUpgradeCost;var a=1.1+enchanterUpgradeCost/1e4;enchanterUpgradeCost=Math.round(enchanterUpgradeCost*a),enchanterDropReward+=enchanterDRBoost,this.dropRewardDiminishingReturns(),enchanterUpgradeCost>=1e6?enchanterUpgradeText.text=" Buy Skill Material: "+Math.round(enchanterUpgradeCost/1e5)/10+"M":enchanterUpgradeText.text=" Buy Skill Material: "+enchanterUpgradeCost,shopCoinsText.text=coins,enchanterSkillLevelText.text="Enchanter Skill Level: "+Math.round(10*enchanterDropReward)/10,increaseSFX.play(),this.enchanterImprove()}else shopMessageBackground.x=196,shopMessageText.text="                        Not enough coins.",reduceSFX.play()},trainerUpgrade:function(){if(coins>=trainerUpgradeCost){coins-=trainerUpgradeCost;var a=1.1+trainerUpgradeCost/1e4;trainerUpgradeCost=Math.round(trainerUpgradeCost*a),trainerDropReward+=trainerDRBoost,this.dropRewardDiminishingReturns(),trainerUpgradeCost>=1e6?trainerUpgradeText.text=" Buy Skill Material: "+Math.round(trainerUpgradeCost/1e5)/10+"M":trainerUpgradeText.text=" Buy Skill Material: "+trainerUpgradeCost,shopCoinsText.text=coins,trainerSkillLevelText.text="Trainer Skill Level: "+Math.round(10*trainerDropReward)/10,increaseSFX.play(),this.trainerImprove()}else shopMessageBackground.x=196,shopMessageText.text="                        Not enough coins.",reduceSFX.play()},armourerImprove:function(){game.time.now>armourerTimer&&population>=125?(baseChance=Math.round((.15*popScore+.25*armourer+.6*armourerDropReward)/2),game.add.sprite(100,250,"border"),armourImage=game.add.sprite(108,258,"armourAnimation"),armourImage.frame=0,armourImage.animations.add("spin",[0,1,2,3,4,5],10,!0),armourPerkButton=game.add.button(30,330,"blankButton",this.armourPerk,this),armourPerkText=game.add.bitmapText(100,350,"font","    Request",15),armourPerkText2=game.add.bitmapText(65,370,"font","  Armour Improvement",15),game.add.sprite(380,250,"border"),hatImage=game.add.sprite(388,258,"hatAnimation"),hatImage.frame=0,hatImage.animations.add("spin",[0,1,2,3,4,5],10,!0),hatPerkButton=game.add.button(310,330,"blankButton",this.hatPerk,this),hatPerkText=game.add.bitmapText(380,350,"font","    Request",15),hatPerkText2=game.add.bitmapText(345,370,"font","   Crown Improvement",15),game.add.sprite(650,250,"border"),bootImage=game.add.sprite(658,258,"bootAnimation"),bootImage.frame=0,bootImage.animations.add("spin",[0,1,2,3,4,5],10,!0),bootPerkButton=game.add.button(580,330,"blankButton",this.bootPerk,this),bootPerkText=game.add.bitmapText(650,350,"font","    Request",15),bootPerkText2=game.add.bitmapText(615,370,"font","    Boots Improvement",15)):population<125?(shopMessageBackground.x=196,shopMessageText.text="     Armourer Perks unlock at 125 population."):(shopMessageBackground.x=196,shopMessageText.text="   The Armourer offers upgrades every 30 minutes.")},armourPerk:function(){if(game.time.now>armourTimer){armourTimer=game.time.now+18e5,bootTimer>game.time.now&&hatTimer>game.time.now&&armourTimer>game.time.now&&(armourerTimer=game.time.now+18e5);var a=5*Math.random();armourImage.animations.play("spin"),slotMachineSFX.play();var b=this;game.time.events.add(2*Phaser.Timer.SECOND,function(){a<=1.66?(armourMaxHealthUpgrade=Math.round((baseChance+a)/2),armourMaxHealthUpgrade>armourMaxHealth?(maxHealth+=armourMaxHealthUpgrade-armourMaxHealth,armourMaxHealth=armourMaxHealthUpgrade,armourImage.animations.stop(),armourImage.frame=0,armourPerkText.text="  Upgrade:",armourPerkText2.text="    Max Health +"+armourMaxHealth,armourHealthBonusText.text="Armour Health Bonus: "+armourMaxHealth,increaseSFX.play()):(armourPerkText.x=70,armourPerkText.text="No upgrade this time",armourerDropReward+=armourerDRBoost,b.dropRewardDiminishingReturns(),armourerSkillLevelText.text="Armourer Skill Level: "+Math.round(10*armourerDropReward)/10,reduceSFX.play(),armourImage.animations.stop(),armourImage.frame=0)):a>=3.34?(armourManaRegenIntervalUpgrade=Math.round(baseChance+a),armourManaRegenIntervalUpgrade>armourManaRegenInterval?(manaRegenHolder-=(armourManaRegenIntervalUpgrade-armourManaRegenInterval)/2,armourManaRegenInterval=armourManaRegenIntervalUpgrade,armourImage.animations.stop(),armourImage.frame=2,armourPerkText.text="  Upgrade:",armourPerkText2.text="Mana Regeneration +"+armourManaRegenInterval,armourManaRegenBonus.text="Armour Mana Regen Bonus: "+armourManaRegenInterval,increaseSFX.play(),b.bonusCheck()):(armourPerkText.x=70,armourPerkText.text="No upgrade this time",armourerDropReward+=armourerDRBoost,b.dropRewardDiminishingReturns(),armourerSkillLevelText.text="Armourer Skill Level: "+Math.round(10*armourerDropReward)/10,reduceSFX.play(),armourImage.animations.stop(),armourImage.frame=2)):(armourInvulnerableSpacingUpgrade=Math.round(baseChance+a),armourInvulnerableSpacingUpgrade>armourInvulnerableSpacing?(invulnerableSpacing+=(armourInvulnerableSpacingUpgrade-armourInvulnerableSpacing)/2,armourInvulnerableSpacing=armourInvulnerableSpacingUpgrade,armourImage.animations.stop(),armourImage.frame=4,armourPerkText.text="  Upgrade:",armourPerkText2.text=" Invincible Period +"+armourInvulnerableSpacing,armourInvulnerableText.text="Armour Invulnerable Bonus: "+armourInvulnerableSpacing,increaseSFX.play()):(armourPerkText.x=70,
armourPerkText.text="No upgrade this time",armourerDropReward+=armourerDRBoost,b.dropRewardDiminishingReturns(),armourerSkillLevelText.text="Armourer Skill Level: "+Math.round(10*armourerDropReward)/10,reduceSFX.play(),armourImage.animations.stop(),armourImage.frame=4))})}},hatPerk:function(){if(game.time.now>hatTimer){hatTimer=game.time.now+18e5,bootTimer>game.time.now&&hatTimer>game.time.now&&armourTimer>game.time.now&&(armourerTimer=game.time.now+18e5);var a=5*Math.random();hatImage.animations.play("spin"),slotMachineSFX.play();var b=this;game.time.events.add(2*Phaser.Timer.SECOND,function(){a<=1.66?(hatMaxHealthUpgrade=Math.round((baseChance+a)/2),hatMaxHealthUpgrade>hatMaxHealth?(maxHealth+=hatMaxHealthUpgrade-hatMaxHealth,hatMaxHealth=hatMaxHealthUpgrade,hatImage.animations.stop(),hatImage.frame=0,hatPerkText.text="  Upgrade:",hatPerkText2.text="    Max Health +"+hatMaxHealth,crownHealthText.text="Crown Health Bonus: "+hatMaxHealth,increaseSFX.play()):(hatPerkText.x=350,hatPerkText.text="No upgrade this time",armourerDropReward+=armourerDRBoost,b.dropRewardDiminishingReturns(),armourerSkillLevelText.text="Armourer Skill Level: "+Math.round(10*armourerDropReward)/10,reduceSFX.play(),hatImage.animations.stop(),hatImage.frame=0)):a>=3.34?(hatManaRegenIntervalUpgrade=Math.round(baseChance+a),hatManaRegenIntervalUpgrade>hatManaRegenInterval?(manaRegenHolder-=(hatManaRegenIntervalUpgrade-hatManaRegenInterval)/2,hatManaRegenInterval=hatManaRegenIntervalUpgrade,hatImage.animations.stop(),hatImage.frame=2,hatPerkText.text="  Upgrade:",hatPerkText2.text="Mana Regeneration +"+hatManaRegenInterval,crownManaRegenText.text="Crown Mana Regen Bonus: "+hatManaRegenInterval,increaseSFX.play(),b.bonusCheck()):(hatPerkText.x=350,hatPerkText.text="No upgrade this time",armourerDropReward+=armourerDRBoost,b.dropRewardDiminishingReturns(),armourerSkillLevelText.text="Armourer Skill Level: "+Math.round(10*armourerDropReward)/10,reduceSFX.play(),hatImage.animations.stop(),hatImage.frame=2)):(hatMaxManaUpgrade=Math.round(baseChance+a),hatMaxManaUpgrade>hatMaxMana?(maxMana+=hatMaxManaUpgrade-hatMaxMana,hatMaxMana=hatMaxManaUpgrade,hatImage.animations.stop(),hatImage.frame=4,hatPerkText.text="  Upgrade:",hatPerkText2.text="    Max Mana +"+hatMaxMana,crownManaText.text="Crown Mana Bonus: "+hatMaxMana,increaseSFX.play()):(hatPerkText.x=350,hatPerkText.text="No upgrade this time",armourerDropReward+=armourerDRBoost,b.dropRewardDiminishingReturns(),armourerSkillLevelText.text="Armourer Skill Level: "+Math.round(10*armourerDropReward)/10,reduceSFX.play(),hatImage.animations.stop(),hatImage.frame=4))})}},bootPerk:function(){if(game.time.now>bootTimer){bootTimer=game.time.now+18e5,bootTimer>game.time.now&&hatTimer>game.time.now&&armourTimer>game.time.now&&(armourerTimer=game.time.now+18e5);var a=5*Math.random();bootImage.animations.play("spin"),slotMachineSFX.play();var b=this;game.time.events.add(2*Phaser.Timer.SECOND,function(){a<=1.66?(bootRunSpeedUpgrade=Math.round(baseChance+a),bootRunSpeedUpgrade>bootRunSpeed?(runSpeed+=.1*(bootRunSpeedUpgrade-bootRunSpeed),bootRunSpeed=bootRunSpeedUpgrade,bootImage.animations.stop(),bootImage.frame=0,bootPerkText.text="  Upgrade:",bootPerkText2.text="     Run Speed +"+bootRunSpeed,bootsRunSpeedText.text="Boots Run Speed Bonus: "+bootRunSpeed,increaseSFX.play()):(bootPerkText.x=620,bootPerkText.text="No upgrade this time",armourerDropReward+=armourerDRBoost,b.dropRewardDiminishingReturns(),armourerSkillLevelText.text="Armourer Skill Level: "+Math.round(10*armourerDropReward)/10,reduceSFX.play(),bootImage.animations.stop(),bootImage.frame=0)):a>=3.34?(bootManaRegenIntervalUpgrade=Math.round(baseChance+a),bootManaRegenIntervalUpgrade>bootManaRegenInterval?(manaRegenHolder-=(bootManaRegenIntervalUpgrade-bootManaRegenInterval)/2,bootManaRegenInterval=bootManaRegenIntervalUpgrade,bootImage.animations.stop(),bootImage.frame=2,bootPerkText.text="  Upgrade:",bootPerkText2.text="Mana Regeneration +"+bootManaRegenInterval,bootManaRegenText.text="Boots Mana Regen Bonus: "+bootManaRegenInterval,increaseSFX.play(),b.bonusCheck()):(bootPerkText.x=620,bootPerkText.text="No upgrade this time",armourerDropReward+=armourerDRBoost,b.dropRewardDiminishingReturns(),armourerSkillLevelText.text="Armourer Skill Level: "+Math.round(10*armourerDropReward)/10,reduceSFX.play(),bootImage.animations.stop(),bootImage.frame=2)):(bootInvulnerableSpacingUpgrade=Math.round(baseChance+a),bootInvulnerableSpacingUpgrade>bootInvulnerableSpacing?(invulnerableSpacing+=(bootInvulnerableSpacingUpgrade-bootInvulnerableSpacing)/2,bootInvulnerableSpacing=bootInvulnerableSpacingUpgrade,bootImage.animations.stop(),bootImage.frame=4,bootPerkText.text="  Upgrade:",bootPerkText2.text=" Invincible Period +"+bootInvulnerableSpacing,bootsInvulnerableText.text="Boots Invulnerable Bonus: "+bootInvulnerableSpacing,increaseSFX.play()):(bootPerkText.x=620,bootPerkText.text="No upgrade this time",armourerDropReward+=armourerDRBoost,b.dropRewardDiminishingReturns(),armourerSkillLevelText.text="Armourer Skill Level: "+Math.round(10*armourerDropReward)/10,reduceSFX.play(),bootImage.animations.stop(),bootImage.frame=4))})}},enchanterImprove:function(){game.time.now>enchanterTimer&&population>=150?(baseChance=Math.round((.15*popScore+.25*enchanter+.6*enchanterDropReward)/2),game.add.sprite(100,250,"border"),ringImage=game.add.sprite(108,258,"ringAnimation"),ringImage.frame=0,ringImage.animations.add("spin",[0,1,2,3,4,5],10,!0),ringPerkButton=game.add.button(30,330,"blankButton",this.ringPerk,this),ringPerkText=game.add.bitmapText(100,350,"font","   Request",15),ringPerkText2=game.add.bitmapText(65,370,"font","   Ring Improvement",15),game.add.sprite(650,250,"border"),amuletImage=game.add.sprite(658,258,"amuletAnimation"),amuletImage.frame=0,amuletImage.animations.add("spin",[0,1,2,3,4,5],10,!0),amuletPerkButton=game.add.button(580,330,"blankButton",this.amuletPerk,this),amuletPerkText=game.add.bitmapText(650,350,"font","  Request",15),amuletPerkText2=game.add.bitmapText(615,370,"font","  Amulet Improvement",15)):population<150?(shopMessageBackground.x=196,shopMessageText.text="     Enchanter Perks unlock at 150 population."):(shopMessageBackground.x=196,shopMessageText.text="  The Enchanter offers upgrades every 30 minutes.")},ringPerk:function(){if(game.time.now>ringTimer){ringTimer=game.time.now+18e5,amuletTimer>game.time.now&&ringTimer>game.time.now&&(enchanterTimer=game.time.now+18e5);var a=5*Math.random();ringImage.animations.play("spin"),slotMachineSFX.play();var b=this;game.time.events.add(2*Phaser.Timer.SECOND,function(){a<=1.66?(ringShotPowerUpgrade=Math.round(baseChance+a),ringShotPowerUpgrade>ringShotPower?(shotPower+=.01*(ringShotPowerUpgrade-ringShotPower),ringShotPower=ringShotPowerUpgrade,ringImage.animations.stop(),ringImage.frame=0,ringPerkText.text="  Upgrade:",ringPerkText2.text="   Ring Power +"+ringShotPower,ringPowerText.text="Ring Power Bonus: "+ringShotPower,increaseSFX.play()):(ringPerkText.x=70,ringPerkText.text="No upgrade this time",enchanterDropReward+=enchanterDRBoost,b.dropRewardDiminishingReturns(),enchanterSkillLevelText.text="Enchanter Skill Level: "+Math.round(10*enchanterDropReward)/10,reduceSFX.play(),ringImage.animations.stop(),ringImage.frame=0)):a>=3.34?(ringMaxManaUpgrade=Math.round(baseChance+a),ringMaxManaUpgrade>ringMaxMana?(maxMana+=ringMaxManaUpgrade-ringMaxMana,ringMaxMana=ringMaxManaUpgrade,ringImage.animations.stop(),ringImage.frame=2,ringPerkText.text="  Upgrade:",ringPerkText2.text="     Max Mana +"+ringMaxMana,ringManaText.text="Ring Mana Bonus: "+ringMaxMana,increaseSFX.play()):(ringPerkText.x=70,ringPerkText.text="No upgrade this time",enchanterDropReward+=enchanterDRBoost,b.dropRewardDiminishingReturns(),enchanterSkillLevelText.text="Enchanter Skill Level: "+Math.round(10*enchanterDropReward)/10,reduceSFX.play(),ringImage.animations.stop(),ringImage.frame=2)):(ringKnockbackUpgrade=Math.round(baseChance+a),ringKnockbackUpgrade>ringKnockback?(knockback+=.1*(ringKnockbackUpgrade-ringKnockback),ringKnockback=ringKnockbackUpgrade,ringImage.animations.stop(),ringImage.frame=4,ringPerkText.text="  Upgrade:",ringPerkText2.text="   Knockback +"+ringKnockback,ringKnockbackText.text="Ring Knockback Bonus: "+ringKnockback,increaseSFX.play()):(ringPerkText.x=70,ringPerkText.text="No upgrade this time",enchanterDropReward+=enchanterDRBoost,b.dropRewardDiminishingReturns(),enchanterSkillLevelText.text="Enchanter Skill Level: "+Math.round(10*enchanterDropReward)/10,reduceSFX.play(),ringImage.animations.stop(),ringImage.frame=4))})}},amuletPerk:function(){if(game.time.now>amuletTimer){amuletTimer=game.time.now+18e5,amuletTimer>game.time.now&&ringTimer>game.time.now&&(enchanterTimer=game.time.now+18e5);var a=5*Math.random();amuletImage.animations.play("spin"),slotMachineSFX.play();var b=this;game.time.events.add(2*Phaser.Timer.SECOND,function(){a<=1.66?(amuletRunSpeedUpgrade=Math.round(baseChance+a),amuletRunSpeedUpgrade>amuletRunSpeed?(runSpeed+=.1*(amuletRunSpeedUpgrade-amuletRunSpeed),amuletRunSpeed=amuletRunSpeedUpgrade,amuletImage.animations.stop(),amuletImage.frame=0,amuletPerkText.text="  Upgrade:",amuletPerkText2.text="   Run Speed +"+amuletRunSpeed,amuletRunSpeedText.text="Amulet Run Speed Bonus: "+amuletRunSpeed,increaseSFX.play()):(amuletPerkText.x=620,amuletPerkText.text="No upgrade this time",enchanterDropReward+=enchanterDRBoost,b.dropRewardDiminishingReturns(),enchanterSkillLevelText.text="Enchanter Skill Level: "+Math.round(10*enchanterDropReward)/10,reduceSFX.play(),amuletImage.animations.stop(),amuletImage.frame=0)):a>=3.34?(amuletShotSpeedUpgrade=Math.round(baseChance+a),amuletShotSpeedUpgrade>amuletShotSpeed?(shotSpeed+=(amuletShotSpeedUpgrade-amuletShotSpeed)/2,amuletShotSpeed=amuletShotSpeedUpgrade,amuletImage.animations.stop(),amuletImage.frame=2,amuletPerkText.text="  Upgrade:",amuletPerkText2.text="   Shot Speed +"+amuletShotSpeed,amuletShotSpeedText.text="Amulet Shot Speed Bonus: "+amuletShotSpeed,increaseSFX.play(),b.bonusCheck()):(amuletPerkText.x=620,amuletPerkText.text="No upgrade this time",enchanterDropReward+=enchanterDRBoost,b.dropRewardDiminishingReturns(),enchanterSkillLevelText.text="Enchanter Skill Level: "+Math.round(10*enchanterDropReward)/10,reduceSFX.play(),amuletImage.animations.stop(),amuletImage.frame=2)):(amuletBulletSpacingUpgrade=Math.round(baseChance+a),amuletBulletSpacingUpgrade>amuletBulletSpacing?(bulletSpacing-=(amuletBulletSpacingUpgrade-amuletBulletSpacing)/2.5,amuletBulletSpacing=amuletBulletSpacingUpgrade,amuletImage.animations.stop(),amuletImage.frame=4,amuletPerkText.text="  Upgrade:",amuletPerkText2.text="  Attack Speed +"+amuletBulletSpacing,amuletAttackSpeedText.text="Amulet Attack Speed Bonus: "+amuletBulletSpacing,increaseSFX.play()):(amuletPerkText.x=620,amuletPerkText.text="No upgrade this time",enchanterDropReward+=enchanterDRBoost,b.dropRewardDiminishingReturns(),enchanterSkillLevelText.text="Enchanter Skill Level: "+Math.round(10*enchanterDropReward)/10,reduceSFX.play(),amuletImage.animations.stop(),amuletImage.frame=4))})}},trainerImprove:function(){game.time.now>trainerTimer&&population>=200?(baseChance=Math.round((.15*popScore+.25*trainer+.6*trainerDropReward)/2),game.add.sprite(100,250,"border"),skillImage=game.add.sprite(108,258,"skillAnimation"),skillImage.frame=0,skillImage.animations.add("spin",[0,1,2,3,4,5],10,!0),skillPerkButton=game.add.button(30,330,"blankButton",this.skillPerk,this),skillPerkText=game.add.bitmapText(100,350,"font","  Request",15),skillPerkText2=game.add.bitmapText(65,370,"font","       Skill Training",15),game.add.sprite(650,250,"border"),enduranceImage=game.add.sprite(658,258,"enduranceAnimation"),enduranceImage.frame=0,enduranceImage.animations.add("spin",[0,1,2,3,4,5],10,!0),endurancePerkButton=game.add.button(580,330,"blankButton",this.endurancePerk,this),endurancePerkText=game.add.bitmapText(650,350,"font","  Request",15),endurancePerkText2=game.add.bitmapText(615,370,"font","    Stamina Training",15)):population<200?(shopMessageBackground.x=196,shopMessageText.text="       Trainer Perks unlock at 200 population."):(shopMessageBackground.x=196,shopMessageText.text="   The Trainer offers upgrades every 30 minutes.")},skillPerk:function(){if(game.time.now>skillTimer){skillTimer=game.time.now+18e5,enduranceTimer>game.time.now&&skillTimer>game.time.now&&(trainerTimer=game.time.now+18e5);var a=5*Math.random();skillImage.animations.play("spin"),slotMachineSFX.play();var b=this;game.time.events.add(2*Phaser.Timer.SECOND,function(){a<=1.66?(skillShotPowerUpgrade=Math.round(baseChance+a),skillShotPowerUpgrade>skillShotPower?(shotPower+=.01*(skillShotPowerUpgrade-skillShotPower),skillShotPower=skillShotPowerUpgrade,skillImage.animations.stop(),skillImage.frame=0,skillPerkText.text="  Upgrade:",skillPerkText2.text="    Skill Power +"+skillShotPower,skillPowerText.text="Skill Power Bonus: "+skillShotPower,increaseSFX.play()):(skillPerkText.x=70,skillPerkText.text="No upgrade this time",trainerDropReward+=trainerDRBoost,b.dropRewardDiminishingReturns(),trainerSkillLevelText.text="Trainer Skill Level: "+Math.round(10*trainerDropReward)/10,reduceSFX.play(),skillImage.animations.stop(),skillImage.frame=0)):a>=3.34?(skillMaxManaUpgrade=Math.round(baseChance+a),skillMaxManaUpgrade>skillMaxMana?(maxMana+=skillMaxManaUpgrade-skillMaxMana,skillMaxMana=skillMaxManaUpgrade,skillImage.animations.stop(),skillImage.frame=2,skillPerkText.text="  Upgrade:",skillPerkText2.text="    Max Mana +"+skillMaxMana,skillManaText.text="Skill Mana Bonus: "+skillMaxMana,increaseSFX.play()):(skillPerkText.x=70,skillPerkText.text="No upgrade this time",trainerDropReward+=trainerDRBoost,b.dropRewardDiminishingReturns(),trainerSkillLevelText.text="Trainer Skill Level: "+Math.round(10*trainerDropReward)/10,reduceSFX.play(),skillImage.animations.stop(),skillImage.frame=2)):(skillKnockbackUpgrade=Math.round(baseChance+a),skillKnockbackUpgrade>skillKnockback?(knockback+=.1*(skillKnockbackUpgrade-skillKnockback),skillKnockback=skillKnockbackUpgrade,skillImage.animations.stop(),skillImage.frame=4,skillPerkText.text="  Upgrade:",skillPerkText2.text="   Knockback +"+skillKnockback,skillKnockbackText.text="Skill Knockback Bonus: "+skillKnockback,increaseSFX.play()):(skillPerkText.x=70,skillPerkText.text="No upgrade this time",trainerDropReward+=trainerDRBoost,b.dropRewardDiminishingReturns(),trainerSkillLevelText.text="Trainer Skill Level: "+Math.round(10*trainerDropReward)/10,reduceSFX.play(),skillImage.animations.stop(),skillImage.frame=4))})}},endurancePerk:function(){if(game.time.now>enduranceTimer){enduranceTimer=game.time.now+18e5,enduranceTimer>game.time.now&&skillTimer>game.time.now&&(trainerTimer=game.time.now+18e5);var a=5*Math.random();enduranceImage.animations.play("spin"),slotMachineSFX.play();var b=this;game.time.events.add(2*Phaser.Timer.SECOND,function(){a<=1.66?(enduranceRunSpeedUpgrade=Math.round(baseChance+a),enduranceRunSpeedUpgrade>enduranceRunSpeed?(runSpeed+=.1*(enduranceRunSpeedUpgrade-enduranceRunSpeed),enduranceRunSpeed=enduranceRunSpeedUpgrade,enduranceImage.animations.stop(),enduranceImage.frame=0,endurancePerkText.text="  Upgrade:",endurancePerkText2.text="   Run Speed +"+enduranceRunSpeed,staminaRunSpeedText.text="Stamina Run Speed Bonus: "+enduranceRunSpeed,increaseSFX.play()):(endurancePerkText.x=620,endurancePerkText.text="No upgrade this time",trainerDropReward+=trainerDRBoost,b.dropRewardDiminishingReturns(),trainerSkillLevelText.text="Trainer Skill Level: "+Math.round(10*trainerDropReward)/10,reduceSFX.play(),enduranceImage.animations.stop(),enduranceImage.frame=0)):a>=3.34?(enduranceShotSpeedUpgrade=Math.round(baseChance+a),enduranceShotSpeedUpgrade>enduranceShotSpeed?(shotSpeed+=(enduranceShotSpeedUpgrade-enduranceShotSpeed)/2,enduranceShotSpeed=enduranceShotSpeedUpgrade,enduranceImage.animations.stop(),enduranceImage.frame=2,endurancePerkText.text="  Upgrade:",endurancePerkText2.text="   Shot Speed +"+enduranceShotSpeed,staminaShotSpeedText.text="Stamina Shot Speed Bonus: "+enduranceShotSpeed,increaseSFX.play(),b.bonusCheck()):(endurancePerkText.x=620,endurancePerkText.text="No upgrade this time",trainerDropReward+=trainerDRBoost,b.dropRewardDiminishingReturns(),trainerSkillLevelText.text="Trainer Skill Level: "+Math.round(10*trainerDropReward)/10,reduceSFX.play(),enduranceImage.animations.stop(),enduranceImage.frame=2)):(enduranceBulletSpacingUpgrade=Math.round(baseChance+a),enduranceBulletSpacingUpgrade>enduranceBulletSpacing?(bulletSpacing-=(enduranceBulletSpacingUpgrade-enduranceBulletSpacing)/2.5,enduranceBulletSpacing=enduranceBulletSpacingUpgrade,enduranceImage.animations.stop(),enduranceImage.frame=4,endurancePerkText.text="  Upgrade:",endurancePerkText2.text="   Attack Speed +"+enduranceBulletSpacing,staminaAttackSpeedText.text="Stamina Attack Speed Bonus: "+enduranceBulletSpacing,increaseSFX.play()):(endurancePerkText.x=620,endurancePerkText.text="No upgrade this time",trainerDropReward+=trainerDRBoost,b.dropRewardDiminishingReturns(),trainerSkillLevelText.text="Trainer Skill Level: "+Math.round(10*trainerDropReward)/10,reduceSFX.play(),enduranceImage.animations.stop(),enduranceImage.frame=4))})}},collectSFX:function(){var a=game.add.audio("collect");a.play()},shopLeft:function(){switch(shop){case"castle":shop="trainer",this.create();break;case"housing":shop="castle",this.create();break;case"commercial":shop="housing",this.create();break;case"industrial":shop="commercial",this.create();break;case"education":shop="industrial",this.create();break;case"health":shop="education",this.create();break;case"justice":shop="health",this.create();break;case"defence":shop="justice",this.create();break;case"utilities":shop="defence",this.create();break;case"weaponsmith":shop="utilities",this.create();break;case"armourer":shop="weaponsmith",this.create();break;case"enchanter":shop="armourer",this.create();break;case"trainer":shop="enchanter",this.create()}},shopRight:function(){switch(shop){case"castle":shop="housing",this.create();break;case"housing":shop="commercial",this.create();break;case"commercial":shop="industrial",this.create();break;case"industrial":shop="education",this.create();break;case"education":shop="health",this.create();break;case"health":shop="justice",this.create();break;case"justice":shop="defence",this.create();break;case"defence":shop="utilities",this.create();break;case"utilities":shop="weaponsmith",this.create();break;case"weaponsmith":shop="armourer",this.create();break;case"armourer":shop="enchanter",this.create();break;case"enchanter":shop="trainer",this.create();break;case"trainer":shop="castle",this.create()}},shopTextSelect:function(){if("castle"==shop);else if(maxFunding||wellfunded)shopText.text=" Your Majesty!",shopText2.text="   Our funding levels",shopText3.text="     are most satisfactory.",shopText4.text="    We will endeavour to ",shopText5.text="      justify your faith",shopText6.text="         in us.";else if(priorityService)shopText.text=" Your Majesty!",shopText2.text=" We humbly request an",shopText3.text="    increase in funding. To",shopText4.text="provide an adequate service",shopText5.text="     we need a funding",shopText6.text="      level of "+happiness+".";else{if(happiness<100)var a=1;else a=0;shopText.text=" Your Majesty!",shopText2.text=" We humbly request an",shopText3.text="    increase in funding. To",shopText4.text="provide an adequate service",shopText5.text="     we need a funding",shopText6.text=" level of at least "+(averageFunding+a)+"."}},nextYearEstimate:function(){nextHousing=housing+(housingFunding-housing)/12,nextCommercial=commercial+(commercialFunding-commercial)/12,nextIndustrial=industrial+(industrialFunding-industrial)/12,nextEducation=education+(educationFunding-education)/12,nextPopHealth=popHealth+(healthFunding-popHealth)/12,nextJustice=justice+(justiceFunding-justice)/12,nextDefence=defence+(defenceFunding-defence)/12,nextUtilities=utilities+(utilitiesFunding-utilities)/12,nextWeaponsmith=weaponsmith+(weaponsmithFunding-weaponsmith)/12,nextArmourer=armourer+(armourerFunding-armourer)/12,nextEnchanter=enchanter+(enchanterFunding-enchanter)/12,nextTrainer=trainer+(trainerFunding-trainer)/12,nextPopulation=population,nextPopulation+=population*((nextHousing-33)/4e3),nextPopulation+=population*((nextEducation-33)/9e3),nextPopulation+=population*((nextPopHealth-33)/2e3),nextPopulation+=population*((nextJustice-33)/13e3),nextPopulation+=population*((nextDefence-33)/14e3),nextPopulation+=population*((nextUtilities-33)/9e3),nextPopulation+=population*((nextTrainer-33)/14300),nextPopulation-=population*((tax-30)/2e3),nextYear=year+1,nextPopulation+=year+1<=30?1+(year+1)/10:9-(year+1)/6,nextPopulation>5e6?(nextCoins+=nextPopulation-5e6,nextPopulation=5e6):nextPopulation=nextPopulation>0?Math.round(nextPopulation):0,nextHappiness=Math.round(20+questHappinessModifier+4*(nextHousing/15+nextCommercial/100+nextIndustrial/100+nextEducation/100+nextPopHealth/15+nextJustice/20+nextDefence/100+nextUtilities/80)),nextHappiness>100&&(nextHappiness=100),nextEconomyMod=1,nextEconomyMod+=(nextCommercial-34)/950,nextEconomyMod+=(nextIndustrial-34)/950,nextEconomyMod+=(nextEducation-34)/950,nextEconomyMod+=(nextJustice-34)/6e3,nextEconomyMod+=(nextWeaponsmith-34)/5e3,nextEconomyMod+=(nextArmourer-34)/5e3,nextEconomyMod+=(nextEnchanter-34)/5e3,nextEconomyMod+=(nextTrainer-34)/6e3,nextEconomyMod+=(nextUtilities-33)/9e3,nextEconomyMod-=(tax-30)/3e3,nextIncome=income,nextIncome=nextPopulation*nextEconomyMod*(1.17*tax),nextExpenditure=totalFunding*(4.45+(year+1)/22)+nextPopulation*(totalFunding/19),nextNetIncome=netIncome,nextNetIncome=nextIncome-nextExpenditure,nextCoins=coins,nextCoins+=Math.round(nextNetIncome),nextYearStatText.text="Year: "+nextYear,nextPopulationStatText.text="Population: "+nextPopulation,nextIncomeStatText.text="Income: "+Math.round(nextIncome),nextExpenditureStatText.text="Expenditure: "+Math.round(nextExpenditure),nextNetIncomeStatText.text="Net Income: "+Math.round(nextNetIncome),nextBalanceStatText.text="Balance: "+nextCoins},dropRewardDiminishingReturns:function(){weaponsmithDRBoost=weaponsmithDropReward<=10?1:weaponsmithDropReward<=25?.75:weaponsmithDropReward<=50?.5:weaponsmithDropReward<=100?.33:weaponsmithDropReward<=1e3?.25:.2,armourerDRBoost=armourerDropReward<=10?1:armourerDropReward<=25?.75:armourerDropReward<=50?.5:armourerDropReward<=100?.33:armourerDropReward<=1e3?.25:.2,enchanterDRBoost=enchanterDropReward<=10?1:enchanterDropReward<=25?.75:enchanterDropReward<=50?.5:enchanterDropReward<=100?.33:enchanterDropReward<=1e3?.25:.2,trainerDRBoost=trainerDropReward<=10?1:trainerDropReward<=25?.75:trainerDropReward<=50?.5:trainerDropReward<=100?.33:trainerDropReward<=1e3?.25:.2},bonusUnlock:function(){game.add.button(350,469,"assistant",this.create,this),game.add.button(150,469,"speechBubble",this.create,this);switch(bonusType){case"beam":var c=game.add.bitmapText(200,477,"fontBorder","Great news!",15),d=game.add.bitmapText(170,494,"fontBorder","  Your artisans have ",15),e=game.add.bitmapText(158,509,"fontBorder","worked together to unlock ",15),f=game.add.bitmapText(158,524,"fontBorder","the power of beam magic. ",15),g=game.add.bitmapText(170,539,"fontBorder","  Press SPACE to use ",15),h=game.add.bitmapText(190,554,"fontBorder"," while questing!",15);beamUnlockShown=!0,beamWeapon=!0;break;case"manaRefill":c=game.add.bitmapText(200,477,"fontBorder","Great news!",15),d=game.add.bitmapText(170,494,"fontBorder","  Your artisans have ",15),e=game.add.bitmapText(158,509,"fontBorder","  worked together to unlock ",15),f=game.add.bitmapText(158,524,"fontBorder","  the power of mana refills. ",15),g=game.add.bitmapText(170,539,"fontBorder"," Press Q during a quest ",15),h=game.add.bitmapText(190,554,"fontBorder","to refill your mana.",15),manaRefillUnlockShown=!0,manaRefillAvailable=!0}c.tint=0,d.tint=0,e.tint=0,f.tint=0,g.tint=0,h.tint=0},bonusCheck:function(){wandShotSpeed+amuletShotSpeed+enduranceShotSpeed>30&&0==beamUnlockShown&&(bonusType="beam",this.bonusUnlock()),armourManaRegenInterval+hatManaRegenInterval+bootManaRegenInterval>40&&0==manaRefillUnlockShown&&(bonusType="manaRefill",this.bonusUnlock())}},wallEdgeArray=[0,1,2,3,4],wallArray=[1,3,4,6,7,8,9,10,11,12,13,14,15,16,17,19,20,21,22,23,24],torchArray=[1,3,9,13,17,19],barriers,targets,lights,soundTriggers,tutorialPractice="first",tutorialPracticeSprite,tutorialPracticeSpeechBubble,tutorialPracticeText="",tutorialPracticeText2="",tutorialPracticeText3="",tutorialPracticeText4="",tutorialPracticeText5="",tutorialPracticeText6="",trainerSpeechBubble,trainerText="",trainerText2="",trainerText3="",trainerText4="",trainerText5="",trainerText6="",nextPractice="right",tutorialMusic,tutorialMusicPlaying,successSFX,buttonWalkLeftTop,buttonWalkLeftBottom,buttonWalkRightTop,buttonWalkRightBottom,buttonWalkUpLeft,buttonWalkUpRight,buttonWalkDownLeft,buttonWalkDownRight,buttonFireLeftTop,buttonFireLeftBottom,buttonFireRightTop,buttonFireRightBottom,buttonFireUpLeft,buttonFireUpRight,buttonFireDownLeft,buttonFireDownRight,tutorialState={create:function(){game.add.sprite(0,0,"tutorialBackground"),game.physics.startSystem(Phaser.Physics.ARCADE),1!=tutorialMusicPlaying&&(tutorialMusic=game.add.audio("tutorialMusic"),tutorialMusic.allowMultiple=!1,tutorialMusic.play(),tutorialMusicPlaying=!0),player=game.add.sprite(224,126,"dude"),successSFX=game.add.audio("collect"),game.physics.arcade.enable(player),player.body.setSize(26,30,3,3),player.body.collideWorldBounds=!0,player.isAlive=!0,player.animations.add("left",[9,10,11],10,!0),player.animations.add("right",[3,4,5],10,!0),player.animations.add("up",[0,1,2],10,!0),player.animations.add("down",[6,7,8],10,!0),player.animations.add("stop",[4],10,!0),player.animations.play("stop"),bullets=game.add.group(),bullets.enableBody=!0,barriers=game.add.group(),barriers.enableBody=!0,targets=game.add.group(),targets.enableBody=!0,soundTriggers=game.add.group(),soundTriggers.enableBody=!0,lights=game.add.group();for(var a=0;a<wallEdgeArray.length;a++){var b=barriers.create(128,32*wallEdgeArray[a],"tutorialBarriers32x32");b.frame=4,b.body.immovable=!0;var c=barriers.create(352,32*wallEdgeArray[a],"tutorialBarriers32x32");c.frame=5,c.body.immovable=!0}for(var a=0;a<wallArray.length;a++){var d=barriers.create(32*wallArray[a],160,"tutorialBarriers32x32");d.frame=0,d.body.immovable=!0,a>2&&a<7&&(d=barriers.create(32*wallArray[a],96,"tutorialBarriers32x32"),d.frame=0,d.body.immovable=!0,d=barriers.create(32*wallArray[a],0,"tutorialBarriers32x32"),d.frame=0,d.body.immovable=!0)}d=barriers.create(160,0,"tutorialBarriers32x32"),d.frame=0,d.body.immovable=!0,d=barriers.create(320,0,"tutorialBarriers32x32"),d.frame=0,d.body.immovable=!0;var e=barriers.create(288,64,"tutorialBarriers32x32");e.frame=2,e.body.immovable=!0;var f=barriers.create(192,64,"tutorialBarriers32x32");f.frame=3,f.body.immovable=!0,f=barriers.create(224,64,"tutorialBarriers32x32"),f.frame=3,f.body.immovable=!0,f=barriers.create(256,64,"tutorialBarriers32x32"),f.frame=3,f.body.immovable=!0;var g=barriers.create(0,160,"tutorialBarriers32x32");g.frame=6,g.body.immovable=!0,g=barriers.create(790,160,"tutorialBarriers32x32"),g.frame=6,g.body.immovable=!0;var h=barriers.create(64,160,"tutorialBarriers32x32");h.frame=1,h.body.immovable=!0,h=barriers.create(576,160,"tutorialBarriers32x32"),h.frame=1,h.body.immovable=!0;var i=barriers.create(192,116,"tutorialObstacles32x44");i.frame=0,i.body.immovable=!0;var j=soundTriggers.create(320,128,"tutorialBarriers32x32");j.visible=!1,j=soundTriggers.create(320,32,"tutorialBarriers32x32"),j.visible=!1,j=soundTriggers.create(160,32,"tutorialBarriers32x32"),j.visible=!1,j=soundTriggers.create(160,192,"tutorialBarriers32x32"),j.visible=!1;var k=targets.create(64,352,"tutorialObstacles32x44");k.frame=1,k.body.immovable=!0,k=targets.create(64,446,"tutorialObstacles32x44"),k.frame=1,k.body.immovable=!0,k=targets.create(288,256,"tutorialObstacles32x44"),k.frame=1,k.body.immovable=!0,k=targets.create(288,544,"tutorialObstacles32x44"),k.frame=1,k.body.immovable=!0,k=targets.create(512,256,"tutorialObstacles32x44"),k.frame=1,k.body.immovable=!0,k=targets.create(512,544,"tutorialObstacles32x44"),k.frame=1,k.body.immovable=!0,k=targets.create(768,352,"tutorialObstacles32x44"),k.frame=1,k.body.immovable=!0,k=targets.create(768,446,"tutorialObstacles32x44"),k.frame=1,k.body.immovable=!0;var l=game.add.sprite(196,2,"tutorialDecorations36x32");l.frame=1,l=game.add.sprite(352,162,"tutorialDecorations36x32"),l.frame=1,l=game.add.sprite(672,162,"tutorialDecorations36x32"),l.frame=1;var m=game.add.sprite(286,2,"tutorialDecorations36x32");m.frame=0,m=game.add.sprite(224,162,"tutorialDecorations36x32"),m.frame=0,m=game.add.sprite(478,162,"tutorialDecorations36x32"),m.frame=0,m=game.add.sprite(734,162,"tutorialDecorations36x32"),m.frame=0;for(var a=0;a<torchArray.length;a++)this.torchCreate(32*torchArray[a],160,"centre");this.trainerText(),this.tutorialPracticeText(),this.torchCreate(-4,288,"left"),this.torchCreate(-4,544,"left"),this.torchCreate(799,288,"right"),this.torchCreate(799,544,"right"),cursors=game.input.keyboard.createCursorKeys(),spaceBar=game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),wKey=game.input.keyboard.addKey(Phaser.Keyboard.W),aKey=game.input.keyboard.addKey(Phaser.Keyboard.A),sKey=game.input.keyboard.addKey(Phaser.Keyboard.S),dKey=game.input.keyboard.addKey(Phaser.Keyboard.D),game.device.desktop||(buttonWalkLeft=game.add.button(20,470,"leftControl",null,this,0,1,0,1),buttonWalkLeft.alpha=.4,buttonWalkLeft.events.onInputOver.add(function(){walkLeft=!0}),buttonWalkLeft.events.onInputOut.add(function(){walkLeft=!1}),buttonWalkLeft.events.onInputDown.add(function(){walkLeft=!0}),buttonWalkLeft.events.onInputUp.add(function(){walkLeft=!1}),buttonWalkLeftTop=game.add.button(20,430,"controlLeftRight",null,this,0,1,0,1),buttonWalkLeftTop.alpha=0,buttonWalkLeftTop.setFrames(3,3,3),buttonWalkLeftTop.events.onInputOver.add(function(){walkLeft=!0}),buttonWalkLeftTop.events.onInputOut.add(function(){walkLeft=!1}),buttonWalkLeftTop.events.onInputDown.add(function(){walkLeft=!0}),buttonWalkLeftTop.events.onInputUp.add(function(){walkLeft=!1}),buttonWalkLeftBottom=game.add.button(20,540,"controlLeftRight",null,this,0,1,0,1),buttonWalkLeftBottom.alpha=0,buttonWalkLeftBottom.setFrames(2,2,2),buttonWalkLeftBottom.events.onInputOver.add(function(){walkLeft=!0}),buttonWalkLeftBottom.events.onInputOut.add(function(){walkLeft=!1}),buttonWalkLeftBottom.events.onInputDown.add(function(){walkLeft=!0}),buttonWalkLeftBottom.events.onInputUp.add(function(){walkLeft=!1}),buttonWalkRight=game.add.button(165,470,"rightControl",null,this,0,1,0,1),buttonWalkRight.alpha=.4,buttonWalkRight.events.onInputOver.add(function(){walkRight=!0}),buttonWalkRight.events.onInputOut.add(function(){walkRight=!1}),buttonWalkRight.events.onInputDown.add(function(){walkRight=!0}),buttonWalkRight.events.onInputUp.add(function(){walkRight=!1}),buttonWalkRightTop=game.add.button(165,430,"controlLeftRight",null,this,0,1,0,1),buttonWalkRightTop.alpha=0,buttonWalkRightTop.setFrames(0,0,0),buttonWalkRightTop.events.onInputOver.add(function(){walkRight=!0}),buttonWalkRightTop.events.onInputOut.add(function(){walkRight=!1}),buttonWalkRightTop.events.onInputDown.add(function(){walkRight=!0}),buttonWalkRightTop.events.onInputUp.add(function(){walkRight=!1}),buttonWalkRightBottom=game.add.button(165,540,"controlLeftRight",null,this,0,1,0,1),buttonWalkRightBottom.alpha=0,buttonWalkRightBottom.setFrames(1,1,1),buttonWalkRightBottom.events.onInputOver.add(function(){walkRight=!0}),buttonWalkRightBottom.events.onInputOut.add(function(){walkRight=!1}),buttonWalkRightBottom.events.onInputDown.add(function(){walkRight=!0}),buttonWalkRightBottom.events.onInputUp.add(function(){walkRight=!1}),buttonWalkUp=game.add.button(95,417,"rightControl",null,this,0,1,0,1),buttonWalkUp.alpha=.4,buttonWalkUp.rotation=-1.57,buttonWalkUp.anchor.setTo(.75,0),
buttonWalkUp.events.onInputOver.add(function(){walkUp=!0}),buttonWalkUp.events.onInputOut.add(function(){walkUp=!1}),buttonWalkUp.events.onInputDown.add(function(){walkUp=!0}),buttonWalkUp.events.onInputUp.add(function(){walkUp=!1}),buttonWalkUpLeft=game.add.button(50,400,"controlUpDown",null,this,0,1,0,1),buttonWalkUpLeft.alpha=0,buttonWalkUpLeft.setFrames(3,3,3),buttonWalkUpLeft.events.onInputOver.add(function(){walkUp=!0}),buttonWalkUpLeft.events.onInputOut.add(function(){walkUp=!1}),buttonWalkUpLeft.events.onInputDown.add(function(){walkUp=!0}),buttonWalkUpLeft.events.onInputUp.add(function(){walkUp=!1}),buttonWalkUpRight=game.add.button(165,400,"controlUpDown",null,this,0,1,0,1),buttonWalkUpRight.alpha=0,buttonWalkUpRight.setFrames(2,2,2),buttonWalkUpRight.events.onInputOver.add(function(){walkUp=!0}),buttonWalkUpRight.events.onInputOut.add(function(){walkUp=!1}),buttonWalkUpRight.events.onInputDown.add(function(){walkUp=!0}),buttonWalkUpRight.events.onInputUp.add(function(){walkUp=!1}),buttonWalkDown=game.add.button(95,560,"leftControl",null,this,0,1,0,1),buttonWalkDown.alpha=.4,buttonWalkDown.rotation=-1.57,buttonWalkDown.anchor.setTo(.75,0),buttonWalkDown.events.onInputOver.add(function(){walkDown=!0}),buttonWalkDown.events.onInputOut.add(function(){walkDown=!1}),buttonWalkDown.events.onInputDown.add(function(){walkDown=!0}),buttonWalkDown.events.onInputUp.add(function(){walkDown=!1}),buttonWalkDownLeft=game.add.button(50,540,"controlUpDown",null,this,0,1,0,1),buttonWalkDownLeft.alpha=0,buttonWalkDownLeft.setFrames(1,1,1),buttonWalkDownLeft.events.onInputOver.add(function(){walkDown=!0}),buttonWalkDownLeft.events.onInputOut.add(function(){walkDown=!1}),buttonWalkDownLeft.events.onInputDown.add(function(){walkDown=!0}),buttonWalkDownLeft.events.onInputUp.add(function(){walkDown=!1}),buttonWalkDownRight=game.add.button(165,540,"controlUpDown",null,this,0,1,0,1),buttonWalkDownRight.alpha=0,buttonWalkDownRight.setFrames(0,0,0),buttonWalkDownRight.events.onInputOver.add(function(){walkDown=!0}),buttonWalkDownRight.events.onInputOut.add(function(){walkDown=!1}),buttonWalkDownRight.events.onInputDown.add(function(){walkDown=!0}),buttonWalkDownRight.events.onInputUp.add(function(){walkDown=!1}),buttonFireLeft=game.add.button(587,470,"leftControl",null,this,0,1,0,1),buttonFireLeft.alpha=.4,buttonFireLeft.events.onInputOver.add(function(){fireLeft=!0}),buttonFireLeft.events.onInputOut.add(function(){fireLeft=!1}),buttonFireLeft.events.onInputDown.add(function(){fireLeft=!0}),buttonFireLeft.events.onInputUp.add(function(){fireLeft=!1}),buttonFireLeftTop=game.add.button(587,430,"controlLeftRight",null,this,0,1,0,1),buttonFireLeftTop.alpha=0,buttonFireLeftTop.setFrames(3,3,3),buttonFireLeftTop.events.onInputOver.add(function(){fireLeft=!0}),buttonFireLeftTop.events.onInputOut.add(function(){fireLeft=!1}),buttonFireLeftTop.events.onInputDown.add(function(){fireLeft=!0}),buttonFireLeftTop.events.onInputUp.add(function(){fireLeft=!1}),buttonFireLeftBottom=game.add.button(587,540,"controlLeftRight",null,this,0,1,0,1),buttonFireLeftBottom.alpha=0,buttonFireLeftBottom.setFrames(2,2,2),buttonFireLeftBottom.events.onInputOver.add(function(){fireLeft=!0}),buttonFireLeftBottom.events.onInputOut.add(function(){fireLeft=!1}),buttonFireLeftBottom.events.onInputDown.add(function(){fireLeft=!0}),buttonFireLeftBottom.events.onInputUp.add(function(){fireLeft=!1}),buttonFireRight=game.add.button(732,470,"rightControl",null,this,0,1,0,1),buttonFireRight.alpha=.4,buttonFireRight.events.onInputOver.add(function(){fireRight=!0}),buttonFireRight.events.onInputOut.add(function(){fireRight=!1}),buttonFireRight.events.onInputDown.add(function(){fireRight=!0}),buttonFireRight.events.onInputUp.add(function(){fireRight=!1}),buttonFireRightTop=game.add.button(732,430,"controlLeftRight",null,this,0,1,0,1),buttonFireRightTop.alpha=0,buttonFireRightTop.setFrames(0,0,0),buttonFireRightTop.events.onInputOver.add(function(){fireRight=!0}),buttonFireRightTop.events.onInputOut.add(function(){fireRight=!1}),buttonFireRightTop.events.onInputDown.add(function(){fireRight=!0}),buttonFireRightTop.events.onInputUp.add(function(){fireRight=!1}),buttonFireRightBottom=game.add.button(732,540,"controlLeftRight",null,this,0,1,0,1),buttonFireRightBottom.alpha=0,buttonFireRightBottom.setFrames(1,1,1),buttonFireRightBottom.events.onInputOver.add(function(){fireRight=!0}),buttonFireRightBottom.events.onInputOut.add(function(){fireRight=!1}),buttonFireRightBottom.events.onInputDown.add(function(){fireRight=!0}),buttonFireRightBottom.events.onInputUp.add(function(){fireRight=!1}),buttonFireUp=game.add.button(662,417,"rightControl",null,this,0,1,0,1),buttonFireUp.alpha=.4,buttonFireUp.rotation=-1.57,buttonFireUp.anchor.setTo(.75,0),buttonFireUp.events.onInputOver.add(function(){fireUp=!0}),buttonFireUp.events.onInputOut.add(function(){fireUp=!1}),buttonFireUp.events.onInputDown.add(function(){fireUp=!0}),buttonFireUp.events.onInputUp.add(function(){fireUp=!1}),buttonFireUpLeft=game.add.button(617,400,"controlUpDown",null,this,0,1,0,1),buttonFireUpLeft.alpha=0,buttonFireUpLeft.setFrames(3,3,3),buttonFireUpLeft.events.onInputOver.add(function(){fireUp=!0}),buttonFireUpLeft.events.onInputOut.add(function(){fireUp=!1}),buttonFireUpLeft.events.onInputDown.add(function(){fireUp=!0}),buttonFireUpLeft.events.onInputUp.add(function(){fireUp=!1}),buttonFireUpRight=game.add.button(732,400,"controlUpDown",null,this,0,1,0,1),buttonFireUpRight.alpha=0,buttonFireUpRight.setFrames(2,2,2),buttonFireUpRight.events.onInputOver.add(function(){fireUp=!0}),buttonFireUpRight.events.onInputOut.add(function(){fireUp=!1}),buttonFireUpRight.events.onInputDown.add(function(){fireUp=!0}),buttonFireUpRight.events.onInputUp.add(function(){fireUp=!1}),buttonFireDown=game.add.button(662,560,"leftControl",null,this,0,1,0,1),buttonFireDown.alpha=.4,buttonFireDown.rotation=-1.57,buttonFireDown.anchor.setTo(.75,0),buttonFireDown.events.onInputOver.add(function(){fireDown=!0}),buttonFireDown.events.onInputOut.add(function(){fireDown=!1}),buttonFireDown.events.onInputDown.add(function(){fireDown=!0}),buttonFireDown.events.onInputUp.add(function(){fireDown=!1}),buttonFireDownLeft=game.add.button(617,540,"controlUpDown",null,this,0,1,0,1),buttonFireDownLeft.alpha=0,buttonFireDownLeft.setFrames(1,1,1),buttonFireDownLeft.events.onInputOver.add(function(){fireDown=!0}),buttonFireDownLeft.events.onInputOut.add(function(){fireDown=!1}),buttonFireDownLeft.events.onInputDown.add(function(){fireDown=!0}),buttonFireDownLeft.events.onInputUp.add(function(){fireDown=!1}),buttonFireDownRight=game.add.button(732,540,"controlUpDown",null,this,0,1,0,1),buttonFireDownRight.alpha=0,buttonFireDownRight.setFrames(0,0,0),buttonFireDownRight.events.onInputOver.add(function(){fireDown=!0}),buttonFireDownRight.events.onInputOut.add(function(){fireDown=!1}),buttonFireDownRight.events.onInputDown.add(function(){fireDown=!0}),buttonFireDownRight.events.onInputUp.add(function(){fireDown=!1}))},update:function(){player.body.velocity.x=0,player.body.velocity.y=0,game.physics.arcade.collide(player,barriers),game.physics.arcade.overlap(player,soundTriggers,this.triggerSound,null,this),game.physics.arcade.collide(bullets,targets,this.targetKill,null,this),game.physics.arcade.collide(bullets,barriers,this.bulletKill,null,this),game.physics.arcade.collide(player,door,this.endTutorial,null,this),"first"!=tutorialPractice&&(aKey.isDown||1==walkLeft?(player.body.velocity.x=-runSpeed,player.animations.play("left"),facing="left"):dKey.isDown||1==walkRight?(player.body.velocity.x=runSpeed,player.animations.play("right"),facing="right"):wKey.isDown||1==walkUp?(player.body.velocity.y=-runSpeed,player.animations.play("up"),facing="up"):sKey.isDown||1==walkDown?(player.body.velocity.y=runSpeed,player.animations.play("down"),facing="down"):player.animations.stop(),(cursors.right.isDown||cursors.left.isDown||cursors.up.isDown||cursors.down.isDown||1==fireLeft||1==fireRight||1==fireUp||1==fireDown)&&game.time.now>bulletTimer&&player.isAlive&&mana>=5&&this.fire(),0!=game.input.currentPointers||game.input.activePointer.isMouse||(fireLeft=!1,fireRight=!1,fireUp=!1,fireDown=!1,walkLeft=!1,walkRight=!1,walkUp=!1,walkDown=!1)),spaceBar.isDown&&""!=tutorialPractice&&game.time.now>assistantChangeTimer&&(this.tutorialChange(),assistantChangeTimer=game.time.now+1e3),this.torchUpdate(),this.tutorialShow(),this.trainerPlayerPositionCheck(),game.device.desktop||(walkLeft?(buttonWalkLeftTop.input.priorityID=1,buttonWalkUpLeft.input.priorityID=0,buttonWalkLeftBottom.input.priorityID=1,buttonWalkDownLeft.input.priorityID=0):walkUp?(buttonWalkLeftTop.input.priorityID=0,buttonWalkUpLeft.input.priorityID=1,buttonWalkRightTop.input.priorityID=0,buttonWalkUpRight.input.priorityID=1):walkRight?(buttonWalkRightTop.input.priorityID=1,buttonWalkUpRight.input.priorityID=0,buttonWalkRightBottom.input.priorityID=1,buttonWalkDownRight.input.priorityID=0):walkDown&&(buttonWalkLeftBottom.input.priorityID=0,buttonWalkDownLeft.input.priorityID=1,buttonWalkRightBottom.input.priorityID=0,buttonWalkDownRight.input.priorityID=1),fireLeft?(buttonFireLeftTop.input.priorityID=1,buttonFireUpLeft.input.priorityID=0,buttonFireLeftBottom.input.priorityID=1,buttonFireDownLeft.input.priorityID=0):fireUp?(buttonFireLeftTop.input.priorityID=0,buttonFireUpLeft.input.priorityID=1,buttonFireRightTop.input.priorityID=0,buttonFireUpRight.input.priorityID=1):fireRight?(buttonFireRightTop.input.priorityID=1,buttonFireUpRight.input.priorityID=0,buttonFireRightBottom.input.priorityID=1,buttonFireDownRight.input.priorityID=0):fireDown&&(buttonFireLeftBottom.input.priorityID=0,buttonFireDownLeft.input.priorityID=1,buttonFireRightBottom.input.priorityID=0,buttonFireDownRight.input.priorityID=1))},trainerText:function(){game.add.sprite(775,165,"trainerSprite"),trainerSpeechBubble=game.add.sprite(-580,35,"speechBubble"),trainerText=game.add.bitmapText(630,45,"fontBorder","",15),trainerText2=game.add.bitmapText(600,60,"fontBorder","",15),trainerText3=game.add.bitmapText(588,75,"fontBorder","",15),trainerText4=game.add.bitmapText(588,90,"fontBorder","",15),trainerText5=game.add.bitmapText(600,105,"fontBorder","",15),trainerText6=game.add.bitmapText(620,120,"fontBorder","",15),trainerText.tint=0,trainerText2.tint=0,trainerText3.tint=0,trainerText4.tint=0,trainerText5.tint=0,trainerText6.tint=0},trainerTextDestroy:function(){trainerText.destroy(),trainerText2.destroy(),trainerText3.destroy(),trainerText4.destroy(),trainerText5.destroy(),trainerText6.destroy()},tutorialPracticeText:function(){tutorialPracticeSpeechBubble=game.add.button(-200,410,"speechBubble",this.tutorialChange,this),tutorialPracticeText=game.add.bitmapText(450,418,"fontBorder","",15),tutorialPracticeText2=game.add.bitmapText(420,435,"fontBorder","",15),tutorialPracticeText3=game.add.bitmapText(408,450,"fontBorder","",15),tutorialPracticeText4=game.add.bitmapText(408,465,"fontBorder","",15),tutorialPracticeText5=game.add.bitmapText(420,480,"fontBorder","",15),tutorialPracticeText6=game.add.bitmapText(440,495,"fontBorder","",15),tutorialPracticeText.tint=0,tutorialPracticeText2.tint=0,tutorialPracticeText3.tint=0,tutorialPracticeText4.tint=0,tutorialPracticeText5.tint=0,tutorialPracticeText6.tint=0},bulletKill:function(a){a.kill()},targetKill:function(a,b){b.isDead?a.kill():(this.smallExplosion(a.x,a.y),a.kill(),b.isDead=!0,player.x<b.x?(b.x+=44,b.y+=12,b.rotation=1.57):(b.x-=12,b.y+=44,b.rotation=-1.57),xp+=1,this.checkLevelUp(),this.checkTutorialComplete())},checkLevelUp:function(){for(;xp>=nextLevelXp;){levelUpImage=game.add.sprite(132,15,"levelUp"),levelUpImage.animations.add("flash",[0,1,2],6,!0),levelUpImage.animations.play("flash");var a=game.add.audio("levelUpSound");a.play(),game.time.events.add(1*Phaser.Timer.SECOND,function(){levelUpImage.kill()}),xp-=nextLevelXp,nextLevelXp+=Math.round(9+playerLevel/2),maxHealth++,maxMana+=2,shotPower+=.05,health=maxHealth,mana=maxMana,playerLevel++}},checkTutorialComplete:function(){xp>=8&&(xp+=5,this.checkLevelUp(),tutorialPractice="second",nextPractice="",player.x<416?(doorway=game.add.sprite(512,352,"doorway"),door=game.add.sprite(512,352,"animateddoor")):(doorway=game.add.sprite(288,352,"doorway"),door=game.add.sprite(288,352,"animateddoor")),door.animations.add("openDoor",[0,1,2,3],4,!1),game.physics.arcade.enable(door),door.body.immovable=!0)},endTutorial:function(){tutorialMusicPlaying=!1,tutorialMusic.destroy(),door.animations.play("openDoor");var a=game.add.audio("creakylightwoodendoor1");a.play(),player.kill(),game.time.events.add(2*Phaser.Timer.SECOND,function(){game.state.start("defence")})},smallExplosion:function(a,b){var c=game.add.sprite(a,b,"explosionMini");c.animations.add("explosion",[0,1,2,3],30,!1),c.animations.play("explosion"),this.shortExplodeSFX(),game.time.events.add(.2*Phaser.Timer.SECOND,function(){c.destroy()})},fire:function(){var a=bullets.create(player.x+10,player.y+15,"bullet");a.animations.add("spin",[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25],26,!0);var b=game.add.emitter(game.world.centerX,game.world.centerY,20);b.makeParticles("bulletParticles",[0,1,2,3]),b.gravity.y=0,b.forEach(function(a){a.body.allowGravity=!1},this),b.start(!1,500,50),a.addChild(b),b.y=0,b.x=0,b.lifespan=500,a.scale.x=.8,a.scale.y=.8,cursors.left.isDown||1==fireLeft?(game.physics.arcade.moveToXY(a,0,a.y,shotSpeed),a.animations.play("spin"),a.travel="left",b.minParticleSpeed.set(-shotSpeed,0),b.maxParticleSpeed.set(-shotSpeed,0),b.rotation=3.14,b.x=-14,b.y=-8):cursors.right.isDown||1==fireRight?(game.physics.arcade.moveToXY(a,832,a.y,shotSpeed),a.animations.play("spin"),a.travel="right",b.minParticleSpeed.set(shotSpeed,0),b.maxParticleSpeed.set(shotSpeed,0),b.rotation=3.14,b.x=14,b.y=-8):cursors.up.isDown||1==fireUp?(game.physics.arcade.moveToXY(a,a.x,0,shotSpeed),a.animations.play("spin"),a.travel="up",b.minParticleSpeed.set(0,-shotSpeed),b.maxParticleSpeed.set(0,-shotSpeed),b.rotation=3.14,b.x=-8,b.y=-14):(cursors.down.isDown||1==fireDown)&&(game.physics.arcade.moveToXY(a,a.x,600,shotSpeed),a.animations.play("spin"),a.travel="down",b.minParticleSpeed.set(0,shotSpeed),b.maxParticleSpeed.set(0,shotSpeed),b.rotation=3.14,b.x=-8,b.y=14),this.pew(),bulletTimer=game.time.now+bulletSpacing},pew:function(){var a=game.add.audio("pew");a.play()},shortExplodeSFX:function(){var a=game.add.audio("shortExplode");a.play()},torchCreate:function(a,b,c){var d=lights.create(a,b,"tutorialDecorations36x32");d.animations.add("centre",[2,3],10,!0),d.animations.add("left",[4,5],10,!0),d.animations.add("right",[6,7],10,!0),"centre"==c?d.direction="centre":"left"==c?d.direction="left":"right"==c&&(d.direction="right")},torchUpdate:function(){lights.forEach(function(a){"centre"==a.direction?a.animations.play("centre"):"left"==a.direction?a.animations.play("left"):"right"==a.direction&&a.animations.play("right")})},tutorialShow:function(){switch(tutorialPractice){case"first":tutorialPracticeSprite=game.add.sprite(550,469,"assistant"),tutorialPracticeSpeechBubble.x=400,tutorialPracticeText.text="  Your Majesty!",tutorialPracticeText2.text=" The Royal Trainer feels",tutorialPracticeText3.text=" of late you have neglected ",tutorialPracticeText4.text=" your training and insists on",tutorialPracticeText5.text=" a refresher before you",tutorialPracticeText6.text="   join the battle.";break;case"second":tutorialPracticeSprite=game.add.sprite(550,469,"assistant"),tutorialPracticeSpeechBubble.x=400,tutorialPracticeText.text="  Excellent,  ",tutorialPracticeText2.text="  Your Majesty. Use the ",tutorialPracticeText3.text="  door when you're ready to",tutorialPracticeText4.text="  lead your troops. Your",tutorialPracticeText5.text="   soldiers await you at",tutorialPracticeText6.text="  the city's edge.";break;case"":tutorialPracticeSprite.destroy(),tutorialPracticeText.text="",tutorialPracticeText2.text="",tutorialPracticeText3.text="",tutorialPracticeText4.text="",tutorialPracticeText5.text="",tutorialPracticeText6.text=""}},tutorialChange:function(){switch(tutorialPractice){case"first":tutorialPractice="trainer",tutorialPracticeSprite.kill(),tutorialPracticeSpeechBubble.kill(),this.tutorialShow(),this.create();break;case"second":tutorialPractice="",tutorialPracticeSprite.kill(),tutorialPracticeSpeechBubble.kill(),this.tutorialShow()}},trainerPlayerPositionCheck:function(){"trainer"==tutorialPractice?(tutorialPractice="",this.trainerUpdate()):player.x>=288&&"right"==nextPractice?(nextPractice="up",this.trainerUpdate()):"up"==nextPractice&&player.y<=32?(nextPractice="left",this.trainerUpdate()):"left"==nextPractice&&player.x<=160?(nextPractice="down",this.trainerUpdate()):"down"==nextPractice&&player.y>=192?(nextPractice="shoot",this.trainerUpdate()):""==nextPractice&&(this.trainerUpdate(),nextPractice="done")},triggerSound:function(a,b){b.kill(),successSFX.play()},trainerUpdate:function(){"right"==nextPractice&&""==tutorialPractice?(trainerSpeechBubble.x=580,trainerText.text=" Your Majesty!",trainerText2.text="   It's been too long.",trainerText3.text="      Let us start with a",trainerText4.text="     review of the basics.",trainerText5.text="    Use the 'D' key to",trainerText6.text="      walk right."):"up"==nextPractice?(this.trainerTextDestroy(),this.trainerText(),trainerText.text="  Excellent!",trainerText2.text="     Now use the 'W' ",trainerText3.text="         key to walk up.",trainerText4.text=" ",trainerText5.text=" ",trainerText6.text=" "):"left"==nextPractice?(trainerText4.text="         And now the 'A'",trainerText5.text="      key to walk left.",trainerText6.text=" "):"down"==nextPractice?(this.trainerTextDestroy(),this.trainerText(),trainerText.text="  Jolly good!",trainerText2.text="    Finally use the 'S'",trainerText3.text="     key to walk down to",trainerText4.text="      the target room for",trainerText5.text="        some shooting",trainerText6.text="        practice."):"shoot"==nextPractice&&""==tutorialPractice?(this.trainerTextDestroy(),this.trainerText(),trainerText.text="  Wonderful!",trainerText2.text="    Now use the four ",trainerText3.text="   arrow keys to shoot in ",trainerText4.text=" each direction. See if you",trainerText5.text="  can hit all eight suits",trainerText6.text="     of armour."):""==nextPractice&&(this.trainerTextDestroy(),this.trainerText(),trainerText.text=" ",trainerText2.text=" ",trainerText3.text="          My work here",trainerText4.text="              is done.",trainerText5.text=" ",trainerText6.text=" ")},gofull:function(){game.scale.startFullScreen(!1)}},bootState={preload:function(){game.load.image("preloadBar","assets/preloadBar.png"),game.canvas.id="canvasID"},create:function(){game.state.start("preload")}},currentTime=0,year=0,population=100,happiness=44,happinessDisplay,popScore=1,popText,popDisplay,cityCoinsText,cityHappinessText,cityYearText,questStartTime=0,questEndTime=0,questYears=0,questStartCoins=0,questEndCoins=0,housing=25,commercial=25,industrial=25,education=25,popHealth=25,justice=25,defence=25,troopNumber=Math.round(defence/4),troopText,troopDisplay,utilities=25,weaponsmith=25,armourer=25,enchanter=25,trainer=25,income=0,expenditure=0,tax=40,economyMod=1,totalFunding,netIncome,previousPopulation=100,previousEconomyMod=0,previousIncome=0,previousExpenditure=0,previousNetIncome=0,previousCoins=0,previousTroopNumber=Math.round(defence/4),previousHappiness=44,residentialButton,industrialButton,commerceButton,educationButton,healthButton,justiceButton,armyButton,utilitiesButton,weaponerButton,armourerButton,magicGoodsButton,trainerButton,questButton,defendButton,castleButton,shop,defending=!0,defenceChance=0,educationHighlight,healthHighlight,townWoman1,townMan1,townWoman2,townMan2,warriorMan1,warriorWoman1,girl,boy,girlActive=!1,boyActive=!1,spaceBar,assistantChangeTimer=0,assistant="intro",assistantSprite,assistantSpeechBubble,assistantText="",assistantText2="",assistantText3="",assistantText4="",assistantText5="",assistantText6="",tutorial=!0,debtWarnYear=0,weaponsmithPerkAnnounced=!1,armourerPerkAnnounced=!1,enchanterPerkAnnounced=!1,trainerPerkAnnounced=!1,xpReduction,xpReduction1,xpReduction2,xpReduction3,startingPopIncrease=0,startingPopIncrease1,startingPopIncrease2,startingPopIncrease3,startingGoldIncrease=0,startingGoldIncrease1,startingGoldIncrease2,startingGoldIncrease3,artisanIncrease,artisanIncrease1,artisanIncrease2,artisanIncrease3,deptEffectIncrease=0,deptEffectIncrease1,deptEffectIncrease2,deptEffectIncrease3,marriageOptions=!1,beamUnlockShown=!1,manaRefillUnlockShown=!1,questHappinessModifier=0,questsUndertaken=0,marriageOptionsPromptButton,marriageOptionsPromptText,marriageOptionsBackground,marriageOptionsText1,marriageOptionsText2,marriageOptionsText3,marriageOptionsDisplayButton,marriageOptionsDisplayText,marriageOptionsHideButton,marriageOptionsHideText,pauseUpdate=!1,cityMusic,cityMusicPlaying=!1,bestStage=0,stageMilestone=100*Math.floor(bestStage/100),cityState={create:function(){game.add.sprite(0,0,"stonepaving"),game.add.sprite(16,80,"shopBorder"),game.add.sprite(176,80,"shopBorder"),game.add.sprite(336,80,"shopBorder"),game.add.sprite(496,80,"shopBorder"),game.add.sprite(656,80,"shopBorder"),game.add.sprite(16,250,"shopBorder"),game.add.sprite(656,250,"shopBorder"),game.add.sprite(16,415,"shopBorder"),game.add.sprite(176,415,"shopBorder"),game.add.sprite(336,415,"shopBorder"),game.add.sprite(496,415,"shopBorder"),game.add.sprite(656,415,"shopBorder"),1!=cityMusicPlaying&&(cityMusic=game.add.audio("cityMusic"),cityMusic.allowMultiple=!1,cityMusic.play(),cityMusicPlaying=!0),residentialButton=game.add.button(32,40,"HousingDpt",this.resOptions,this),game.add.sprite(124,148,"barrel"),commerceButton=game.add.button(192,40,"CommerceDpt",this.comOptions,this),game.add.sprite(285,150,"chestWooden"),industrialButton=game.add.button(352,40,"IndustryDpt",this.indOptions,this),educationButton=game.add.button(512,40,"EducationDpt",this.eduOptions,this),healthButton=game.add.button(672,40,"HealthDpt",this.healthOptions,this),game.add.sprite(764,148,"barrel"),townWoman1=game.add.sprite(850*Math.random(),160,"townWoman"),game.physics.arcade.enable(townWoman1),townWoman1.animations.add("left",[9,10,11],10,!0),townWoman2=game.add.sprite(157,700*Math.random(),"townWoman"),game.physics.arcade.enable(townWoman2),townWoman2.animations.add("up",[0,1,2],10,!0),townMan1=game.add.sprite(850*Math.random(),170,"townMan"),game.physics.arcade.enable(townMan1),townMan1.animations.add("right",[3,4,5],10,!0),townMan2=game.add.sprite(641,700*Math.random(),"townMan"),game.physics.arcade.enable(townMan2),townMan2.animations.add("down",[6,7,8],10,!0),(housing+commercial+industrial+education+popHealth+justice+defence+utilities+weaponsmith+armourer+enchanter+trainer)/12>60?(girlActive=!0,girl=game.add.sprite(0,12,"children"),girl.scale.x=.7,girl.scale.y=.7,girl.animations.add("right",[9,10,11],10,!0),girl.animations.add("down",[15,16,17],10,!0),girl.animations.add("up",[3,4,5],10,!0),girl.animations.add("left",[21,22,23],10,!0),game.add.tween(girl).to({x:490},3600).to({y:170},1200).to({x:0},3600).to({y:12},1200).loop().start()):girlActive=!1,(housing+commercial+industrial+education+popHealth+justice+defence+utilities+weaponsmith+armourer+enchanter+trainer)/12>70?(boyActive=!0,boy=game.add.sprite(0,170,"children"),boy.scale.x=.7,boy.scale.y=.7,boy.animations.add("right",[6,7,8],10,!0),boy.animations.add("down",[12,13,14],10,!0),boy.animations.add("up",[0,1,2],10,!0),boy.animations.add("left",[18,19,20],10,!0),game.add.tween(boy).to({y:12},1200).to({x:490},3600).to({y:170},1200).to({x:0},3600).loop().start()):boyActive=!1,justiceButton=game.add.button(32,210,"JusticeDpt",this.justiceOptions,this),game.add.sprite(37,318,"barrel"),castleButton=game.add.button(290,180,"castle",this.castleOptions,this),armyButton=game.add.button(672,210,"DefenceDpt",this.armyOptions,this),warriorMan1=game.add.sprite(800*Math.random()-50,348,"warriorMan"),game.physics.arcade.enable(warriorMan1),warriorMan1.animations.add("right",[3,4,5],10,!0),warriorWoman1=game.add.sprite(warriorMan1.x-6,369,"warriorWoman"),game.physics.arcade.enable(warriorWoman1),warriorWoman1.animations.add("right",[3,4,5],10,!0),warriorWoman1.speechBubble=warriorWoman1.addChild(game.add.sprite(-195,-113,"speechBubble")),warriorWoman1.speech1=warriorWoman1.addChild(game.add.bitmapText(-145,-106,"fontBorder","    Testing...",15)),warriorWoman1.speech2=warriorWoman1.addChild(game.add.bitmapText(-175,-89,"fontBorder","           One...",15)),warriorWoman1.speech3=warriorWoman1.addChild(game.add.bitmapText(-187,-72,"fontBorder","              Two...",15)),warriorWoman1.speech4=warriorWoman1.addChild(game.add.bitmapText(-187,-55,"fontBorder","              Three...",15)),warriorWoman1.speech5=warriorWoman1.addChild(game.add.bitmapText(-175,-38,"fontBorder","           Err...",15)),warriorWoman1.speech6=warriorWoman1.addChild(game.add.bitmapText(-145,-21,"fontBorder","    Hello?",15)),warriorWoman1.speech1.tint=0,warriorWoman1.speech2.tint=0,warriorWoman1.speech3.tint=0,warriorWoman1.speech4.tint=0,warriorWoman1.speech5.tint=0,warriorWoman1.speech6.tint=0,utilitiesButton=game.add.button(32,375,"UtilitiesDpt",this.utilOptions,this),weaponerButton=game.add.button(192,375,"weaponsmith",this.weaponOptions,this),game.add.sprite(197,485,"chestWooden"),armourerButton=game.add.button(352,375,"armourer",this.armourOptions,this),magicGoodsButton=game.add.button(512,375,"enchanter",this.magicGoodsOptions,this),trainerButton=game.add.button(672,375,"trainer",this.trainerOptions,this),""!=assistant&&"lastScheduled"!=assistant||(0==defending?questButton=game.add.button(115,540,"questButton",this.quest,this):defendButton=game.add.button(0,540,"defendButton",this.defend,this)),"intro"!=assistant&&"first"!=assistant&&(educationFunding<=40||healthFunding<=40)&&this.highlight(),popDisplay=game.add.sprite(10,6,"townWoman"),popDisplay.frame=7,popText=game.add.bitmapText(50,10,"font",population,26),troopDisplay=game.add.sprite(160,6,"warriorMan"),troopDisplay.frame=7,troopText=game.add.bitmapText(200,10,"font",troopNumber,26),coinDisplay=game.add.sprite(310,8,"coin"),coinDisplay.frame=0,cityCoinsText=game.add.bitmapText(340,10,"font",coins,26),happinessDisplay=game.add.sprite(510,8,"smileyFace"),cityHappinessText=game.add.bitmapText(550,10,"font",happiness,26),cityYearText=game.add.bitmapText(700,10,"font","Year: "+year,26),assistantSpeechBubble=game.add.button(-200,469,"speechBubble",this.assistantChange,this),assistantText=game.add.bitmapText(200,477,"fontBorder","",15),assistantText2=game.add.bitmapText(170,494,"fontBorder","",15),assistantText3=game.add.bitmapText(158,509,"fontBorder","",15),assistantText4=game.add.bitmapText(158,524,"fontBorder","",15),assistantText5=game.add.bitmapText(170,539,"fontBorder","",15),assistantText6=game.add.bitmapText(190,554,"fontBorder","",15),assistantText.tint=0,assistantText2.tint=0,assistantText3.tint=0,assistantText4.tint=0,assistantText5.tint=0,assistantText6.tint=0,this.warriorWomanAdvice(),this.assistantShow(),this.artisanPerkChecker(),1==marriageOptions&&(marriageOptionsPromptButton=game.add.button(10,50,"blankButton",this.marriageOptionsChoose,this),marriageOptionsPromptText=game.add.bitmapText(50,75,"font","View Alliance Offers",16)),spaceBar=game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR)},update:function(){pauseUpdate||(this.timeCheck(),this.assistantShow(),townWoman1.body.velocity.x=-40,townWoman1.animations.play("left"),townWoman1.x<-50&&(townWoman1.x=900),townWoman2.body.velocity.y=-50,townWoman2.animations.play("up"),townWoman2.y<-50&&(townWoman2.y=700),townMan1.body.velocity.x=50,townMan1.animations.play("right"),townMan1.x>850&&(townMan1.x=-50),townMan2.body.velocity.y=50,townMan2.animations.play("down"),townMan2.y>700&&(townMan2.y=-50),warriorWoman1.body.velocity.x=55,warriorWoman1.animations.play("right"),warriorWoman1.x>850&&(warriorWoman1.x=-50),warriorMan1.body.velocity.x=55,warriorMan1.animations.play("right"),warriorMan1.x>850&&(warriorMan1.x=-50),1==girlActive&&(12==girl.y&&girl.x<490?girl.animations.play("right"):girl.y<170&&490==girl.x?girl.animations.play("down"):170==girl.y&&girl.x>0?girl.animations.play("left"):girl.y>12&&0==girl.x&&girl.animations.play("up")),1==boyActive&&(12==boy.y&&boy.x<490?boy.animations.play("right"):boy.y<170&&490==boy.x?boy.animations.play("down"):170==boy.y&&boy.x>0?boy.animations.play("left"):boy.y>12&&0==boy.x&&boy.animations.play("up")),(housing+commercial+industrial+education+popHealth+justice+defence+utilities+weaponsmith+armourer+enchanter+trainer)/12>95&&0==marriageOptions&&(this.marriageOptionsPrompter(),marriageOptions=!0),spaceBar.isDown&&""!=assistant&&game.time.now>assistantChangeTimer&&(this.assistantChange(),assistantChangeTimer=game.time.now+1e3))},timeCheck:function(){if(questStartTime<questEndTime&&(questYears=Math.round((questEndTime-questStartTime)/25e4),questYears>10&&(questYears=10),questStartTime=0,questEndTime=0),year<=3)var a=6e4;else a=3e4;for(;game.time.now>currentTime+a||questYears>0;)year++,housing+=(housingFunding-housing)/12,commercial+=(commercialFunding-commercial)/12,industrial+=(industrialFunding-industrial)/12,education+=(educationFunding-education)/12,popHealth+=(healthFunding-popHealth)/12,justice+=(justiceFunding-justice)/12,defence+=(defenceFunding-defence)/12,utilities+=(utilitiesFunding-utilities)/12,weaponsmith+=(weaponsmithFunding-weaponsmith)/12,armourer+=(armourerFunding-armourer)/12,enchanter+=(enchanterFunding-enchanter)/12,trainer+=(trainerFunding-trainer)/12,previousPopulation=population,population+=population*((housing-33)/4e3),population+=population*((education-33)/9e3),population+=population*((popHealth-33)/2e3),population+=population*((justice-33)/13e3),population+=population*((defence-33)/14e3),population+=population*((utilities-33)/9e3),population+=population*((trainer-33)/14300),population-=population*((1.05*tax-.5*happiness)/2e3),population+=year<30?2+year/12:9-year/6,population>999999?(coins+=population-999999,population=999999):population=population>0?Math.round(population):0,previousHappiness=happiness,questHappinessModifier=Math.floor(stage/20+questsUndertaken/2),happiness=Math.round(20+questHappinessModifier+4*(housing/15+commercial/100+industrial/100+education/100+popHealth/15+justice/20+defence/100+utilities/80)),happiness>100&&(happiness=100),previousEconomyMod=economyMod,economyMod=1,economyMod+=(commercial-34)/950,economyMod+=(industrial-34)/950,economyMod+=(education-34)/950,economyMod+=(justice-34)/6e3,economyMod+=(weaponsmith-34)/5e3,economyMod+=(armourer-34)/5e3,economyMod+=(enchanter-34)/5e3,economyMod+=(trainer-34)/6e3,economyMod+=(utilities-33)/9e3,economyMod-=(tax-30)/3e3,previousIncome=income,income=population*economyMod*(1.17*tax)+65,averageFunding=Math.round((housingFunding+commercialFunding+industrialFunding+educationFunding+healthFunding+justiceFunding+defenceFunding+utilitiesFunding+weaponsmithFunding+armourerFunding+enchanterFunding+trainerFunding)/12),totalFunding=housingFunding+commercialFunding+industrialFunding+educationFunding+healthFunding+justiceFunding+defenceFunding+utilitiesFunding+weaponsmithFunding+armourerFunding+enchanterFunding+trainerFunding,previousExpenditure=expenditure,expenditure=totalFunding*(4.45+year/22)+population*(totalFunding/19),previousNetIncome=netIncome,netIncome=income-expenditure,previousCoins=coins,coins=Math.round(coins+income-expenditure),currentTime=game.time.now,questYears>0&&questYears--,Math.random()>.9-defenceChance/10&&(defending=!0,defenceChance=0,game.world.removeAll(),this.create()),popText.text=population,previousTroopNumber=troopNumber,troopNumber=Math.round(defence/4),troopText.text=troopNumber,coins>=1e6?cityCoinsText.text=Math.round(coins/1e3)/1e3+"M":cityCoinsText.text=coins,cityHappinessText.text=happiness,cityYearText.text="Year: "+year,this.popScoreCalc(),this.progressDisplay();coins<=0&&year>debtWarnYear+1&&(assistant="debt",debtWarnYear=year+3,tax<100&&tax++,housingFunding>0&&housingFunding--,
justiceFunding>0&&justiceFunding--,utilitiesFunding>0&&utilitiesFunding--,coins-=Math.round(.05*coins),this.create()),this.save()},popScoreCalc:function(){for(var a=100,b=population;b>a;)popScore+=.1,b-=a,a+=100;popScore>100&&(popScore=100)},progressDisplay:function(){var a=population-previousPopulation,b=game.add.bitmapText(55,35,"fontWhite",a,14);a>=0?(b.text="+"+a,b.tint=1504774):b.tint=16124166;var c=troopNumber-previousTroopNumber,d=game.add.bitmapText(205,35,"fontWhite",c,14);c>=0?(d.text="+"+c,d.tint=1504774):d.tint=16124166;var e=coins-previousCoins,f=game.add.bitmapText(345,35,"fontWhite",e,14);e>=0?(f.text="+"+e,f.tint=1504774):f.tint=16124166;var g=happiness-previousHappiness,h=game.add.bitmapText(515,35,"fontWhite",g,14);g>=0?(h.text="+"+g,h.tint=1504774):h.tint=16124166,game.time.events.add(2.5*Phaser.Timer.SECOND,function(){d.kill(),b.kill(),f.kill(),h.kill()})},castleOptions:function(){game.world.removeAll(),shop="castle",this.assistantChange(),game.state.start("shop")},resOptions:function(){coins>=0?(game.world.removeAll(),shop="housing",this.assistantChange(),game.state.start("shop")):this.shopClosed()},comOptions:function(){coins>=0?(game.world.removeAll(),shop="commercial",game.state.start("shop")):this.shopClosed()},indOptions:function(){coins>=0?(game.world.removeAll(),shop="industrial",this.assistantChange(),game.state.start("shop")):this.shopClosed()},eduOptions:function(){coins>=0||educationFunding<=40?(game.world.removeAll(),shop="education",this.assistantChange(),game.state.start("shop")):this.shopClosed()},healthOptions:function(){coins>=0||healthFunding<=40?(game.world.removeAll(),shop="health",this.assistantChange(),game.state.start("shop")):this.shopClosed()},justiceOptions:function(){coins>=0?(game.world.removeAll(),shop="justice",this.assistantChange(),game.state.start("shop")):this.shopClosed()},armyOptions:function(){coins>=0?(game.world.removeAll(),shop="defence",this.assistantChange(),game.state.start("shop")):this.shopClosed()},utilOptions:function(){coins>=0?(game.world.removeAll(),shop="utilities",this.assistantChange(),game.state.start("shop")):this.shopClosed()},weaponOptions:function(){coins>=0?(game.world.removeAll(),shop="weaponsmith",this.assistantChange(),game.state.start("shop")):this.shopClosed()},armourOptions:function(){coins>=0?(game.world.removeAll(),shop="armourer",this.assistantChange(),game.state.start("shop")):this.shopClosed()},magicGoodsOptions:function(){coins>=0?(game.world.removeAll(),shop="enchanter",this.assistantChange(),game.state.start("shop")):this.shopClosed()},trainerOptions:function(){coins>=0?(game.world.removeAll(),shop="trainer",this.assistantChange(),game.state.start("shop")):this.shopClosed()},quest:function(){game.world.removeAll(),cityMusic.destroy(),cityMusicPlaying=!1,stage=5*Math.floor(stage/5),stage<stageMilestone+1&&(stage=stageMilestone+1),baddieTotal=stage+6-baddieAdjuster,baddieCount=baddieTotal,baddieCreated=0,chestCreated=0,flameCount=0,evilwizardCount=0,zombieBirdCount=0,swampCreatureCount=0,starTotal=.75*(stage-1)+8,health=maxHealth,mana=maxMana,array=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130],sceneryCount=0,1==beamUnlockShown&&(beamWeapon=!0),1==manaRefillUnlockShown&&(manaRefillAvailable=!0),defenceChance++,questsUndertaken++,questStartTime=game.time.now,questStartCoins=coins,game.world.removeAll(),game.state.start("play")},defend:function(){cityMusic.destroy(),cityMusicPlaying=!1,game.world.removeAll(),health=maxHealth,mana=maxMana,defending=!1,attackerCount=attackStrength,defenceStrength=Math.round(defence/4),defenderCount=Math.round(defence/4),"first"==tutorialDefence?(cityMusicPlaying=!1,game.world.removeAll(),game.state.start("tutorial")):(cityMusicPlaying=!1,game.world.removeAll(),game.state.start("defence"))},collectSFX:function(){var a=game.add.audio("collect");a.play()},assistantShow:function(){switch(assistant){case"intro":console.log(assistant),assistantSprite=game.add.sprite(350,469,"assistant"),assistantSpeechBubble.x=150,assistantText.text="Your Majesty!",assistantText2.text=" I, your humble servant,",assistantText3.text="will offer advice from time to",assistantText4.text=" time. When you have read",assistantText5.text=" my advice, click here",assistantText6.text=" or press SPACE.";break;case"first":console.log(assistant),assistantSprite=game.add.sprite(350,469,"assistant"),assistantSpeechBubble.x=150,assistantText.text=" Your Majesty!",assistantText2.text="    This year's census ",assistantText3.text="     is very worrying. Your ",assistantText4.text="      people's health and ",assistantText5.text="       education is in ",assistantText6.text="        decline.";break;case"second":console.log(assistant),assistantSprite=game.add.sprite(350,469,"assistant"),assistantSpeechBubble.x=150,assistantText.text="  We must do",assistantText2.text=" something. You should",assistantText3.text="    increase the budgets",assistantText4.text="     of the Departments  ",assistantText5.text="       of Health and ",assistantText6.text="     Education.";break;case"third":console.log(assistant),educationFunding>40&&healthFunding>40&&(assistantSprite=game.add.sprite(350,469,"assistant"),assistantSpeechBubble.x=150,assistantText.text="  That should",assistantText2.text="   suffice for now. You",assistantText3.text="   can view yearly budget",assistantText4.text="   forecasts at the castle.",assistantText5.text="  You must spend your",assistantText6.text="  gold carefully.");break;case"defend":console.log(assistant),educationFunding>40&&healthFunding>40&&(assistantSprite=game.add.sprite(350,469,"assistant"),assistantSpeechBubble.x=150,assistantText.text=" Your Majesty!",assistantText2.text="     Our city is under",assistantText3.text="    attack. You must lead",assistantText4.text="        the Army in our",assistantText5.text="          Defence.",assistantText6.text="");break;case"tutorialEnd":assistantSprite=game.add.sprite(350,469,"assistant"),assistantSpeechBubble.x=150,assistantText.text=" Excellent work,",assistantText2.text=" Your Majesty. However ",assistantText3.text=" we cannot just wait for the",assistantText4.text=" next attack. Your city needs",assistantText5.text="you to undertake a quest",assistantText6.text="  to raise funds.";break;case"welcomeBack":assistantSprite=game.add.sprite(350,469,"assistant"),assistantSpeechBubble.x=150,assistantText.text=" Marvellous,",assistantText2.text="Your Majesty. Songs will ",assistantText3.text="be sung of your deeds down",assistantText4.text=" the ages. Now share the",assistantText5.text=" gold among each of your ",assistantText6.text=" offices of state.";break;case"lastScheduled":averageFunding>=41&&(assistantSprite=game.add.sprite(350,469,"assistant"),assistantSpeechBubble.x=150,assistantText.text=" Raising funding",assistantText2.text="will boost our population",assistantText3.text="  and economy. You should",assistantText4.text="    check back to adjust ",assistantText5.text="    funding from time  ",assistantText6.text="       to time.");break;case"debt":assistantSprite=game.add.sprite(350,469,"assistant"),assistantSpeechBubble.x=150,assistantText.text=" Our funds",assistantText2.text=" are gone. Our enemies",assistantText3.text=" see our weakness and we",assistantText4.text=" cannot pay our troops. You",assistantText5.text="  must undertake a quest",assistantText6.text=" to raise funds.";break;case"marriage":assistantSprite=game.add.sprite(350,469,"assistant"),assistantSpeechBubble.x=150,assistantText.text=" Your Majesty!",assistantText2.text=" Your people are happy.",assistantText3.text=" Your borders are secure.",assistantText4.text=" Your neighbours are lining",assistantText5.text=" up to offer alliances on",assistantText6.text=" generous terms.";break;case"weaponsmithPerk":assistantSprite=game.add.sprite(350,469,"assistant"),assistantSpeechBubble.x=150,assistantText.text=" Your Majesty!",assistantText2.text=" Our population can now",assistantText3.text=" support a Master Weapon",assistantText4.text=" Smith to add perks to your",assistantText5.text=" items. Check the Royal",assistantText6.text="   Weaponsmith.";break;case"armourerPerk":assistantSprite=game.add.sprite(350,469,"assistant"),assistantSpeechBubble.x=150,assistantText.text=" Your Majesty!",assistantText2.text=" Our population can now",assistantText3.text=" fund a Master Armourer",assistantText4.text="    to add perks to your",assistantText5.text="  items. Check the Royal",assistantText6.text="     Armourer.";break;case"enchanterPerk":assistantSprite=game.add.sprite(350,469,"assistant"),assistantSpeechBubble.x=150,assistantText.text=" Your Majesty!",assistantText2.text=" Our population can now",assistantText3.text=" fund a Master Enchanter",assistantText4.text="    to add perks to your",assistantText5.text="  items. Check the Royal",assistantText6.text="     Enchanter.";break;case"trainerPerk":assistantSprite=game.add.sprite(350,469,"assistant"),assistantSpeechBubble.x=150,assistantText.text=" Your Majesty!",assistantText2.text=" Our population can now",assistantText3.text="  fund a Master Trainer",assistantText4.text="    to add perks to your",assistantText5.text="  items. Check the Royal",assistantText6.text="      Trainer."}},assistantChange:function(){switch(assistant){case"intro":assistant="first",this.create(),this.assistantShow();break;case"first":assistant="second",this.create(),this.assistantShow();break;case"second":assistant="third",assistantSprite.kill(),assistantSpeechBubble.kill(),assistantText.text="",assistantText2.text="",assistantText3.text="",assistantText4.text="",assistantText5.text="",assistantText6.text="",this.highlight(),this.create(),this.assistantShow();break;case"third":educationFunding>40&&healthFunding>40&&(assistant="defend",assistantSprite.kill(),assistantSpeechBubble.kill(),assistantText.text="",assistantText2.text="",assistantText3.text="",assistantText4.text="",assistantText5.text="",assistantText6.text="",this.create());break;case"defend":assistant="",assistantSprite.kill(),assistantSpeechBubble.kill(),assistantText.text="",assistantText2.text="",assistantText3.text="",assistantText4.text="",assistantText5.text="",assistantText6.text="",this.create();break;case"tutorialEnd":assistant="",assistantSprite.kill(),assistantSpeechBubble.kill(),assistantText.text="",assistantText2.text="",assistantText3.text="",assistantText4.text="",assistantText5.text="",assistantText6.text="",this.create();break;case"welcomeBack":assistant="lastScheduled",assistantSprite.kill(),assistantSpeechBubble.kill(),assistantText.text="",assistantText2.text="",assistantText3.text="",assistantText4.text="",assistantText5.text="",assistantText6.text="",this.create();break;case"lastScheduled":averageFunding>=41&&(assistant="",assistantSprite.kill(),assistantSpeechBubble.kill(),assistantText.text="",assistantText2.text="",assistantText3.text="",assistantText4.text="",assistantText5.text="",assistantText6.text="",this.create());break;case"debt":assistant="",assistantSprite.kill(),assistantSpeechBubble.kill(),assistantText.text="",assistantText2.text="",assistantText3.text="",assistantText4.text="",assistantText5.text="",assistantText6.text="",this.create();break;case"marriage":assistant="",assistantSprite.kill(),assistantSpeechBubble.kill(),assistantText.text="",assistantText2.text="",assistantText3.text="",assistantText4.text="",assistantText5.text="",assistantText6.text="",this.create();break;case"weaponsmithPerk":assistant="",assistantSprite.kill(),assistantSpeechBubble.kill(),assistantText.text="",assistantText2.text="",assistantText3.text="",assistantText4.text="",assistantText5.text="",assistantText6.text="",this.create();break;case"armourerPerk":assistant="",assistantSprite.kill(),assistantSpeechBubble.kill(),assistantText.text="",assistantText2.text="",assistantText3.text="",assistantText4.text="",assistantText5.text="",assistantText6.text="",this.create();break;case"enchanterPerk":assistant="",assistantSprite.kill(),assistantSpeechBubble.kill(),assistantText.text="",assistantText2.text="",assistantText3.text="",assistantText4.text="",assistantText5.text="",assistantText6.text="",this.create();break;case"trainerPerk":assistant="",assistantSprite.kill(),assistantSpeechBubble.kill(),assistantText.text="",assistantText2.text="",assistantText3.text="",assistantText4.text="",assistantText5.text="",assistantText6.text="",this.create();break;case"":assistant="",null!=assistantSprite&&(assistantSprite.kill(),assistantSpeechBubble.kill()),assistantText.text="",assistantText2.text="",assistantText3.text="",assistantText4.text="",assistantText5.text="",assistantText6.text="",this.create()}},highlight:function(){educationFunding>40||0==first||(educationHighlight=game.add.sprite(510,56,"deptHighlight"),educationHighlight.alpha=.1,game.add.tween(educationHighlight).to({alpha:1},700,Phaser.Easing.Quadratic.In,!0,0,Number.MAX_VALUE,!0)),healthFunding>40||0==first||(healthHighlight=game.add.sprite(670,56,"deptHighlight"),healthHighlight.alpha=.1,game.add.tween(healthHighlight).to({alpha:1},700,Phaser.Easing.Quadratic.In,!0,0,Number.MAX_VALUE,!0))},save:function(){var a={};a.time=game.time.now,a.playerLevel=playerLevel,a.bulletSpacing=bulletSpacing,a.invulnerableSpacing=invulnerableSpacing,a.shotSpeed=shotSpeed,a.manaRegenHolder=manaRegenHolder,a.bossZombieKilled=bossZombieKilled,a.bossTreeBeastKilled=bossTreeBeastKilled,a.bossSkeletonKilled=bossSkeletonKilled,a.bossZombieBirdKilled=bossZombieBirdKilled,a.bossMummyKilled=bossMummyKilled,a.bossFinalKilled=bossFinalKilled,a.coins=coins,a.stage=stage,a.stageMilestone=stageMilestone,a.bestStage=bestStage,a.xp=xp,a.nextLevelXp=nextLevelXp,a.maxHealth=maxHealth,a.maxMana=maxMana,a.shotPower=shotPower,a.knockback=knockback,a.runSpeed=runSpeed,a.currentTime=currentTime,a.year=year,a.population=population,a.happiness=happiness,a.popScore=popScore,a.housing=housing,a.commercial=commercial,a.industrial=industrial,a.education=education,a.popHealth=popHealth,a.justice=justice,a.defence=defence,a.utilities=utilities,a.weaponsmith=weaponsmith,a.armourer=armourer,a.enchanter=enchanter,a.trainer=trainer,a.tax=tax,a.income=income,a.expenditure=expenditure,a.totalFunding=totalFunding,a.netIncome=netIncome,a.defending=defending,a.defenceChance=defenceChance,a.assistant=assistant,a.tutorial=tutorial,a.tutorialDefence=tutorialDefence,a.first=first,a.housingFunding=housingFunding,a.commercialFunding=commercialFunding,a.industrialFunding=industrialFunding,a.educationFunding=educationFunding,a.healthFunding=healthFunding,a.justiceFunding=justiceFunding,a.defenceFunding=defenceFunding,a.utilitiesFunding=utilitiesFunding,a.weaponsmithFunding=weaponsmithFunding,a.armourerFunding=armourerFunding,a.enchanterFunding=enchanterFunding,a.trainerFunding=trainerFunding,a.averageFunding=averageFunding,a.weaponsmithDropReward=weaponsmithDropReward,a.weaponsmithTimer=weaponsmithTimer,a.wandTimer=wandTimer,a.wandShotPower=wandShotPower,a.wandShotSpeed=wandShotSpeed,a.wandBulletSpacing=wandBulletSpacing,a.shieldTimer=shieldTimer,a.shieldKnockback=shieldKnockback,a.shieldMaxHealth=shieldMaxHealth,a.shieldInvulnerableSpacing=shieldInvulnerableSpacing,a.armourerDropReward=armourerDropReward,a.armourerTimer=armourerTimer,a.armourTimer=armourTimer,a.armourMaxHealth=armourMaxHealth,a.armourManaRegenInterval=armourManaRegenInterval,a.armourInvulnerableSpacing=armourInvulnerableSpacing,a.hatTimer=hatTimer,a.hatMaxHealth=hatMaxHealth,a.hatManaRegenInterval=hatManaRegenInterval,a.hatMaxMana=hatMaxMana,a.bootTimer=bootTimer,a.bootRunSpeed=bootRunSpeed,a.bootManaRegenInterval=bootManaRegenInterval,a.bootInvulnerableSpacing=bootInvulnerableSpacing,a.enchanterDropReward=enchanterDropReward,a.enchanterTimer=enchanterTimer,a.ringTimer=ringTimer,a.ringShotPower=ringShotPower,a.ringMaxMana=ringMaxMana,a.ringKnockback=ringKnockback,a.amuletTimer=amuletTimer,a.amuletRunSpeed=amuletRunSpeed,a.amuletShotSpeed=amuletShotSpeed,a.amuletBulletSpacing=amuletBulletSpacing,a.trainerDropReward=trainerDropReward,a.trainerTimer=trainerTimer,a.skillTimer=skillTimer,a.skillShotPower=skillShotPower,a.skillMaxMana=skillMaxMana,a.skillKnockback=skillKnockback,a.enduranceTimer=enduranceTimer,a.enduranceRunSpeed=enduranceRunSpeed,a.enduranceShotSpeed=enduranceShotSpeed,a.enduranceBulletSpacing=enduranceBulletSpacing,a.attackStrength=attackStrength,a.tutorialDefence=tutorialDefence,a.weaponsmithUpgradeCost=weaponsmithUpgradeCost,a.armourerUpgradeCost=armourerUpgradeCost,a.enchanterUpgradeCost=enchanterUpgradeCost,a.trainerUpgradeCost=trainerUpgradeCost,a.previousPopulation=previousPopulation,a.previousEconomyMod=previousEconomyMod,a.previousIncome=previousIncome,a.previousExpenditure=previousExpenditure,a.previousNetIncome=previousNetIncome,a.previousCoins=previousCoins,a.startingGoldIncrease=startingGoldIncrease,a.startingPopIncrease=startingPopIncrease,a.deptEffectIncrease=deptEffectIncrease,a.beamUnlockShown=beamUnlockShown,a.manaRefillUnlockShown=manaRefillUnlockShown,a.weaponsmithAdTimer=weaponsmithAdTimer,a.armourerAdTimer=armourerAdTimer,a.enchanterAdTimer=enchanterAdTimer,a.trainerAdTimer=trainerAdTimer,a.baddieAdjuster=baddieAdjuster,a.baddieDamageAdjuster=baddieDamageAdjuster,a.baddieHpAdjuster=baddieHpAdjuster,a.baddieXpAdjuster=baddieXpAdjuster,a.baddieSpeedAdjuster=baddieSpeedAdjuster,a.weaponsmithPerkAnnounced=weaponsmithPerkAnnounced,a.armourerPerkAnnounced=armourerPerkAnnounced,a.enchanterPerkAnnounced=enchanterPerkAnnounced,a.trainerPerkAnnounced=trainerPerkAnnounced,a.troopNumber=troopNumber,a.previousTroopNumber=previousTroopNumber,a.previousHappiness=previousHappiness,localStorage.setItem("save",JSON.stringify(a))},restart:function(){this.assistantChange(),bossZombieKilled=!1,bossTreeBeastKilled=!1,bossSkeletonKilled=!1,bossZombieBirdKilled=!1,bossMummyKilled=!1,bossFinalKilled=!1,coins=1850+startingGoldIncrease,stageMilestone=100*Math.floor(bestStage/100),stage=stageMilestone+Math.floor((bestStage-stageMilestone)/4),bestStage=0,year=0,population=100+startingPopIncrease,happiness=44,popScore=0,housing=25+deptEffectIncrease/10,commercial=25+deptEffectIncrease/10,industrial=25+deptEffectIncrease/10,education=25+deptEffectIncrease/10,popHealth=25+deptEffectIncrease/10,justice=25+deptEffectIncrease/10,defence=25+deptEffectIncrease/10,utilities=25+deptEffectIncrease/10,weaponsmith=25+deptEffectIncrease/10,armourer=25+deptEffectIncrease/10,enchanter=25+deptEffectIncrease/10,trainer=25+deptEffectIncrease/10,tax=40,income=0,expenditure=0,defending=!0,defenceChance=0,housingFunding=40,commercialFunding=40,industrialFunding=40,educationFunding=40,healthFunding=40,justiceFunding=40,defenceFunding=40,utilitiesFunding=40,weaponsmithFunding=40,armourerFunding=40,enchanterFunding=40,trainerFunding=40,averageFunding=40,attackStrength=8,weaponsmithUpgradeCost=200,armourerUpgradeCost=200,enchanterUpgradeCost=200,trainerUpgradeCost=200,questHappinessModifier=0,questsUndertaken=0,nextLevelXp=Math.floor(nextLevelXp*(1-xpReduction/100)),weaponsmithDropReward+=artisanIncrease,armourerDropReward+=artisanIncrease,enchanterDropReward+=artisanIncrease,trainerDropReward+=artisanIncrease,marriageOptions=!1,pauseUpdate=!1,weaponsmithPerkAnnounced=!1,armourerPerkAnnounced=!1,enchanterPerkAnnounced=!1,trainerPerkAnnounced=!1,cityMusic.destroy(),game.world.removeAll(),game.state.start("reset")},marriageOptionsPrompter:function(){assistant="marriage",marriageOptionsPromptButton=game.add.button(10,50,"blankButton",this.marriageOptionsChoose,this),marriageOptionsPromptText=game.add.bitmapText(50,75,"font","View Alliance Offers",16),this.create()},marriageOptionsChoose:function(){marriageOptionsBackground=game.add.sprite(96,150,"scrollStrip"),marriageOptionsText1=game.add.bitmapText(300,160,"font","Choose an Alliance?",24),marriageOptionsText2=game.add.bitmapText(220,190,"font","Your city, gold and stage progress will be reset,",18),marriageOptionsText3=game.add.bitmapText(220,215,"font","    but you will be rewarded very generously.",18),marriageOptionsDisplayButton=game.add.button(190,250,"blankButton",this.marriageOptions,this),marriageOptionsDisplayText=game.add.bitmapText(280,280,"font","Yes",16),marriageOptionsHideButton=game.add.button(410,250,"blankButton",this.marriageOptionsHide,this),marriageOptionsHideText=game.add.bitmapText(480,280,"font","No, not yet",16)},marriageOptionsHide:function(){marriageOptionsBackground.kill(),marriageOptionsText1.text="",marriageOptionsText2.text="",marriageOptionsText3.text="",marriageOptionsDisplayButton.kill(),marriageOptionsDisplayText.text="",marriageOptionsHideButton.kill(),marriageOptionsHideText.text=""},marriageOptions:function(){this.marriageOptionsHide(),pauseUpdate=!0,boy.kill(),girl.kill();var a=[" Princess Elsbeth","Princess Anastasia"," Princess Matthe","  Princess Susan","   Princess Bob","Princess Esmerelda","  Princess Leia"," Princess Victoria","Princess Alexandra","Princess Emmeline","Princess Christabel","Princess Buttercup","Princess Cassandra"," Princess Correen"],b=["   Of Dunnovia"," Of Somethingia","  Of Madeupistan","Of Nextdoorbutone","  Of Farfaraway","Of The Silly Isles","    Of Belgium"];game.add.button(48,150,"ui_213x255",this.choiceOne,this);var c=a[Math.floor(13.99*Math.random())];game.add.bitmapText(96,162,"font",c,14);var d=b[Math.floor(6.99*Math.random())];game.add.bitmapText(100,180,"font",d,14);var e=game.add.sprite(125,200,"princesses");e.frame=Math.floor(23.99*Math.random()),xpReduction1=Math.round(20*Math.random())+20,startingPopIncrease1=Math.floor(6*Math.random())-3,startingGoldIncrease1=Math.round(150*Math.random())-50,artisanIncrease1=Math.floor(3*Math.random())-1,deptEffectIncrease1=Math.round(10*Math.random())-5,startingPopIncrease1<0&&(startingPopIncrease1=0),startingGoldIncrease1<0&&(startingGoldIncrease1=0),artisanIncrease1<0&&(artisanIncrease1=0),deptEffectIncrease1<0&&(deptEffectIncrease1=0),game.add.bitmapText(110,280,"font","Alliance Dowry: ",14),game.add.bitmapText(60,300,"font","Level Up XP Reduction: "+xpReduction1+"%",14),game.add.bitmapText(60,315,"font","Starting Population: + "+startingPopIncrease1,14),game.add.bitmapText(60,330,"font","Starting Gold: + "+startingGoldIncrease1,14),game.add.bitmapText(60,345,"font","Artisan Effectiveness: + "+artisanIncrease1,14),game.add.bitmapText(60,360,"font","Starting Govt Dept Level: + "+deptEffectIncrease1,14),game.add.button(309,150,"ui_213x255",this.choiceTwo,this);var f=a[Math.floor(13.99*Math.random())];game.add.bitmapText(347,162,"font",f,14);var g=b[Math.floor(6.99*Math.random())];game.add.bitmapText(351,180,"font",g,14);var h=game.add.sprite(386,200,"princesses");h.frame=Math.floor(23.99*Math.random()),xpReduction2=Math.round(20*Math.random())+20,startingPopIncrease2=Math.floor(6*Math.random())-3,startingGoldIncrease2=Math.round(300*Math.random())-100,artisanIncrease2=Math.floor(3*Math.random())-1,deptEffectIncrease2=Math.round(10*Math.random())-5,startingPopIncrease2<0&&(startingPopIncrease2=0),startingGoldIncrease2<0&&(startingGoldIncrease2=0),artisanIncrease2<0&&(artisanIncrease2=0),deptEffectIncrease2<0&&(deptEffectIncrease2=0),game.add.bitmapText(371,280,"font","Alliance Dowry: ",14),game.add.bitmapText(321,300,"font","Level Up XP Reduction: "+xpReduction2+"%",14),game.add.bitmapText(321,315,"font","Starting Population: + "+startingPopIncrease2,14),game.add.bitmapText(321,330,"font","Starting Gold: + "+startingGoldIncrease2,14),game.add.bitmapText(321,345,"font","Artisan Effectiveness: + "+artisanIncrease2,14),game.add.bitmapText(321,360,"font","Starting Govt Dept Level: + "+deptEffectIncrease2,14),game.add.button(570,150,"ui_213x255",this.choiceThree,this);var i=a[Math.floor(13.99*Math.random())];game.add.bitmapText(608,162,"font",i,14);var j=b[Math.floor(6.99*Math.random())];game.add.bitmapText(612,180,"font",j,14);var k=game.add.sprite(647,200,"princesses");k.frame=Math.floor(23.99*Math.random()),xpReduction3=Math.round(20*Math.random())+20,startingPopIncrease3=Math.floor(9*Math.random())-4,startingGoldIncrease3=Math.round(350*Math.random())-150,artisanIncrease3=Math.floor(3*Math.random())-1,deptEffectIncrease3=Math.round(14*Math.random())-6,startingPopIncrease3<0&&(startingPopIncrease3=0),startingGoldIncrease3<0&&(startingGoldIncrease3=0),artisanIncrease3<0&&(artisanIncrease3=0),deptEffectIncrease3<0&&(deptEffectIncrease3=0),game.add.bitmapText(632,280,"font","Alliance Dowry: ",14),game.add.bitmapText(582,300,"font","Level Up XP Reduction: "+xpReduction3+"%",14),game.add.bitmapText(582,315,"font","Starting Population: + "+startingPopIncrease3,14),game.add.bitmapText(582,330,"font","Starting Gold: + "+startingGoldIncrease3,14),game.add.bitmapText(582,345,"font","Artisan Effectiveness: + "+artisanIncrease3,14),game.add.bitmapText(582,360,"font","Starting Govt Dept Level: + "+deptEffectIncrease3,14)},choiceOne:function(){xpReduction=xpReduction1,startingPopIncrease+=startingPopIncrease1,startingGoldIncrease+=startingGoldIncrease1,artisanIncrease=artisanIncrease1,deptEffectIncrease+=deptEffectIncrease1,this.restart()},choiceTwo:function(){xpReduction=xpReduction2,startingPopIncrease+=startingPopIncrease2,startingGoldIncrease+=startingGoldIncrease2,artisanIncrease=artisanIncrease2,deptEffectIncrease+=deptEffectIncrease2,this.restart()},choiceThree:function(){xpReduction=xpReduction3,startingPopIncrease+=startingPopIncrease3,startingGoldIncrease+=startingGoldIncrease3,artisanIncrease=artisanIncrease3,deptEffectIncrease+=deptEffectIncrease3,this.restart()},warriorWomanAdvice:function(){var a=Math.floor(12.99*Math.random());switch(a){case 0:warriorWoman1.speech1.text="   Opening",warriorWoman1.speech2.text=" chests while questing",warriorWoman1.speech3.text="   gives gold and artisan ",warriorWoman1.speech4.text=" materials but also a small",warriorWoman1.speech5.text="  mana boost. Use it",warriorWoman1.speech6.text="     wisely.";break;case 1:warriorWoman1.speech1.text="       Mana",warriorWoman1.speech2.text="  recharges much faster",warriorWoman1.speech3.text="      while standing still,",warriorWoman1.speech4.text="    and even faster when",warriorWoman1.speech5.text="   a stage is cleared of",warriorWoman1.speech6.text="   enemies.";break;case 2:warriorWoman1.speech1.text="      Your",warriorWoman1.speech2.text="  level and any Artisan",warriorWoman1.speech3.text="  bonuses will pass to your",warriorWoman1.speech4.text="  children, should you have",warriorWoman1.speech5.text="             any.",warriorWoman1.speech6.text="";break;case 3:warriorWoman1.speech1.text="     If your",warriorWoman1.speech2.text=" approval rating reaches ",warriorWoman1.speech3.text="   at least 95, neighbouring",warriorWoman1.speech4.text="   kingdoms may offer you ",warriorWoman1.speech5.text="         an alliance.",warriorWoman1.speech6.text="";break;case 4:warriorWoman1.speech1.text="   Alliances",warriorWoman1.speech2.text="  with neighbours are ",warriorWoman1.speech3.text="  often sealed by marriage.",warriorWoman1.speech4.text="   The dowries can be very",warriorWoman1.speech5.text="          generous.",warriorWoman1.speech6.text="";break;case 5:warriorWoman1.speech1.text="     Special",warriorWoman1.speech2.text="    materials found in ",warriorWoman1.speech3.text="    chests can boost your",warriorWoman1.speech4.text="   artisans' skill level and",warriorWoman1.speech5.text="  increase the power of",warriorWoman1.speech6.text="   their perks.";break;case 6:warriorWoman1.speech1.text="   Taxes can ",warriorWoman1.speech2.text=" fund services and help ",warriorWoman1.speech3.text=" your kingdom grow. But if ",warriorWoman1.speech4.text=" they are too high they may ",warriorWoman1.speech5.text="    drive people away.",warriorWoman1.speech6.text="";break;case 7:warriorWoman1.speech1.text="   The years ",warriorWoman1.speech2.text="      still pass in the ",warriorWoman1.speech3.text="    city while you are out ",warriorWoman1.speech4.text="      questing, but at a ",warriorWoman1.speech5.text="        slower rate.",warriorWoman1.speech6.text="";break;case 8:warriorWoman1.speech1.text="  Your artisans ",warriorWoman1.speech2.text="can add potent perks to",warriorWoman1.speech3.text="weapons and armour as the",warriorWoman1.speech4.text=" city grows. Higher funding",warriorWoman1.speech5.text="  and better materials",warriorWoman1.speech6.text="   will help.";break;case 9:warriorWoman1.speech1.text=" Reward chests ",warriorWoman1.speech2.text="come in different colours.",warriorWoman1.speech3.text=" Red chests give least, blue ",warriorWoman1.speech4.text="  then green give more. A",warriorWoman1.speech5.text="  yellow chest contains",warriorWoman1.speech6.text="   the most.";break;case 10:warriorWoman1.speech1.text="  Your advisers",warriorWoman1.speech2.text=" can be very demanding",warriorWoman1.speech3.text=" with funding requests. As",warriorWoman1.speech4.text="  Ruler, the final decision",warriorWoman1.speech5.text="  on budget allocation is",warriorWoman1.speech6.text="  always yours.";break;case 11:warriorWoman1.speech1.text="  Department ",warriorWoman1.speech2.text=" funds are allocated  ",warriorWoman1.speech3.text=" at the end of the year.",warriorWoman1.speech4.text="  Any gold you allocate",warriorWoman1.speech5.text="   will not be taken ",warriorWoman1.speech6.text="  straight away.";break;case 12:warriorWoman1.speech1.text="  You should ",warriorWoman1.speech2.text="   check the financial",warriorWoman1.speech3.text="   reports and forecasts",warriorWoman1.speech4.text="    at the castle every ",warriorWoman1.speech5.text="     now and again.",warriorWoman1.speech6.text="  "}},shopClosed:function(){var a=game.add.sprite(310,245,"ui_213x150"),b=game.add.bitmapText(313,265,"font","CLOSED",50),c=game.add.bitmapText(350,325,"font","Due to lack",26),d=game.add.bitmapText(360,355,"font"," of funds",26);game.time.events.add(3*Phaser.Timer.SECOND,function(){a.destroy(),b.destroy(),c.destroy(),d.destroy()})},artisanPerkChecker:function(){population>=110&&""==assistant&&0==weaponsmithPerkAnnounced?(weaponsmithPerkAnnounced=!0,assistant="weaponsmithPerk"):population>=125&&""==assistant&&0==armourerPerkAnnounced?(armourerPerkAnnounced=!0,assistant="armourerPerk"):population>=150&&""==assistant&&0==enchanterPerkAnnounced?(enchanterPerkAnnounced=!0,assistant="enchanterPerk"):population>=200&&""==assistant&&0==trainerPerkAnnounced&&(trainerPerkAnnounced=!0,assistant="trainerPerk")}},creditsTypewriter,menuReturnText,scroll=!1,creditsMusic,creditsState={create:function(){game.add.button(-5,-5,"blankButton",this.menuReturn,this),menuReturnText=game.add.bitmapText(80,25,"font","Menu",18),creditsMusic=game.add.audio("introCreditsMusic"),creditsMusic.play(),creditsTypewriter=new Typewriter,creditsTypewriter.init(game,{x:275,y:100,time:Phaser.Timer.SECOND/22,fontFamily:"font",fontSize:16,maxWidth:400,text:"         Game Design \n \n         Paul McGarry \n \n \n         Programming \n \n         Paul McGarry \n \n \n           Artwork \n \n     via opengameart.org \n \n Charles Gabriel (Antifarea) \n Lanea Zimmerman (Sharm) \n Stephen Challener (Redshrike) \n Carl Olsson (Surt) \n Shepardskin (twitter.com/shepardskin) \n Ben (artisticdude) \n Hyptosis (hyptosis.newgrounds.com) \n Tuomo Untinen (Reemax) \n helpcomputer \n Jetrel \n Hippo \n Bart Kelsey (Bart) \n Bertram \n Zachariah Husiar (Zabin) \n Sacio (djodin.com) \n Thane Brimhall (pennomi) \n Michele Bucelli (Buch) \n Cem Kalyoncu (darkgaze.org) \n Joshua Robertson (J-Robot/j-robotson.tumblr.com)\n William.Thompsonj \n StumpyStrust \n bevouliin.com \n Clint Bellanger \n KnoblePersona \n Calinou (www.minetest.net)\n \n      also \n Daniel Cook (www.lostgarden.com) \n \n Henrique Lazarini (7Soul1 at Deviant Art) \n \n logos by textcraft.net \n \n additional artwork and arrangement by Paul McGarry \n \n \n      Music \n \n Eric Matyas (soundimage.org)\n Our_Mountain_v003 \n Left-Behind \n Fantasy_Game_Background \n The-Castle-Beyond-the-Forest \n Ominous_Goings-On \n Fantasy-Forest-Battle \n Tower-Defense \n \n Paul McGarry \n \n \n Sound Effects \n \n   via freesound.org \n \n Deathstardude \n LittleRobotSoundFactory (littlerobotsoundfactory.com) \n MusicLegends \n vmgraw \n -sihiL \n chaosportal \n scorpion67890 \n Srehpog \n Scrampunk (scrampunk.com) \n wubitog \n xtrgamr \n pierrecartoons1979\n \n \n   via opengameart.org \n \n David McKee (ViRiX - soundcloud.com/virix) \n Ben (artisticdude) \n Bart Kelsey (bart) \n John McDonald (jcpmcdonald.com) \n Mikko Rytkonen (www.fractilegames.com) \n \n \n Paul McGarry\n \n \n         Testing \n \n Correen Robinson \n Paul McGarry \n \n \n \n \n \n \n \n    Many Thanks to all involved \nand special thanks to you for playing!",
endFn:this.scrollStop}),creditsTypewriter.start(),game.time.events.add(16.5*Phaser.Timer.SECOND,function(){scroll=!0})},update:function(){1==scroll&&creditsTypewriter.scroll()},menuReturn:function(){game.state.start("menu"),creditsMusic.stop()},scrollStop:function(){game.time.events.add(6.5*Phaser.Timer.SECOND,function(){scroll=!1})}},attackers,defenders,obstacles,attackStrength=5,attackerCount=attackStrength,defenceStrength=Math.round(defence/4),defenderCount=Math.round(defence/4),defenceAudio,newCitizens,tutorialDefence="first",tutorialSprite,tutorialSpeechBubble,tutorialText="",tutorialText2="",tutorialText3="",tutorialText4="",tutorialText5="",tutorialText6="",defenceState={create:function(){game.world.removeAll(),game.physics.startSystem(Phaser.Physics.ARCADE),game.add.sprite(0,0,"cityOutskirts"),defenceAudio=game.add.audio("defence"),defenceAudio.stop(),defenceAudio.loopFull(.5),coinsText=coins>=1e6?game.add.bitmapText(395,10,"font",Math.round(coins/1e3)/1e3+"M",30):game.add.bitmapText(395,10,"font",coins,30),hudDisplay=game.add.sprite(0,0,"hudDisplay"),hudDisplay.scale.setTo(1.1,1.1),hpBar=game.add.sprite(92,7,"hudBarRed"),hpBar.scale.setTo(1.1,1.1),hpCrop=new Phaser.Rectangle(0,0,88,15),hpBar.crop(hpCrop),healthText=game.add.bitmapText(93,7,"fontWhite","HP: "+health+"/"+maxHealth,15),manaBar=game.add.sprite(92,28,"hudBarBlue"),manaBar.scale.setTo(1.1,1.1),manaCrop=new Phaser.Rectangle(0,0,88,15),manaBar.crop(manaCrop),manaText=game.add.bitmapText(93,28,"fontWhite","MP: "+mana+"/"+maxMana,15),xpBar=game.add.sprite(92,50,"hudBarGreen"),xpBar.scale.setTo(1.1,1.1),xpCrop=new Phaser.Rectangle(0,0,88,15),xpBar.crop(xpCrop),xpText=game.add.bitmapText(93,50,"fontWhite","XP: "+xpDisplay+"/"+nextLevelXpDisplay,15),this.xpDisplayConvert(),playerLevelText=playerLevel>=100?game.add.bitmapText(9,23,"font",playerLevel,30):playerLevel>=10?game.add.bitmapText(18,23,"font",playerLevel,30):game.add.bitmapText(26,23,"font",playerLevel,30),coinsText.alpha=.7,xpText.alpha=.7,healthText.alpha=.7,manaText.alpha=.7,playerLevelText.alpha=.7,coinDisplay=game.add.sprite(360,8,"coin"),coinDisplay.frame=0,player=game.add.sprite(16,120,"dude"),game.physics.arcade.enable(player),player.body.setSize(28,32,2,2),player.body.collideWorldBounds=!0,player.isAlive=!0,player.animations.add("left",[9,10,11],10,!0),player.animations.add("right",[3,4,5],10,!0),player.animations.add("up",[0,1,2],10,!0),player.animations.add("down",[6,7,8],10,!0),player.animations.add("stop",[4],10,!0),player.animations.play("stop"),bullets=game.add.group(),bullets.enableBody=!0,bullets.createMultiple(90,"bullet"),attackers=game.add.group(),attackers.enableBody=!0,defenders=game.add.group(),defenders.enableBody=!0,obstacles=game.add.group(),obstacles.enableBody=!0;for(var a=1;a<=attackStrength;a++)this.attackerCreate(750,32*(a-1));if(coins>=0)for(var a=0;a<=defenceStrength;a++)a<=12?this.defenderCreate(224,32*a):this.defenderCreate(188,32*(a-12));for(var a=0;a<=17;a++)if(a<=8){var b=obstacles.create(64*a,160,"statue");b.body.setSize(30,18,1,45),b.body.immovable=!0,b.frame=0}else{var b=obstacles.create(64*(a-9),384,"statue");b.body.setSize(30,18,1,45),b.body.immovable=!0,b.frame=0}cursors=game.input.keyboard.createCursorKeys(),spaceBar=game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),wKey=game.input.keyboard.addKey(Phaser.Keyboard.W),aKey=game.input.keyboard.addKey(Phaser.Keyboard.A),sKey=game.input.keyboard.addKey(Phaser.Keyboard.S),dKey=game.input.keyboard.addKey(Phaser.Keyboard.D),game.device.desktop||(buttonWalkLeft=game.add.button(20,470,"leftControl",null,this,0,1,0,1),buttonWalkLeft.alpha=.4,buttonWalkLeft.events.onInputOver.add(function(){walkLeft=!0}),buttonWalkLeft.events.onInputOut.add(function(){walkLeft=!1}),buttonWalkLeft.events.onInputDown.add(function(){walkLeft=!0}),buttonWalkLeft.events.onInputUp.add(function(){walkLeft=!1}),buttonWalkLeftTop=game.add.button(20,430,"controlLeftRight",null,this,0,1,0,1),buttonWalkLeftTop.alpha=0,buttonWalkLeftTop.setFrames(3,3,3),buttonWalkLeftTop.events.onInputOver.add(function(){walkLeft=!0}),buttonWalkLeftTop.events.onInputOut.add(function(){walkLeft=!1}),buttonWalkLeftTop.events.onInputDown.add(function(){walkLeft=!0}),buttonWalkLeftTop.events.onInputUp.add(function(){walkLeft=!1}),buttonWalkLeftBottom=game.add.button(20,540,"controlLeftRight",null,this,0,1,0,1),buttonWalkLeftBottom.alpha=0,buttonWalkLeftBottom.setFrames(2,2,2),buttonWalkLeftBottom.events.onInputOver.add(function(){walkLeft=!0}),buttonWalkLeftBottom.events.onInputOut.add(function(){walkLeft=!1}),buttonWalkLeftBottom.events.onInputDown.add(function(){walkLeft=!0}),buttonWalkLeftBottom.events.onInputUp.add(function(){walkLeft=!1}),buttonWalkRight=game.add.button(165,470,"rightControl",null,this,0,1,0,1),buttonWalkRight.alpha=.4,buttonWalkRight.events.onInputOver.add(function(){walkRight=!0}),buttonWalkRight.events.onInputOut.add(function(){walkRight=!1}),buttonWalkRight.events.onInputDown.add(function(){walkRight=!0}),buttonWalkRight.events.onInputUp.add(function(){walkRight=!1}),buttonWalkRightTop=game.add.button(165,430,"controlLeftRight",null,this,0,1,0,1),buttonWalkRightTop.alpha=0,buttonWalkRightTop.setFrames(0,0,0),buttonWalkRightTop.events.onInputOver.add(function(){walkRight=!0}),buttonWalkRightTop.events.onInputOut.add(function(){walkRight=!1}),buttonWalkRightTop.events.onInputDown.add(function(){walkRight=!0}),buttonWalkRightTop.events.onInputUp.add(function(){walkRight=!1}),buttonWalkRightBottom=game.add.button(165,540,"controlLeftRight",null,this,0,1,0,1),buttonWalkRightBottom.alpha=0,buttonWalkRightBottom.setFrames(1,1,1),buttonWalkRightBottom.events.onInputOver.add(function(){walkRight=!0}),buttonWalkRightBottom.events.onInputOut.add(function(){walkRight=!1}),buttonWalkRightBottom.events.onInputDown.add(function(){walkRight=!0}),buttonWalkRightBottom.events.onInputUp.add(function(){walkRight=!1}),buttonWalkUp=game.add.button(95,417,"rightControl",null,this,0,1,0,1),buttonWalkUp.alpha=.4,buttonWalkUp.rotation=-1.57,buttonWalkUp.anchor.setTo(.75,0),buttonWalkUp.events.onInputOver.add(function(){walkUp=!0}),buttonWalkUp.events.onInputOut.add(function(){walkUp=!1}),buttonWalkUp.events.onInputDown.add(function(){walkUp=!0}),buttonWalkUp.events.onInputUp.add(function(){walkUp=!1}),buttonWalkUpLeft=game.add.button(50,400,"controlUpDown",null,this,0,1,0,1),buttonWalkUpLeft.alpha=0,buttonWalkUpLeft.setFrames(3,3,3),buttonWalkUpLeft.events.onInputOver.add(function(){walkUp=!0}),buttonWalkUpLeft.events.onInputOut.add(function(){walkUp=!1}),buttonWalkUpLeft.events.onInputDown.add(function(){walkUp=!0}),buttonWalkUpLeft.events.onInputUp.add(function(){walkUp=!1}),buttonWalkUpRight=game.add.button(165,400,"controlUpDown",null,this,0,1,0,1),buttonWalkUpRight.alpha=0,buttonWalkUpRight.setFrames(2,2,2),buttonWalkUpRight.events.onInputOver.add(function(){walkUp=!0}),buttonWalkUpRight.events.onInputOut.add(function(){walkUp=!1}),buttonWalkUpRight.events.onInputDown.add(function(){walkUp=!0}),buttonWalkUpRight.events.onInputUp.add(function(){walkUp=!1}),buttonWalkDown=game.add.button(95,560,"leftControl",null,this,0,1,0,1),buttonWalkDown.alpha=.4,buttonWalkDown.rotation=-1.57,buttonWalkDown.anchor.setTo(.75,0),buttonWalkDown.events.onInputOver.add(function(){walkDown=!0}),buttonWalkDown.events.onInputOut.add(function(){walkDown=!1}),buttonWalkDown.events.onInputDown.add(function(){walkDown=!0}),buttonWalkDown.events.onInputUp.add(function(){walkDown=!1}),buttonWalkDownLeft=game.add.button(50,540,"controlUpDown",null,this,0,1,0,1),buttonWalkDownLeft.alpha=0,buttonWalkDownLeft.setFrames(1,1,1),buttonWalkDownLeft.events.onInputOver.add(function(){walkDown=!0}),buttonWalkDownLeft.events.onInputOut.add(function(){walkDown=!1}),buttonWalkDownLeft.events.onInputDown.add(function(){walkDown=!0}),buttonWalkDownLeft.events.onInputUp.add(function(){walkDown=!1}),buttonWalkDownRight=game.add.button(165,540,"controlUpDown",null,this,0,1,0,1),buttonWalkDownRight.alpha=0,buttonWalkDownRight.setFrames(0,0,0),buttonWalkDownRight.events.onInputOver.add(function(){walkDown=!0}),buttonWalkDownRight.events.onInputOut.add(function(){walkDown=!1}),buttonWalkDownRight.events.onInputDown.add(function(){walkDown=!0}),buttonWalkDownRight.events.onInputUp.add(function(){walkDown=!1}),buttonFireLeft=game.add.button(587,470,"leftControl",null,this,0,1,0,1),buttonFireLeft.alpha=.4,buttonFireLeft.events.onInputOver.add(function(){fireLeft=!0}),buttonFireLeft.events.onInputOut.add(function(){fireLeft=!1}),buttonFireLeft.events.onInputDown.add(function(){fireLeft=!0}),buttonFireLeft.events.onInputUp.add(function(){fireLeft=!1}),buttonFireLeftTop=game.add.button(587,430,"controlLeftRight",null,this,0,1,0,1),buttonFireLeftTop.alpha=0,buttonFireLeftTop.setFrames(3,3,3),buttonFireLeftTop.events.onInputOver.add(function(){fireLeft=!0}),buttonFireLeftTop.events.onInputOut.add(function(){fireLeft=!1}),buttonFireLeftTop.events.onInputDown.add(function(){fireLeft=!0}),buttonFireLeftTop.events.onInputUp.add(function(){fireLeft=!1}),buttonFireLeftBottom=game.add.button(587,540,"controlLeftRight",null,this,0,1,0,1),buttonFireLeftBottom.alpha=0,buttonFireLeftBottom.setFrames(2,2,2),buttonFireLeftBottom.events.onInputOver.add(function(){fireLeft=!0}),buttonFireLeftBottom.events.onInputOut.add(function(){fireLeft=!1}),buttonFireLeftBottom.events.onInputDown.add(function(){fireLeft=!0}),buttonFireLeftBottom.events.onInputUp.add(function(){fireLeft=!1}),buttonFireRight=game.add.button(732,470,"rightControl",null,this,0,1,0,1),buttonFireRight.alpha=.4,buttonFireRight.events.onInputOver.add(function(){fireRight=!0}),buttonFireRight.events.onInputOut.add(function(){fireRight=!1}),buttonFireRight.events.onInputDown.add(function(){fireRight=!0}),buttonFireRight.events.onInputUp.add(function(){fireRight=!1}),buttonFireRightTop=game.add.button(732,430,"controlLeftRight",null,this,0,1,0,1),buttonFireRightTop.alpha=0,buttonFireRightTop.setFrames(0,0,0),buttonFireRightTop.events.onInputOver.add(function(){fireRight=!0}),buttonFireRightTop.events.onInputOut.add(function(){fireRight=!1}),buttonFireRightTop.events.onInputDown.add(function(){fireRight=!0}),buttonFireRightTop.events.onInputUp.add(function(){fireRight=!1}),buttonFireRightBottom=game.add.button(732,540,"controlLeftRight",null,this,0,1,0,1),buttonFireRightBottom.alpha=0,buttonFireRightBottom.setFrames(1,1,1),buttonFireRightBottom.events.onInputOver.add(function(){fireRight=!0}),buttonFireRightBottom.events.onInputOut.add(function(){fireRight=!1}),buttonFireRightBottom.events.onInputDown.add(function(){fireRight=!0}),buttonFireRightBottom.events.onInputUp.add(function(){fireRight=!1}),buttonFireUp=game.add.button(662,417,"rightControl",null,this,0,1,0,1),buttonFireUp.alpha=.4,buttonFireUp.rotation=-1.57,buttonFireUp.anchor.setTo(.75,0),buttonFireUp.events.onInputOver.add(function(){fireUp=!0}),buttonFireUp.events.onInputOut.add(function(){fireUp=!1}),buttonFireUp.events.onInputDown.add(function(){fireUp=!0}),buttonFireUp.events.onInputUp.add(function(){fireUp=!1}),buttonFireUpLeft=game.add.button(617,400,"controlUpDown",null,this,0,1,0,1),buttonFireUpLeft.alpha=0,buttonFireUpLeft.setFrames(3,3,3),buttonFireUpLeft.events.onInputOver.add(function(){fireUp=!0}),buttonFireUpLeft.events.onInputOut.add(function(){fireUp=!1}),buttonFireUpLeft.events.onInputDown.add(function(){fireUp=!0}),buttonFireUpLeft.events.onInputUp.add(function(){fireUp=!1}),buttonFireUpRight=game.add.button(732,400,"controlUpDown",null,this,0,1,0,1),buttonFireUpRight.alpha=0,buttonFireUpRight.setFrames(2,2,2),buttonFireUpRight.events.onInputOver.add(function(){fireUp=!0}),buttonFireUpRight.events.onInputOut.add(function(){fireUp=!1}),buttonFireUpRight.events.onInputDown.add(function(){fireUp=!0}),buttonFireUpRight.events.onInputUp.add(function(){fireUp=!1}),buttonFireDown=game.add.button(662,560,"leftControl",null,this,0,1,0,1),buttonFireDown.alpha=.4,buttonFireDown.rotation=-1.57,buttonFireDown.anchor.setTo(.75,0),buttonFireDown.events.onInputOver.add(function(){fireDown=!0}),buttonFireDown.events.onInputOut.add(function(){fireDown=!1}),buttonFireDown.events.onInputDown.add(function(){fireDown=!0}),buttonFireDown.events.onInputUp.add(function(){fireDown=!1}),buttonFireDownLeft=game.add.button(617,540,"controlUpDown",null,this,0,1,0,1),buttonFireDownLeft.alpha=0,buttonFireDownLeft.setFrames(1,1,1),buttonFireDownLeft.events.onInputOver.add(function(){fireDown=!0}),buttonFireDownLeft.events.onInputOut.add(function(){fireDown=!1}),buttonFireDownLeft.events.onInputDown.add(function(){fireDown=!0}),buttonFireDownLeft.events.onInputUp.add(function(){fireDown=!1}),buttonFireDownRight=game.add.button(732,540,"controlUpDown",null,this,0,1,0,1),buttonFireDownRight.alpha=0,buttonFireDownRight.setFrames(0,0,0),buttonFireDownRight.events.onInputOver.add(function(){fireDown=!0}),buttonFireDownRight.events.onInputOut.add(function(){fireDown=!1}),buttonFireDownRight.events.onInputDown.add(function(){fireDown=!0}),buttonFireDownRight.events.onInputUp.add(function(){fireDown=!1})),resultBackground=game.add.sprite(-1e3,150,"scrollStrip"),resultText=game.add.bitmapText(140,185,"font","",32),this.tutorialText(),this.tutorialShow()},update:function(){""==tutorialDefence?(game.physics.arcade.collide(defenders,attackers,this.npcFight,null,this),game.physics.arcade.collide(attackers,attackers),game.physics.arcade.collide(defenders,defenders),game.physics.arcade.collide(player,obstacles),game.physics.arcade.collide(attackers,obstacles,this.attackerMove,null,this),game.physics.arcade.collide(defenders,obstacles),game.time.now>invulnerableTimer?(player.alpha=1,game.physics.arcade.collide(player,attackers,this.badTouchDefence,null,this)):player.alpha=.5,game.physics.arcade.collide(bullets,attackers,this.attackerKill,null,this),attackerCount<=0&&game.physics.arcade.collide(player,door,this.defenceDoorOpen,null,this),player.body.velocity.x=0,player.body.velocity.y=0,aKey.isDown||1==walkLeft?(player.body.velocity.x=-(runSpeed+runSpeedEndLevelAdjust),player.animations.play("left"),facing="left",manaRegenInterval=manaRegenHolder-manaRegenEndLevelAdjust):dKey.isDown||1==walkRight?(player.body.velocity.x=runSpeed+runSpeedEndLevelAdjust,player.animations.play("right"),facing="right",manaRegenInterval=manaRegenHolder-manaRegenEndLevelAdjust):wKey.isDown||1==walkUp?(player.body.velocity.y=-(runSpeed+runSpeedEndLevelAdjust),player.animations.play("up"),facing="up",manaRegenInterval=manaRegenHolder-manaRegenEndLevelAdjust):sKey.isDown||1==walkDown?(player.body.velocity.y=runSpeed+runSpeedEndLevelAdjust,player.animations.play("down"),facing="down",manaRegenInterval=manaRegenHolder-manaRegenEndLevelAdjust):(player.animations.stop(),manaRegenInterval=.25*(manaRegenHolder-manaRegenEndLevelAdjust)),(cursors.right.isDown||cursors.left.isDown||cursors.up.isDown||cursors.down.isDown||1==fireLeft||1==fireRight||1==fireUp||1==fireDown)&&game.time.now>bulletTimer&&player.isAlive&&mana>=manaCost&&(this.fire(),mana-=5,manaText.text="MP: "+mana+"/"+maxMana),this.manaRegen(),this.defenderUpdate(),this.attackerUpdate()):(player.body.velocity.x=0,player.body.velocity.y=0),spaceBar.isDown&&""!=tutorialDefence&&game.time.now>assistantChangeTimer&&(this.tutorialChange(),assistantChangeTimer=game.time.now+1e3),hpCrop.x=80*(1-health/maxHealth),hpBar.updateCrop(),manaCrop.x=80*(1-mana/maxMana),manaBar.updateCrop(),xpCrop.x=80*(1-xp/nextLevelXp),xpBar.updateCrop(),game.device.desktop||(walkLeft?(buttonWalkLeftTop.input.priorityID=1,buttonWalkUpLeft.input.priorityID=0,buttonWalkLeftBottom.input.priorityID=1,buttonWalkDownLeft.input.priorityID=0):walkUp?(buttonWalkLeftTop.input.priorityID=0,buttonWalkUpLeft.input.priorityID=1,buttonWalkRightTop.input.priorityID=0,buttonWalkUpRight.input.priorityID=1):walkRight?(buttonWalkRightTop.input.priorityID=1,buttonWalkUpRight.input.priorityID=0,buttonWalkRightBottom.input.priorityID=1,buttonWalkDownRight.input.priorityID=0):walkDown&&(buttonWalkLeftBottom.input.priorityID=0,buttonWalkDownLeft.input.priorityID=1,buttonWalkRightBottom.input.priorityID=0,buttonWalkDownRight.input.priorityID=1),fireLeft?(buttonFireLeftTop.input.priorityID=1,buttonFireUpLeft.input.priorityID=0,buttonFireLeftBottom.input.priorityID=1,buttonFireDownLeft.input.priorityID=0):fireUp?(buttonFireLeftTop.input.priorityID=0,buttonFireUpLeft.input.priorityID=1,buttonFireRightTop.input.priorityID=0,buttonFireUpRight.input.priorityID=1):fireRight?(buttonFireRightTop.input.priorityID=1,buttonFireUpRight.input.priorityID=0,buttonFireRightBottom.input.priorityID=1,buttonFireDownRight.input.priorityID=0):fireDown&&(buttonFireLeftBottom.input.priorityID=0,buttonFireDownLeft.input.priorityID=1,buttonFireRightBottom.input.priorityID=0,buttonFireDownRight.input.priorityID=1))},tutorialText:function(){tutorialText=game.add.bitmapText(200,477,"fontBorder","",15),tutorialText2=game.add.bitmapText(170,494,"fontBorder","",15),tutorialText3=game.add.bitmapText(158,509,"fontBorder","",15),tutorialText4=game.add.bitmapText(158,524,"fontBorder","",15),tutorialText5=game.add.bitmapText(170,539,"fontBorder","",15),tutorialText6=game.add.bitmapText(190,554,"fontBorder","",15),tutorialText.tint=0,tutorialText2.tint=0,tutorialText3.tint=0,tutorialText4.tint=0,tutorialText5.tint=0,tutorialText6.tint=0},tutorialTextDestroy:function(){null!=tutorialSprite&&(tutorialSprite.kill(),tutorialSpeechBubble.kill()),tutorialText.destroy(),tutorialText2.destroy(),tutorialText3.destroy(),tutorialText4.destroy(),tutorialText5.destroy(),tutorialText6.destroy()},defenderCreate:function(a,b){if(Math.random()<.5){var c=defenders.create(a,b,"warriorMan");c.gender="male"}else{var c=defenders.create(a,b,"warriorWoman");c.gender="female"}c.health=defenceStrength-2,c.maxHealth=defenceStrength-2,c.fighting=!1,c.timer=game.time.now,game.physics.arcade.enable(c),c.body.collideWorldBounds=!0,c.healthBarBack=c.addChild(game.add.graphics(0,0)),c.healthBarBack.lineStyle(3,12203264,1),c.healthBarBack.moveTo(0,0),c.healthBarBack.lineTo(20,0),c.healthBar=c.addChild(game.add.graphics(0,0)),c.healthBar.lineStyle(3,16767232,1),c.healthBar.moveTo(0,0),c.healthBar.lineTo(20*(c.health/c.maxHealth),0),c.healthBarBack.visible=!1,c.healthBar.visible=!1,c.animations.add("defenderLeft",[9,10,11],15,!0),c.animations.add("defenderRight",[3,4,5],15,!0),c.animations.add("defenderStop",[4],15,!0),c.animations.play("defenderStop")},defenderUpdate:function(){defenders.forEach(function(a){a.body.velocity.x=0,a.body.velocity.y=0,a.healthBar.clear(),a.healthBar.lineStyle(3,16767232,1),a.healthBar.moveTo(0,0),a.healthBar.lineTo(20*(a.health/a.maxHealth),0),Math.abs(player.x-a.x)+Math.abs(player.y-a.y)>300&&0==a.fighting?(game.physics.arcade.moveToObject(a,player,115),player.x<a.x?a.animations.play("defenderLeft"):a.animations.play("defenderRight")):a.animations.play("defenderStop")})},attackerCreate:function(a,b){var c=attackers.create(a,b,"attacker");c.health=attackStrength-3,c.maxHealth=attackStrength-3,c.timer=game.time.now,c.fighting=!1,game.physics.arcade.enable(c),c.body.collideWorldBounds=!0,c.healthBarBack=c.addChild(game.add.graphics(0,0)),c.healthBarBack.lineStyle(3,12203264,1),c.healthBarBack.moveTo(0,0),c.healthBarBack.lineTo(20,0),c.healthBar=c.addChild(game.add.graphics(0,0)),c.healthBar.lineStyle(3,16767232,1),c.healthBar.moveTo(0,0),c.healthBar.lineTo(20*(c.health/c.maxHealth),0),c.healthBarBack.visible=!1,c.healthBar.visible=!1,c.animations.add("attackerLeft",[9,10,11],15,!0),c.animations.add("attackerRight",[3,4,5],15,!0),c.animations.add("attackerStop",[10],15,!0),c.animations.play("attackerStop")},attackerUpdate:function(){attackers.forEach(function(a){a.body.velocity.x=0,a.body.velocity.y=0,a.healthBar.clear(),a.healthBar.lineStyle(3,16767232,1),a.healthBar.moveTo(0,0),a.healthBar.lineTo(20*(a.health/a.maxHealth),0),0==a.fighting?game.physics.arcade.moveToObject(a,player,110):a.animations.play("attackerStop"),player.body.x<a.body.x?a.animations.play("attackerLeft"):a.animations.play("attackerRight")})},attackerMove:function(a){a.y<player.y?a.y+=2:a.y-=2},attackerKill:function(a,b){if(this.smallExplosion(a.x,a.y),Math.random()>.66&&("left"==a.travel?b.x-=knockback:"right"==a.travel?b.x+=knockback:"up"==a.travel?b.y-=knockback:"down"==a.travel&&(b.y+=knockback)),a.kill(),b.health<=shotPower){b.kill(),this.maleDeathSFX();var c=game.add.sprite(b.x,b.y,"deathSheet");c.frame=2,game.time.events.add(1*Phaser.Timer.SECOND,function(){c.kill()}),xp+=4,this.xpDisplayConvert(),attackerCount--,this.checkLevelUp(),this.checkDefenceComplete()}else b.health-=shotPower,b.healthBarBack.visible=!0,b.healthBar.visible=!0},smallExplosion:function(a,b){var c=game.add.sprite(a,b,"explosionMini");c.animations.add("explosion",[0,1,2,3],30,!1),c.animations.play("explosion"),this.shortExplodeSFX(),game.time.events.add(.2*Phaser.Timer.SECOND,function(){c.destroy()})},fire:function(){var a=bullets.getFirstExists(!1);a.reset(player.x+10,player.y+15),a.animations.add("spin",[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25],13,!0);var b=game.add.emitter(game.world.centerX,game.world.centerY,20);b.makeParticles("bulletParticles",[0,1,2,3]),b.gravity.y=0,b.forEach(function(a){a.body.allowGravity=!1},this),b.start(!1,500,50),a.addChild(b),game.time.events.add(.5*Phaser.Timer.SECOND,function(){b.destroy()}),b.x=0,b.y=0,a.scale.x=.8,a.scale.y=.8,a.lifespan=832/shotSpeed*1e3,cursors.left.isDown||1==fireLeft?(game.physics.arcade.moveToXY(a,0,a.y,shotSpeed),a.animations.play("spin"),a.travel="left",b.minParticleSpeed.set(-shotSpeed,0),b.maxParticleSpeed.set(-shotSpeed,0),b.rotation=3.14,b.x=-14,b.y=-8):cursors.right.isDown||1==fireRight?(game.physics.arcade.moveToXY(a,832,a.y,shotSpeed),a.animations.play("spin"),a.travel="right",b.minParticleSpeed.set(shotSpeed,0),b.maxParticleSpeed.set(shotSpeed,0),b.rotation=3.14,b.x=14,b.y=-8):cursors.up.isDown||1==fireUp?(game.physics.arcade.moveToXY(a,a.x,0,shotSpeed),a.animations.play("spin"),a.travel="up",b.minParticleSpeed.set(0,-shotSpeed),b.maxParticleSpeed.set(0,-shotSpeed),b.rotation=3.14,b.x=-8,b.y=-14):(cursors.down.isDown||1==fireDown)&&(game.physics.arcade.moveToXY(a,a.x,600,shotSpeed),a.animations.play("spin"),a.travel="down",b.minParticleSpeed.set(0,shotSpeed),b.maxParticleSpeed.set(0,shotSpeed),b.rotation=3.14,b.x=-8,b.y=14),this.pew(),bulletTimer=game.time.now+bulletSpacing},pew:function(){var a=game.add.audio("pew");a.play()},shortExplodeSFX:function(){var a=game.add.audio("shortExplode");a.play()},maleDeathSFX:function(){var a=game.add.audio("maleDeath");a.play()},femaleDeathSFX:function(){var a=game.add.audio("femaleDeath");a.play()},badTouchDefence:function(){if(health>attackStrength-7){health-=attackStrength-7;var a=game.add.audio("grunt");a.play(),healthText.text="HP: "+health+"/"+maxHealth,invulnerableTimer=game.time.now+invulnerableSpacing}else{player.kill(),this.maleDeathSFX();var b=game.add.sprite(player.x,player.y,"deathSheet");b.frame=0;var c=game.add.audio("teleport");game.time.events.add(1*Phaser.Timer.SECOND,function(){b.kill();var a=game.add.sprite(b.x+5,b.y+5,"playerTeleport");a.animations.add("teleport",[0,1,2,3],8,!1),a.animations.play("teleport"),c.play(),defenceAudio.stop(),game.time.events.add(.5*Phaser.Timer.SECOND,function(){a.kill()})}),player.isAlive=!1,population-=defenceStrength,tutorialDefence="defeat",this.tutorialShow(),healthText.text="HP: 0/"+maxHealth,resultBackground.x=96,resultText.text=" Your Majesty, it is time to come home!",endLevelButton=game.add.button(305,250,"blankButton",this.defenceComplete,this),game.add.bitmapText(355,280,"font","Return to my City",16)}},checkLevelUp:function(){for(;xp>=nextLevelXp;){levelUpImage=game.add.sprite(132,15,"levelUp"),levelUpImage.animations.add("flash",[0,1,2],6,!0),levelUpImage.animations.play("flash");var a=game.add.audio("levelUpSound");a.play(),game.time.events.add(1*Phaser.Timer.SECOND,function(){levelUpImage.kill()}),xp-=nextLevelXp,nextLevelXp+=Math.round(8+.75*playerLevel),maxHealth++,maxMana++,shotPower+=.025,health=maxHealth,mana=maxMana,playerLevel++,this.xpDisplayConvert(),manaText.text="MP: "+mana+"/"+maxMana,healthText.text="HP: "+health+"/"+maxHealth,playerLevelText.text=playerLevel}},checkDefenceComplete:function(){attackerCount<=0&&player.isAlive&&(player.x<75&&player.y<145?(doorway=game.add.sprite(750,70,"doorway"),door=game.add.sprite(750,70,"animateddoor")):(doorway=game.add.sprite(5,70,"doorway"),door=game.add.sprite(5,70,"animateddoor")),door.animations.add("openDoor",[0,1,2,3],4,!1),game.physics.arcade.enable(door),door.body.immovable=!0,defenderCount/defenceStrength>=.5?(newCitizens=attackStrength-(defenceStrength-defenderCount)+2,population+=newCitizens,attackStrength++,tutorialDefence="victory",this.tutorialShow()):defenderCount/defenceStrength>=.25?(newCitizens=Math.round(1+attackStrength/10),population+=newCitizens,tutorialDefence="victory",this.tutorialShow()):(population++,tutorialDefence="narrowVictory",this.tutorialShow()))},defenceComplete:function(){defending=!1,game.world.removeAll(),game.state.start("city")},defenceDoorOpen:function(){door.animations.play("openDoor");var a=game.add.audio("creakylightwoodendoor1");a.play(),player.kill(),defenceAudio.stop();var b=this;game.time.events.add(2*Phaser.Timer.SECOND,function(){b.defenceComplete()})},manaRegen:function(){game.time.now>manaRegenTimer&&mana<maxMana&&(mana++,manaRegenTimer=game.time.now+manaRegenInterval,manaText.text="MP: "+mana+"/"+maxMana)},npcFight:function(a,b){if(a.timer<game.time.now)if(a.sword=a.addChild(game.add.sprite(20,0,"sword")),a.sword.animations.add("swing",[0,1,2,2,1,0],6,!0),a.sword.animations.play("swing"),a.fighting=!0,game.time.events.add(1*Phaser.Timer.SECOND,function(){a.fighting=!1,a.sword.kill()}),a.health<=attackStrength-7){a.kill();var c=game.add.sprite(a.x,a.y,"deathSheet");"male"==a.gender?(c.frame=8,this.maleDeathSFX()):(c.frame=9,this.femaleDeathSFX()),game.time.events.add(1*Phaser.Timer.SECOND,function(){c.kill()}),defenderCount--}else a.health-=attackStrength-7,a.timer=game.time.now+1e3,a.healthBarBack.visible=!0,a.healthBar.visible=!0;if(b.timer<game.time.now)if(b.sword=b.addChild(game.add.sprite(-12,0,"sword")),b.sword.animations.add("swing",[3,4,5,5,4,3],6,!0),b.sword.animations.play("swing"),b.fighting=!0,game.time.events.add(1*Phaser.Timer.SECOND,function(){b.fighting=!1,b.sword.kill()}),b.health<=1){b.kill(),this.maleDeathSFX();var c=game.add.sprite(b.x,b.y,"deathSheet");c.frame=2,game.time.events.add(1*Phaser.Timer.SECOND,function(){c.kill()}),attackerCount--,xp+=4,this.checkDefenceComplete()}else b.health--,b.timer=game.time.now+1e3,b.healthBarBack.visible=!0,b.healthBar.visible=!0},tutorialShow:function(){switch(tutorialDefence){case"first":tutorialSprite=game.add.sprite(350,469,"assistant"),tutorialSpeechBubble=game.add.button(150,469,"speechBubble",this.tutorialChange,this),this.tutorialText(),tutorialText.text=" Your Majesty!",tutorialText2.text="   Our defenders will",tutorialText3.text=" shield you if you stay ",tutorialText4.text=" behind them. You should ",tutorialText5.text=" keep your distance from",tutorialText6.text="  the enemy.";break;case"second":this.tutorialTextDestroy(),tutorialSprite=game.add.sprite(350,469,"assistant"),tutorialSpeechBubble=game.add.button(150,469,"speechBubble",this.tutorialChange,this),this.tutorialText(),tutorialText.text="  A convincing",tutorialText2.text=" victory may be enough",tutorialText3.text="   to persuade the people",tutorialText4.text="    of neighbouring cities",tutorialText5.text="     to move here for",tutorialText6.text="  their protection.",assistant="tutorialEnd";break;case"victory":this.tutorialTextDestroy(),tutorialSprite=game.add.sprite(350,469,"assistant"),tutorialSpeechBubble=game.add.button(150,469,"speechBubble",this.tutorialChange,this),this.tutorialText(),tutorialText.text="  You fought",tutorialText2.text="  them off! As news of",tutorialText3.text="   your victory spread our",tutorialText4.text="      city attracted "+newCitizens+" new ",tutorialText5.text="   immigrants to bolster ",tutorialText6.text="      our ranks.";break;case"narrowVictory":this.tutorialTextDestroy(),tutorialSprite=game.add.sprite(350,469,"assistant"),tutorialSpeechBubble=game.add.button(150,469,"speechBubble",this.tutorialChange,this),this.tutorialText(),tutorialText.text="  A narrow",tutorialText2.text="   victory, but a victory",tutorialText3.text="  nonetheless. 1 new citizen",tutorialText4.text="  moved to our city when",tutorialText5.text="  word of your success",tutorialText6.text="      spread.";break;case"defeat":this.tutorialTextDestroy(),tutorialSprite=game.add.sprite(350,469,"assistant"),tutorialSpeechBubble=game.add.button(150,469,"speechBubble",this.tutorialChange,this),this.tutorialText(),tutorialText.text="  Oh no! Our",tutorialText2.text="  forces were routed.",tutorialText3.text="  Our reserves fought off",tutorialText4.text="  the attackers but the raid",tutorialText5.text="   killed "+defenceStrength+" of our",tutorialText6.text="   citizens.";break;case"":tutorialText.text="",tutorialText2.text="",tutorialText3.text="",tutorialText4.text="",tutorialText5.text="",tutorialText6.text="",null!=tutorialSprite&&(tutorialSprite.kill(),tutorialSpeechBubble.kill())}},tutorialChange:function(){switch(tutorialDefence){case"first":tutorialDefence="second",this.tutorialShow();break;case"second":tutorialDefence="",tutorialSprite.kill(),tutorialSpeechBubble.kill(),this.tutorialShow();break;case"victory":tutorialDefence="",tutorialSprite.kill(),tutorialSpeechBubble.kill(),this.tutorialShow();break;case"narrowVictory":tutorialDefence="",tutorialSprite.kill(),tutorialSpeechBubble.kill(),this.tutorialShow();break;case"defeat":tutorialDefence="",tutorialSprite.kill(),tutorialSpeechBubble.kill(),this.tutorialShow()}},xpDisplayConvert:function(){xpDisplay=xp>=1e3?Math.round(xp/100)/10+"k":Math.round(xp),nextLevelXpDisplay=nextLevelXp>=1e3?Math.round(nextLevelXp/100)/10+"k":Math.round(nextLevelXp),xpText.text="XP: "+xpDisplay+"/"+nextLevelXpDisplay}},cutScene,typewriter,lowerTypewriter,skipText,introMusic,introState={create:function(){introMusic=game.add.audio("introCreditsMusic"),introMusic.play(),cutScene=game.add.sprite(0,0,"introCutscene"),game.add.sprite(0,0,"cutsceneBorder"),game.add.button(-5,-5,"blankButton",this.skip,this),skipText=game.add.bitmapText(40,20,"font","Skip Cutscene",16),lowerTypewriter=new Typewriter,lowerTypewriter.init(game,{x:116,y:490,time:Phaser.Timer.SECOND/20,fontFamily:"font",fontSize:16,maxWidth:600,endFn:this.startButtonTextChange,text:"Centuries passed, many of the Kings and Queens who followed ruled wisely, but many more did not. The outlying Provinces broke away and grew hostile, leaving behind only an embattled core barely larger than a city state. Now the crops have failed again, your country is on the brink, and the horrors have returned to the badlands . . . ."}),typewriter=new Typewriter,typewriter.init(game,{x:116,y:65,time:Phaser.Timer.SECOND/20,fontFamily:"font",fontSize:16,maxWidth:600,text:"The legends tell of a King of old, the first King, the founder of your dynasty. A King who, when the crops failed and his people were hungry, when the economy collapsed and his people lost hope, refused to surrender to despair. A King who instead undertook a great quest to vanquish the horrors of the badlands, and use their despoiled treasure to rebuild his shattered kingdom.",endFn:this.lowerTypewriterStart}),typewriter.start()},update:function(){cutScene.scale.x+=.001,cutScene.scale.y+=.001,cutScene.x=-Math.floor(600*(cutScene.scale.x-1)),cutScene.y=-Math.floor(300*(cutScene.scale.y-1))},skip:function(){introMusic.stop(),game.state.start("city")},lowerTypewriterStart:function(){game.time.events.add(1.5*Phaser.Timer.SECOND,function(){lowerTypewriter.start()})},startButtonTextChange:function(){skipText.text="Start Game"}},platforms,player,playerLevel=1,facing,bullets,bulletTimer=0,bulletSpacing=525,beamWeapon=!1,shotSpeed=320,manaCost=5,flameBullets,flameBulletSpacing=4250,iceBeams,charges,waterShots,freezeTimer=0,invulnerableTimer=0,invulnerableSpacing=800,manaRegenTimer=0,manaRegenHolder=490,manaRegenEndLevelAdjust=0,manaRegenInterval=manaRegenHolder,manaRefillAvailable=!1,first=!0,timerBeam,timerBeamEvent,timerMana,timerManaEvent,baddies,flames,skeletons,swordZombies,mummies,evilwizards,zombieBirds,miniZombieBirds,spiders,swampCreatures,treeBeasts,evilRoots,vampires,decoys,bossZombies,bossZombieBirds,bossMummies,bossFinals,bossZombieKilled=!1,bossTreeBeastKilled=!1,bossSkeletonKilled=!1,bossZombieBirdKilled=!1,bossMummyKilled=!1,bossFinalKilled=!1,cursors,fireButton,wKey,aKey,sKey,dKey,qKey,buttonFireLeft,fireLeft=!1,buttonFireRight,fireRight=!1,buttonFireUp,fireUp=!1,buttonFireDown,fireDown=!1,buttonWalkLeft,walkLeft=!1,buttonWalkRight,walkRight=!1,buttonWalkUp,walkUp=!1,buttonWalkDown,walkDown=!1,stars,door,doorAvailable=!1,levelUpImage,coins=2e3,stage=1,reward=0,hudDisplay,hpBar,manaBar,xpBar,hpCrop,manaCrop,xpCrop,stageText,coinDisplay,coinsText,healthText,resultBackground,levelRecordBackground,resultText,resultText2,resultText3,levelRecord,levelRecord2,levelRecord3,playerLevelText,xpText,manaText,beamSprite,beamText,bottleSprite,bottleText,manaWarn=!1,xp=0,xpDisplay=0,nextLevelXp=10,nextLevelXpDisplay=10,health=5,maxHealth=5,mana=75,maxMana=75,starTotal=8,baddieTotal=7,baddieCount=7,baddieAdjuster=0,baddieDamageAdjuster=1,baddieHpAdjuster=1,baddieXpAdjuster=1,baddieSpeedAdjuster=1,baddieCreated=0,chestCreated=0,flameCount=0,evilwizardCount=0,zombieBirdCount=0,swampCreatureCount=0,shotPower=1.35,knockback=1,runSpeed=190,runSpeedEndLevelAdjust=0,nullArray=[66,67,68,69,70,71,79,80,81,82,83,84,92,93,94,95,96,97,105,106,107,108,109,110,118,119,120,121,122,123],array=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130],sceneryCount=0,backgroundScene="",gameMusic,advertImage,adStopTime,adTimeText,beamSFX,waterShotSFX,flameShot,zombieDeathSFX,shortExplodeSFX,collectSFX,pewSound,swordZombieTest=!1,playState={
create:function(){for(game.device.desktop||(game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,game.scale.fullScreenScaleMode=Phaser.ScaleManager.EXACT_FIT,game.input.onDown.add(this.gofull,this)),game.world.removeAll(),game.time.advancedTiming=!0,game.physics.startSystem(Phaser.Physics.ARCADE),Math.random()>.66||stage-100*Math.floor(stage/100)==50||stage-100*Math.floor(stage/100)==60?(game.add.sprite(0,0,"field"),backgroundScene="wasteland",gameMusic=game.add.audio("wastelandMusic"),gameMusic.play()):Math.random()<.34?(game.add.sprite(0,0,"stonepavingOvergrown"),backgroundScene="ruins",gameMusic=game.add.audio("ruinsMusic"),gameMusic.play()):(game.add.sprite(0,0,"forestBackground"),backgroundScene="forest",gameMusic=game.add.audio("forestMusic"),gameMusic.play()),coinsText=coins>=1e6?game.add.bitmapText(395,10,"font",Math.round(coins/1e3)/1e3+"M",30):game.add.bitmapText(395,10,"font",coins,30),hudDisplay=game.add.sprite(0,0,"hudDisplay"),hudDisplay.scale.setTo(1.1,1.1),hpBar=game.add.sprite(92,7,"hudBarRed"),hpBar.scale.setTo(1.1,1.1),hpCrop=new Phaser.Rectangle(0,0,88,15),hpBar.crop(hpCrop),healthText=game.add.bitmapText(93,7,"fontWhite","HP: "+health+"/"+maxHealth,15),manaBar=game.add.sprite(92,28,"hudBarBlue"),manaBar.scale.setTo(1.1,1.1),manaCrop=new Phaser.Rectangle(0,0,88,15),manaBar.crop(manaCrop),manaText=game.add.bitmapText(93,28,"fontWhite","MP: "+mana+"/"+maxMana,15),xpBar=game.add.sprite(92,50,"hudBarGreen"),xpBar.scale.setTo(1.1,1.1),xpCrop=new Phaser.Rectangle(0,0,88,15),xpBar.crop(xpCrop),xpText=game.add.bitmapText(93,50,"fontWhite","XP: "+xpDisplay+"/"+nextLevelXpDisplay,15),this.xpDisplayConvert(),playerLevelText=playerLevel>=100?game.add.bitmapText(9,23,"font",playerLevel,30):playerLevel>=10?game.add.bitmapText(18,23,"font",playerLevel,30):game.add.bitmapText(26,23,"font",playerLevel,30),stageText=game.add.bitmapText(600,10,"font","Stage: "+stage,30),coinsText.alpha=.7,xpText.alpha=.7,healthText.alpha=.7,manaText.alpha=.7,playerLevelText.alpha=.7,stageText.alpha=.7,coinDisplay=game.add.sprite(360,8,"coin"),coinDisplay.frame=0,player=game.add.sprite(16,game.world.height-50,"dude"),game.physics.arcade.enable(player),player.body.setSize(27,32,2,2),player.body.collideWorldBounds=!0,player.isAlive=!0,player.animations.add("left",[9,10,11],10,!0),player.animations.add("right",[3,4,5],10,!0),player.animations.add("up",[0,1,2],10,!0),player.animations.add("down",[6,7,8],10,!0),bullets=game.add.group(),bullets.enableBody=!0,bullets.createMultiple(90,"bullet"),pewSound=game.add.audio("pew"),shortExplodeSFX=game.add.audio("shortExplode"),flameBullets=game.add.group(),flameBullets.enableBody=!0,iceBeams=game.add.group(),iceBeams.enableBody=!0,iceBeams.createMultiple(110,"iceBeamMini"),charges=game.add.group(),charges.enableBody=!0,waterShots=game.add.group(),waterShots.enableBody=!0,waterShots.createMultiple(6,"waterShot"),miniZombieBirds=game.add.group(),miniZombieBirds.enableBody=!0,miniZombieBirds.createMultiple(23,"miniZombieBird"),skeletons=game.add.group(),skeletons.enableBody=!0,mummies=game.add.group(),mummies.enableBody=!0,baddies=game.add.group(),baddies.enableBody=!0,zombieDeathSFX=game.add.audio("zombieDeath"),zombieDeathSFX.allowMultiple=!0,swordZombies=game.add.group(),swordZombies.enableBody=!0,flames=game.add.group(),flames.enableBody=!0,evilwizards=game.add.group(),evilwizards.enableBody=!0,zombieBirds=game.add.group(),zombieBirds.enableBody=!0,spiders=game.add.group(),spiders.enableBody=!0,swampCreatures=game.add.group(),swampCreatures.enableBody=!0,treeBeasts=game.add.group(),treeBeasts.enableBody=!0,evilRoots=game.add.group(),evilRoots.enableBody=!0,bossZombies=game.add.group(),bossZombies.enableBody=!0,bossZombieBirds=game.add.group(),bossZombieBirds.enableBody=!0,bossMummies=game.add.group(),bossMummies.enableBody=!0,bossFinals=game.add.group(),bossFinals.enableBody=!0,vampires=game.add.group(),vampires.enableBody=!0,decoys=game.add.group(),decoys.enableBody=!0,platforms=game.add.group(),platforms.enableBody=!0,swordZombieTest&&(this.evilwizardCreate(600,300),beamSFX=game.add.audio("shotSFX"),baddieCreated=baddieTotal),stage-100*Math.floor(stage/100)==50&&0==bossZombieKilled&&(stage>=150?this.bossZombieCreate(760,200,"red"):this.bossZombieCreate(760,200,"green"),baddieCreated=baddieTotal,this.treeCreate(300,0),this.treeCreate(360,570),this.treeCreate(0,384),this.treeCreate(790,448)),stage-100*Math.floor(stage/100)==60&&0==bossTreeBeastKilled&&(this.treeBeastCreate(64,64),this.treeBeastCreate(448,54),this.treeBeastCreate(704,74),this.treeBeastCreate(192,128),this.treeBeastCreate(458,138),this.treeBeastCreate(438,192),this.treeBeastCreate(640,182),this.treeBeastCreate(128,256),this.treeBeastCreate(384,266),this.treeBeastCreate(128,320),this.treeBeastCreate(694,310),this.treeBeastCreate(512,384),this.treeBeastCreate(320,448),this.treeBeastCreate(650,512),baddieCreated=baddieTotal,baddieCount-=.1*stageMilestone,this.treeCreate(256,64),this.treeCreate(576,256),this.treeCreate(64,384),this.treeCreate(704,448),this.treeCreate(128,512),this.treeCreate(448,512),sceneryCount=28),stage-100*Math.floor(stage/100)==70&&0==bossSkeletonKilled&&(this.skeletonCreate(750,200,"redBoss"),flameShot=game.add.audio("flameShot"),baddieCreated=baddieTotal),stage-100*Math.floor(stage/100)==80&&0==bossZombieBirdKilled&&(this.bossZombieBirdCreate(750,200),baddieCreated=baddieTotal),stage-100*Math.floor(stage/100)==90&&0==bossMummyKilled&&(this.bossMummyCreate(750,200),baddieCreated=baddieTotal);baddieCreated<baddieTotal;){var a=array[Math.floor(Math.random()*array.length-1)];if(nullArray.indexOf(a)>=0);else if(array.indexOf(a)>=0&&Math.random()>.85-.01*stage){f=a%13,f<1&&(f=13);var b=64*(f-1),c=64*Math.floor((array[a]-1)/13);(c<0||c.isNaN)&&(c=0),Math.random()>.6&&baddieTotal>11&&.1*(baddieTotal-baddieCreated)>9?(this.vampireCreate(b,c),baddieCreated+=11,i=array.indexOf(a),i>-1&&array.splice(i,1)):Math.random()>.6&&baddieTotal>10&&.13*(baddieTotal-baddieCreated)>9&&evilwizardCount<1?(this.evilwizardCreate(b,c),baddieCreated+=10,evilwizardCount++,beamSFX=game.add.audio("shotSFX"),i=array.indexOf(a),i>-1&&array.splice(i,1)):"wasteland"==backgroundScene&&baddieTotal>9&&.13*(baddieTotal-baddieCreated)>7.5?(this.treeBeastCreate(b,c),baddieCreated+=9,i=array.indexOf(a),i>-1&&array.splice(i,1)):Math.random()>.55&&baddieTotal>9&&.13*(baddieTotal-baddieCreated)>7.5&&swampCreatureCount<1?(this.swampCreatureCreate(b,c),baddieCreated+=9,swampCreatureCount++,waterShotSFX=game.add.audio("bubble"),i=array.indexOf(a),i>-1&&array.splice(i,1)):Math.random()>.5&&baddieTotal>8&&.14*(baddieTotal-baddieCreated)>6.5&&zombieBirdCount<=5?(this.zombieBirdCreate(b,c),baddieCreated+=8,zombieBirdCount++,i=array.indexOf(a),i>-1&&array.splice(i,1)):Math.random()>.45&&baddieTotal>7&&.15*(baddieTotal-baddieCreated)>5.5?(this.mummyCreate(b,c),baddieCreated+=7,i=array.indexOf(a),i>-1&&array.splice(i,1)):Math.random()>.4&&baddieTotal>6&&.2*(baddieTotal-baddieCreated)>5.5&&flameCount<=2?(this.flameCreate(b,c),baddieCreated+=6,flameCount+=1,flameShot=game.add.audio("flameShot"),i=array.indexOf(a),i>-1&&array.splice(i,1)):Math.random()>.3&&baddieTotal>baddieCreated&&baddieTotal>5&&.17*(baddieTotal-baddieCreated)>3.5?(100*Math.random()>117-stage?this.skeletonCreate(b,c,"red"):this.skeletonCreate(b,c,"grey"),baddieCreated+=5,i=array.indexOf(a),i>-1&&array.splice(i,1)):Math.random()>.25&&baddieTotal>baddieCreated&&baddieTotal>4&&.14*(baddieTotal-baddieCreated)>2?(100*Math.random()>108-stage?this.swordZombieCreate(b,c,"red"):this.swordZombieCreate(b,c,"green"),baddieCreated+=4,i=array.indexOf(a),i>-1&&array.splice(i,1)):Math.random()>.2&&baddieTotal>baddieCreated&&baddieTotal>3&&.2*(baddieTotal-baddieCreated)>2?(this.spiderCreate(b,c),baddieCreated+=3,i=array.indexOf(a),i>-1&&array.splice(i,1)):baddieTotal>baddieCreated&&(100*Math.random()>101-stage?this.baddieCreate(b,c,"red"):this.baddieCreate(b,c,"green"),baddieCreated++,i=array.indexOf(a),i>-1&&array.splice(i,1))}}for(stars=game.add.group(),stars.enableBody=!0,collectSFX=game.add.audio("collect");chestCreated+1<starTotal;){var d=780*Math.random(.05,1),e=580*Math.random(.1,1);starTotal-chestCreated>20?(this.coinCreate(d,e,"yellow"),chestCreated+=25):starTotal-chestCreated>10?(this.coinCreate(d,e,"green"),chestCreated+=10):starTotal-chestCreated>4?(this.coinCreate(d,e,"blue"),chestCreated+=5):(this.coinCreate(d,e,"red"),chestCreated+=2)}for(var a=0;a<117;a++)if(array.indexOf(a)>=0&&array[a]>14&&array[a]<117&&array[a]%13>1&&sceneryCount<28){var f=array[a]%13;f<1&&(f=13);var i,g=64*(f-1)+Math.round(10*Math.random()),h=64*Math.floor((array[a]-1)/13)+Math.round(10*Math.random()),j=1+(1-sceneryCount/28)+.001*stage;if(Math.random()<.1*j){if("wasteland"==backgroundScene){var k=platforms.create(g,h,"tree");k.body.setSize(35,20,0,33),k.body.immovable=!0,k.Shadow=k.addChild(game.add.sprite(-18,11,"treeShadow")),k.Shadow.alpha=.35}else if("ruins"==backgroundScene){var l=platforms.create(g,h,"statue");l.body.setSize(30,24,1,45),l.body.immovable=!0,l.frame=Math.floor(4.99*Math.random())}else{var m=platforms.create(g,h,"largeTree");m.body.setSize(36,21,10,50),m.body.immovable=!0}sceneryCount++,i=array.indexOf(a),i>-1&&array.splice(i,1)}else if(Math.random()>1-.1*j){if("wasteland"==backgroundScene){var n=platforms.create(g,h,"rock");n.body.immovable=!0,n.body.setSize(32,17,0,9)}else if("ruins"==backgroundScene){var o=platforms.create(g,h-8,"pillars");o.body.immovable=!0,o.body.setSize(32,32,0,64),o.frame=Math.floor(2.99*Math.random())}else{var p=platforms.create(g,h,"forestScenery");p.body.setSize(23,16,4,4),p.body.immovable=!0,p.frame=Math.floor(2.99*Math.random())}sceneryCount++,i=array.indexOf(a),i>-1&&array.splice(i,1)}else if(Math.random()>=.2&&Math.random()<.3*(j/3)){if("wasteland"==backgroundScene){var q=platforms.create(g,h,"gravestone");q.body.immovable=!0,q.body.setSize(19,10,0,18)}else if("ruins"==backgroundScene)l=platforms.create(g,h,"statue"),l.body.setSize(30,18,1,45),l.body.immovable=!0,l.frame=Math.floor(4.99*Math.random());else{var m=platforms.create(g,h,"largeTree");m.body.setSize(36,21,10,50),m.body.immovable=!0}sceneryCount++,i=array.indexOf(a),i>-1&&array.splice(i,1)}else if(28-sceneryCount>=116-array[a]){if("wasteland"==backgroundScene)k=platforms.create(g,h,"tree"),k.body.setSize(35,20,0,33),k.body.immovable=!0,k.Shadow=k.addChild(game.add.sprite(-18,11,"treeShadow")),k.Shadow.alpha=.35;else if("ruins"==backgroundScene)o=platforms.create(g,h-8,"pillars"),o.body.immovable=!0,o.body.setSize(32,32,0,64),o.frame=Math.floor(2.99*Math.random());else{var p=platforms.create(g,h,"forestScenery");p.body.setSize(23,16,4,4),p.body.immovable=!0,p.frame=Math.floor(2.99*Math.random())}sceneryCount++,i=array.indexOf(a),i>-1&&array.splice(i,1)}}if(cursors=game.input.keyboard.createCursorKeys(),fireButton=game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),wKey=game.input.keyboard.addKey(Phaser.Keyboard.W),aKey=game.input.keyboard.addKey(Phaser.Keyboard.A),sKey=game.input.keyboard.addKey(Phaser.Keyboard.S),dKey=game.input.keyboard.addKey(Phaser.Keyboard.D),qKey=game.input.keyboard.addKey(Phaser.Keyboard.Q),game.device.desktop||(buttonWalkLeft=game.add.button(20,470,"leftControl",null,this,0,1,0,1),buttonWalkLeft.alpha=.4,buttonWalkLeft.events.onInputOver.add(function(){walkLeft=!0}),buttonWalkLeft.events.onInputOut.add(function(){walkLeft=!1}),buttonWalkLeft.events.onInputDown.add(function(){walkLeft=!0}),buttonWalkLeft.events.onInputUp.add(function(){walkLeft=!1}),buttonWalkLeftTop=game.add.button(20,430,"controlLeftRight",null,this,0,1,0,1),buttonWalkLeftTop.alpha=0,buttonWalkLeftTop.setFrames(3,3,3),buttonWalkLeftTop.events.onInputOver.add(function(){walkLeft=!0}),buttonWalkLeftTop.events.onInputOut.add(function(){walkLeft=!1}),buttonWalkLeftTop.events.onInputDown.add(function(){walkLeft=!0}),buttonWalkLeftTop.events.onInputUp.add(function(){walkLeft=!1}),buttonWalkLeftBottom=game.add.button(20,540,"controlLeftRight",null,this,0,1,0,1),buttonWalkLeftBottom.alpha=0,buttonWalkLeftBottom.setFrames(2,2,2),buttonWalkLeftBottom.events.onInputOver.add(function(){walkLeft=!0}),buttonWalkLeftBottom.events.onInputOut.add(function(){walkLeft=!1}),buttonWalkLeftBottom.events.onInputDown.add(function(){walkLeft=!0}),buttonWalkLeftBottom.events.onInputUp.add(function(){walkLeft=!1}),buttonWalkRight=game.add.button(165,470,"rightControl",null,this,0,1,0,1),buttonWalkRight.alpha=.4,buttonWalkRight.events.onInputOver.add(function(){walkRight=!0}),buttonWalkRight.events.onInputOut.add(function(){walkRight=!1}),buttonWalkRight.events.onInputDown.add(function(){walkRight=!0}),buttonWalkRight.events.onInputUp.add(function(){walkRight=!1}),buttonWalkRightTop=game.add.button(165,430,"controlLeftRight",null,this,0,1,0,1),buttonWalkRightTop.alpha=0,buttonWalkRightTop.setFrames(0,0,0),buttonWalkRightTop.events.onInputOver.add(function(){walkRight=!0}),buttonWalkRightTop.events.onInputOut.add(function(){walkRight=!1}),buttonWalkRightTop.events.onInputDown.add(function(){walkRight=!0}),buttonWalkRightTop.events.onInputUp.add(function(){walkRight=!1}),buttonWalkRightBottom=game.add.button(165,540,"controlLeftRight",null,this,0,1,0,1),buttonWalkRightBottom.alpha=0,buttonWalkRightBottom.setFrames(1,1,1),buttonWalkRightBottom.events.onInputOver.add(function(){walkRight=!0}),buttonWalkRightBottom.events.onInputOut.add(function(){walkRight=!1}),buttonWalkRightBottom.events.onInputDown.add(function(){walkRight=!0}),buttonWalkRightBottom.events.onInputUp.add(function(){walkRight=!1}),buttonWalkUp=game.add.button(95,417,"rightControl",null,this,0,1,0,1),buttonWalkUp.alpha=.4,buttonWalkUp.rotation=-1.57,buttonWalkUp.anchor.setTo(.75,0),buttonWalkUp.events.onInputOver.add(function(){walkUp=!0}),buttonWalkUp.events.onInputOut.add(function(){walkUp=!1}),buttonWalkUp.events.onInputDown.add(function(){walkUp=!0}),buttonWalkUp.events.onInputUp.add(function(){walkUp=!1}),buttonWalkUpLeft=game.add.button(50,400,"controlUpDown",null,this,0,1,0,1),buttonWalkUpLeft.alpha=0,buttonWalkUpLeft.setFrames(3,3,3),buttonWalkUpLeft.events.onInputOver.add(function(){walkUp=!0}),buttonWalkUpLeft.events.onInputOut.add(function(){walkUp=!1}),buttonWalkUpLeft.events.onInputDown.add(function(){walkUp=!0}),buttonWalkUpLeft.events.onInputUp.add(function(){walkUp=!1}),buttonWalkUpRight=game.add.button(165,400,"controlUpDown",null,this,0,1,0,1),buttonWalkUpRight.alpha=0,buttonWalkUpRight.setFrames(2,2,2),buttonWalkUpRight.events.onInputOver.add(function(){walkUp=!0}),buttonWalkUpRight.events.onInputOut.add(function(){walkUp=!1}),buttonWalkUpRight.events.onInputDown.add(function(){walkUp=!0}),buttonWalkUpRight.events.onInputUp.add(function(){walkUp=!1}),buttonWalkDown=game.add.button(95,560,"leftControl",null,this,0,1,0,1),buttonWalkDown.alpha=.4,buttonWalkDown.rotation=-1.57,buttonWalkDown.anchor.setTo(.75,0),buttonWalkDown.events.onInputOver.add(function(){walkDown=!0}),buttonWalkDown.events.onInputOut.add(function(){walkDown=!1}),buttonWalkDown.events.onInputDown.add(function(){walkDown=!0}),buttonWalkDown.events.onInputUp.add(function(){walkDown=!1}),buttonWalkDownLeft=game.add.button(50,540,"controlUpDown",null,this,0,1,0,1),buttonWalkDownLeft.alpha=0,buttonWalkDownLeft.setFrames(1,1,1),buttonWalkDownLeft.events.onInputOver.add(function(){walkDown=!0}),buttonWalkDownLeft.events.onInputOut.add(function(){walkDown=!1}),buttonWalkDownLeft.events.onInputDown.add(function(){walkDown=!0}),buttonWalkDownLeft.events.onInputUp.add(function(){walkDown=!1}),buttonWalkDownRight=game.add.button(165,540,"controlUpDown",null,this,0,1,0,1),buttonWalkDownRight.alpha=0,buttonWalkDownRight.setFrames(0,0,0),buttonWalkDownRight.events.onInputOver.add(function(){walkDown=!0}),buttonWalkDownRight.events.onInputOut.add(function(){walkDown=!1}),buttonWalkDownRight.events.onInputDown.add(function(){walkDown=!0}),buttonWalkDownRight.events.onInputUp.add(function(){walkDown=!1}),buttonFireLeft=game.add.button(587,470,"leftControl",null,this,0,1,0,1),buttonFireLeft.alpha=.4,buttonFireLeft.events.onInputOver.add(function(){fireLeft=!0}),buttonFireLeft.events.onInputOut.add(function(){fireLeft=!1}),buttonFireLeft.events.onInputDown.add(function(){fireLeft=!0}),buttonFireLeft.events.onInputUp.add(function(){fireLeft=!1}),buttonFireLeftTop=game.add.button(587,430,"controlLeftRight",null,this,0,1,0,1),buttonFireLeftTop.alpha=0,buttonFireLeftTop.setFrames(3,3,3),buttonFireLeftTop.events.onInputOver.add(function(){fireLeft=!0}),buttonFireLeftTop.events.onInputOut.add(function(){fireLeft=!1}),buttonFireLeftTop.events.onInputDown.add(function(){fireLeft=!0}),buttonFireLeftTop.events.onInputUp.add(function(){fireLeft=!1}),buttonFireLeftBottom=game.add.button(587,540,"controlLeftRight",null,this,0,1,0,1),buttonFireLeftBottom.alpha=0,buttonFireLeftBottom.setFrames(2,2,2),buttonFireLeftBottom.events.onInputOver.add(function(){fireLeft=!0}),buttonFireLeftBottom.events.onInputOut.add(function(){fireLeft=!1}),buttonFireLeftBottom.events.onInputDown.add(function(){fireLeft=!0}),buttonFireLeftBottom.events.onInputUp.add(function(){fireLeft=!1}),buttonFireRight=game.add.button(732,470,"rightControl",null,this,0,1,0,1),buttonFireRight.alpha=.4,buttonFireRight.events.onInputOver.add(function(){fireRight=!0}),buttonFireRight.events.onInputOut.add(function(){fireRight=!1}),buttonFireRight.events.onInputDown.add(function(){fireRight=!0}),buttonFireRight.events.onInputUp.add(function(){fireRight=!1}),buttonFireRightTop=game.add.button(732,430,"controlLeftRight",null,this,0,1,0,1),buttonFireRightTop.alpha=0,buttonFireRightTop.setFrames(0,0,0),buttonFireRightTop.events.onInputOver.add(function(){fireRight=!0}),buttonFireRightTop.events.onInputOut.add(function(){fireRight=!1}),buttonFireRightTop.events.onInputDown.add(function(){fireRight=!0}),buttonFireRightTop.events.onInputUp.add(function(){fireRight=!1}),buttonFireRightBottom=game.add.button(732,540,"controlLeftRight",null,this,0,1,0,1),buttonFireRightBottom.alpha=0,buttonFireRightBottom.setFrames(1,1,1),buttonFireRightBottom.events.onInputOver.add(function(){fireRight=!0}),buttonFireRightBottom.events.onInputOut.add(function(){fireRight=!1}),buttonFireRightBottom.events.onInputDown.add(function(){fireRight=!0}),buttonFireRightBottom.events.onInputUp.add(function(){fireRight=!1}),buttonFireUp=game.add.button(662,417,"rightControl",null,this,0,1,0,1),buttonFireUp.alpha=.4,buttonFireUp.rotation=-1.57,buttonFireUp.anchor.setTo(.75,0),buttonFireUp.events.onInputOver.add(function(){fireUp=!0}),buttonFireUp.events.onInputOut.add(function(){fireUp=!1}),buttonFireUp.events.onInputDown.add(function(){fireUp=!0}),buttonFireUp.events.onInputUp.add(function(){fireUp=!1}),buttonFireUpLeft=game.add.button(617,400,"controlUpDown",null,this,0,1,0,1),buttonFireUpLeft.alpha=0,buttonFireUpLeft.setFrames(3,3,3),buttonFireUpLeft.events.onInputOver.add(function(){fireUp=!0}),buttonFireUpLeft.events.onInputOut.add(function(){fireUp=!1}),buttonFireUpLeft.events.onInputDown.add(function(){fireUp=!0}),buttonFireUpLeft.events.onInputUp.add(function(){fireUp=!1}),buttonFireUpRight=game.add.button(732,400,"controlUpDown",null,this,0,1,0,1),buttonFireUpRight.alpha=0,buttonFireUpRight.setFrames(2,2,2),buttonFireUpRight.events.onInputOver.add(function(){fireUp=!0}),buttonFireUpRight.events.onInputOut.add(function(){fireUp=!1}),buttonFireUpRight.events.onInputDown.add(function(){fireUp=!0}),buttonFireUpRight.events.onInputUp.add(function(){fireUp=!1}),buttonFireDown=game.add.button(662,560,"leftControl",null,this,0,1,0,1),buttonFireDown.alpha=.4,buttonFireDown.rotation=-1.57,buttonFireDown.anchor.setTo(.75,0),buttonFireDown.events.onInputOver.add(function(){fireDown=!0}),buttonFireDown.events.onInputOut.add(function(){fireDown=!1}),buttonFireDown.events.onInputDown.add(function(){fireDown=!0}),buttonFireDown.events.onInputUp.add(function(){fireDown=!1}),buttonFireDownLeft=game.add.button(617,540,"controlUpDown",null,this,0,1,0,1),buttonFireDownLeft.alpha=0,buttonFireDownLeft.setFrames(1,1,1),buttonFireDownLeft.events.onInputOver.add(function(){fireDown=!0}),buttonFireDownLeft.events.onInputOut.add(function(){fireDown=!1}),buttonFireDownLeft.events.onInputDown.add(function(){fireDown=!0}),buttonFireDownLeft.events.onInputUp.add(function(){fireDown=!1}),buttonFireDownRight=game.add.button(732,540,"controlUpDown",null,this,0,1,0,1),buttonFireDownRight.alpha=0,buttonFireDownRight.setFrames(0,0,0),buttonFireDownRight.events.onInputOver.add(function(){fireDown=!0}),buttonFireDownRight.events.onInputOut.add(function(){fireDown=!1}),buttonFireDownRight.events.onInputDown.add(function(){fireDown=!0}),buttonFireDownRight.events.onInputUp.add(function(){fireDown=!1})),1==beamUnlockShown){beamSprite=game.add.sprite(223,597,"beamIcon"),beamSprite.frame=1;var r={font:"18px courier bolder",fill:"#f99a08",stroke:"black",strokeThickness:1.5};beamText=game.add.text(230,604,"SPACE",r),null!=timerBeam&&timerBeam.running&&(beamText.text=this.formatTime(Math.round(.001*(timerBeamEvent.delay-timerBeam.ms))))}if(1==manaRefillUnlockShown){bottleSprite=game.add.sprite(535,597,"bottle"),bottleSprite.frame=1;var s={font:"24px courier bolder",fill:"#f99a08",stroke:"black",strokeThickness:1.5};bottleText=game.add.text(543,601,"Q",s),null!=timerMana&&timerMana.running&&(bottleText.text=this.formatTime(Math.round(.001*(timerManaEvent.delay-timerMana.ms))))}resultBackground=game.add.sprite(-1e3,150,"scrollStrip"),levelRecordBackground=game.add.sprite(-1e3,370,"scrollStrip"),resultText=game.add.bitmapText(205,160,"font","",24),resultText2=game.add.bitmapText(250,190,"font","",18),resultText3=game.add.bitmapText(125,215,"font","",18),levelRecord=game.add.bitmapText(325,380,"font","",24),levelRecord2=game.add.bitmapText(310,410,"font","",18),levelRecord3=game.add.bitmapText(220,435,"font","",18)},update:function(){game.physics.arcade.collide(player,platforms),game.physics.arcade.collide(baddies,baddies),game.physics.arcade.collide(baddies,flames),game.physics.arcade.collide(flames,flames),game.physics.arcade.collide(skeletons,baddies),70!=stage&&game.physics.arcade.collide(skeletons,flames),game.physics.arcade.collide(skeletons,skeletons),game.physics.arcade.collide(mummies,baddies),game.physics.arcade.collide(mummies,flames),game.physics.arcade.collide(mummies,skeletons),game.physics.arcade.collide(mummies,spiders),game.physics.arcade.collide(mummies,mummies),game.physics.arcade.collide(vampires,baddies),game.physics.arcade.collide(vampires,flames),game.physics.arcade.collide(vampires,skeletons),game.physics.arcade.collide(vampires,spiders),game.physics.arcade.collide(vampires,mummies),game.physics.arcade.collide(vampires,vampires),game.physics.arcade.collide(vampires,decoys),game.physics.arcade.collide(swordZombies,baddies),game.physics.arcade.collide(swordZombies,flames),game.physics.arcade.collide(swordZombies,skeletons),game.physics.arcade.collide(swordZombies,spiders),game.physics.arcade.collide(swordZombies,mummies),game.physics.arcade.collide(swordZombies,vampires),game.physics.arcade.collide(swordZombies,decoys),game.physics.arcade.collide(decoys,baddies),game.physics.arcade.collide(decoys,flames),game.physics.arcade.collide(decoys,skeletons),game.physics.arcade.collide(decoys,spiders),game.physics.arcade.collide(decoys,mummies),game.physics.arcade.collide(decoys,decoys),game.physics.arcade.collide(spiders,baddies),game.physics.arcade.collide(spiders,spiders),game.physics.arcade.collide(spiders,flames),game.physics.arcade.collide(spiders,skeletons),game.physics.arcade.collide(zombieBirds,zombieBirds),game.physics.arcade.overlap(player,stars,this.collectStar,null,this),game.physics.arcade.overlap(door,stars,this.collectStar,null,this),baddieCount<=0&&game.physics.arcade.collide(player,door,this.doorOpen,null,this),game.time.now>invulnerableTimer?(player.alpha=1,game.physics.arcade.overlap(player,baddies,this.badTouch,null,this),game.physics.arcade.overlap(player,swordZombies,this.badTouch,null,this),game.physics.arcade.overlap(player,bossZombies,this.badTouchTwo,null,this),game.physics.arcade.overlap(player,bossZombieBirds,this.badTouchTwo,null,this),game.physics.arcade.overlap(player,bossMummies,this.badTouchTwo,null,this),game.physics.arcade.overlap(player,bossFinals,this.badTouchTwo,null,this),game.physics.arcade.overlap(player,flames,this.badTouch,null,this),game.physics.arcade.overlap(player,flameBullets,this.badTouch,null,this),game.physics.arcade.overlap(player,skeletons,this.badTouchTwo,null,this),game.physics.arcade.overlap(player,mummies,this.badTouchTwo,null,this),game.physics.arcade.overlap(player,iceBeams,this.badTouch,null,this),game.physics.arcade.overlap(player,iceBeams,this.freeze,null,this),game.physics.arcade.overlap(player,waterShots,this.badTouchTwo,null,this),game.physics.arcade.overlap(player,zombieBirds,this.badTouchTwo,null,this),game.physics.arcade.overlap(player,miniZombieBirds,this.badTouchTwo,null,this),game.physics.arcade.overlap(player,spiders,this.badTouch,null,this),game.physics.arcade.overlap(player,treeBeasts,this.badTouchTwo,null,this),game.physics.arcade.overlap(player,evilRoots,this.badTouchTwo,null,this),game.physics.arcade.overlap(player,vampires,this.badTouchTwo,null,this),game.physics.arcade.overlap(player,decoys,this.badTouch,null,this),game.physics.arcade.overlap(player,swampCreatures,this.badTouch,null,this)):player.alpha=.5,game.physics.arcade.collide(bullets,baddies,this.badKill,null,this),game.physics.arcade.collide(bullets,bossZombies,this.bossZombieKill,null,this),game.physics.arcade.collide(bullets,bossZombieBirds,this.bossZombieBirdKill,null,this),game.physics.arcade.collide(bullets,bossMummies,this.bossMummyKill,null,this),game.physics.arcade.collide(bullets,bossFinals,this.bossFinalKill,null,this),game.physics.arcade.collide(bullets,flames,this.flameKill,null,this),game.physics.arcade.collide(bullets,skeletons,this.skeletonKill,null,this),game.physics.arcade.collide(bullets,mummies,this.mummyKill,null,this),game.physics.arcade.collide(bullets,spiders,this.spiderKill,null,this),game.physics.arcade.collide(bullets,evilwizards,this.evilwizardKill,null,this),game.physics.arcade.collide(bullets,swampCreatures,this.swampCreatureKill,null,this),game.physics.arcade.collide(bullets,zombieBirds,this.zombieBirdKill,null,this),game.physics.arcade.collide(bullets,miniZombieBirds,this.miniZombieBirdKill,null,this),game.physics.arcade.collide(bullets,platforms,this.bulletKill,null,this),game.physics.arcade.collide(bullets,treeBeasts,this.treeBeastKill,null,this),game.physics.arcade.collide(bullets,swordZombies,this.swordZombieKill,null,this),game.physics.arcade.collide(bullets,vampires,this.vampireKill,null,this),game.physics.arcade.collide(bullets,decoys,this.decoyKill,null,this),game.physics.arcade.overlap(skeletons,platforms,this.skeletonSmash,null,this),game.physics.arcade.overlap(mummies,platforms,this.mummySmash,null,this),game.physics.arcade.overlap(bossZombies,platforms,this.bossZombieSmash,null,this),game.physics.arcade.overlap(bossZombieBirds,platforms,this.bossZombieBirdSmash,null,this),game.physics.arcade.overlap(bossMummies,platforms,this.bossMummySmash,null,this),game.physics.arcade.overlap(spiders,platforms,this.spiderClimb,null,this),game.physics.arcade.collide(swordZombies,platforms,this.swordZombieSteer,null,this),game.physics.arcade.overlap(platforms,stars,this.moveStar,null,this),game.physics.arcade.overlap(platforms,flames,this.moveFlame,null,this),game.physics.arcade.overlap(platforms,evilwizards,this.moveEvilWizard,null,this),player.body.velocity.x=0,player.body.velocity.y=0,aKey.isDown||1==walkLeft?(player.body.velocity.x=-(runSpeed+runSpeedEndLevelAdjust),player.animations.play("left"),facing="left",manaRegenInterval=manaRegenHolder-manaRegenEndLevelAdjust):dKey.isDown||1==walkRight?(player.body.velocity.x=runSpeed+runSpeedEndLevelAdjust,player.animations.play("right"),facing="right",manaRegenInterval=manaRegenHolder-manaRegenEndLevelAdjust):wKey.isDown||1==walkUp?(player.body.velocity.y=-(runSpeed+runSpeedEndLevelAdjust),player.animations.play("up"),facing="up",manaRegenInterval=manaRegenHolder-manaRegenEndLevelAdjust):sKey.isDown||1==walkDown?(player.body.velocity.y=runSpeed+runSpeedEndLevelAdjust,player.animations.play("down"),facing="down",manaRegenInterval=manaRegenHolder-manaRegenEndLevelAdjust):(player.animations.stop(),manaRegenInterval=.25*(manaRegenHolder-manaRegenEndLevelAdjust)),fireButton.isDown&&1==beamWeapon&&this.beamWeaponActivate(),qKey.isDown&&1==manaRefillAvailable&&this.manaRefillActivate(),(cursors.right.isDown||cursors.left.isDown||cursors.up.isDown||cursors.down.isDown||1==fireLeft||1==fireRight||1==fireUp||1==fireDown)&&game.time.now>bulletTimer&&player.isAlive&&(mana>=manaCost?(this.fire(),mana-=manaCost,manaText.text="MP: "+mana+"/"+maxMana,manaCrop.x=80*(1-mana/maxMana),manaBar.updateCrop()):this.manaWarnHighlightShow()),this.baddieUpdate(),this.spiderUpdate(),this.flameUpdate(),this.skeletonUpdate(),this.mummyUpdate(),this.evilwizardUpdate(),this.zombieBirdUpdate(),(zombieBirdCount>0||stage-100*Math.floor(stage/100)==80)&&this.miniZombieBirdUpdate(),this.swampCreatureUpdate(),this.treeBeastUpdate(),this.evilRootUpdate(),this.bossZombieUpdate(),this.bossZombieBirdUpdate(),this.bossMummyUpdate(),this.bossFinalUpdate(),this.manaRegen(),this.swordZombieUpdate(),this.vampireUpdate(),this.decoyUpdate(),this.beamTimerUpdate(),this.manaRefillTimerUpdate(),game.device.desktop||(walkLeft?(buttonWalkLeftTop.input.priorityID=1,buttonWalkUpLeft.input.priorityID=0,buttonWalkLeftBottom.input.priorityID=1,buttonWalkDownLeft.input.priorityID=0):walkUp?(buttonWalkLeftTop.input.priorityID=0,buttonWalkUpLeft.input.priorityID=1,buttonWalkRightTop.input.priorityID=0,buttonWalkUpRight.input.priorityID=1):walkRight?(buttonWalkRightTop.input.priorityID=1,buttonWalkUpRight.input.priorityID=0,buttonWalkRightBottom.input.priorityID=1,buttonWalkDownRight.input.priorityID=0):walkDown&&(buttonWalkLeftBottom.input.priorityID=0,buttonWalkDownLeft.input.priorityID=1,buttonWalkRightBottom.input.priorityID=0,buttonWalkDownRight.input.priorityID=1),fireLeft?(buttonFireLeftTop.input.priorityID=1,buttonFireUpLeft.input.priorityID=0,buttonFireLeftBottom.input.priorityID=1,buttonFireDownLeft.input.priorityID=0):fireUp?(buttonFireLeftTop.input.priorityID=0,buttonFireUpLeft.input.priorityID=1,buttonFireRightTop.input.priorityID=0,buttonFireUpRight.input.priorityID=1):fireRight?(buttonFireRightTop.input.priorityID=1,buttonFireUpRight.input.priorityID=0,buttonFireRightBottom.input.priorityID=1,buttonFireDownRight.input.priorityID=0):fireDown&&(buttonFireLeftBottom.input.priorityID=0,buttonFireDownLeft.input.priorityID=1,buttonFireRightBottom.input.priorityID=0,buttonFireDownRight.input.priorityID=1))},render:function(){game.debug.text(game.time.fps,800,14,"#00ff00")},baddieCreate:function(a,b,c){if("green"==c){var d=baddies.create(a,b,"baddie");d.health=4*baddieHpAdjuster,d.maxHealth=4*baddieHpAdjuster,d.colour="green"}else if("red"==c){var d=baddies.create(a,b,"zombieRed");d.health=6*baddieHpAdjuster,d.maxHealth=6*baddieHpAdjuster,d.colour="red"}game.physics.arcade.enable(d),d.body.collideWorldBounds=!0,d.healthBarBack=d.addChild(game.add.graphics(0,0)),d.healthBarBack.lineStyle(3,12203264,1),d.healthBarBack.moveTo(0,0),d.healthBarBack.lineTo(20,0),d.healthBar=d.addChild(game.add.graphics(0,0)),d.healthBar.lineStyle(3,16767232,1),d.healthBar.moveTo(0,0),d.healthBar.lineTo(20*(d.health/d.maxHealth),0),d.healthBarBack.visible=!1,d.healthBar.visible=!1,d.animations.add("baddieLeft",[0,1,2],15,!0),d.animations.add("baddieRight",[3,4,5],15,!0)},baddieUpdate:function(){baddies.forEach(function(a){a.body.velocity.x=0,a.body.velocity.y=0,game.physics.arcade.collide(a,platforms),"green"==a.colour?stage<3?game.physics.arcade.moveToObject(a,player,110*baddieSpeedAdjuster):game.physics.arcade.moveToObject(a,player,130*baddieSpeedAdjuster):"red"==a.colour&&game.physics.arcade.moveToObject(a,player,155*baddieSpeedAdjuster),player.body.x<a.body.x?a.animations.play("baddieLeft"):a.animations.play("baddieRight");
})},bossZombieCreate:function(a,b,c){if("green"==c){var d=bossZombies.create(a,b,"bossZombie");d.health=325*baddieHpAdjuster,d.maxHealth=325*baddieHpAdjuster,d.colour="green"}else"red"==c&&(d=bossZombies.create(a,b,"zombieRed"),d.health=400*baddieHpAdjuster,d.maxHealth=400*baddieHpAdjuster,d.colour="red");game.physics.arcade.enable(d),d.body.collideWorldBounds=!0,d.timer=game.time.now,d.interval=3e3,d.damageTimer=0,d.healthBarBack=d.addChild(game.add.graphics(0,0)),d.healthBarBack.lineStyle(3,12203264,1),d.healthBarBack.moveTo(0,0),d.healthBarBack.lineTo(20,0),d.healthBar=d.addChild(game.add.graphics(0,0)),d.healthBar.lineStyle(3,16767232,1),d.healthBar.moveTo(0,0),d.healthBar.lineTo(20*(d.health/d.maxHealth),0),d.healthBarBack.visible=!1,d.healthBar.visible=!1,d.animations.add("bossZombieLeft",[0,1,2],5,!0),d.animations.add("bossZombieRight",[3,4,5],5,!0)},bossZombieUpdate:function(){bossZombies.forEach(function(a){a.body.velocity.x=0,a.body.velocity.y=0,game.physics.arcade.collide(a,platforms),"green"==a.colour?game.physics.arcade.moveToObject(a,player,160*baddieSpeedAdjuster-a.health/baddieHpAdjuster*.1):"red"==a.colour&&game.physics.arcade.moveToObject(a,player,200*baddieSpeedAdjuster-a.health/baddieHpAdjuster*.1),player.body.x<a.body.x?a.animations.play("bossZombieLeft"):a.animations.play("bossZombieRight")})},bossZombieSmash:function(a,b){b.destroy();var c=game.add.audio("woodSmash");c.play();var d=this;game.time.events.add(.6*Phaser.Timer.SECOND,function(){d.rubbleCreate(b.x,b.y)})},rubbleCreate:function(a,b){var c=platforms.create(a,b,"rubble");c.body.setSize(32,16,0,16),c.body.immovable=!0},spiderCreate:function(a,b){var c=spiders.create(a,b,"spider");c.health=11*baddieHpAdjuster,c.maxHealth=11*baddieHpAdjuster,game.physics.arcade.enable(c),c.body.collideWorldBounds=!0,c.collide=!1,c.healthBarBack=c.addChild(game.add.graphics(0,0)),c.healthBarBack.lineStyle(3,12203264,1),c.healthBarBack.moveTo(0,0),c.healthBarBack.lineTo(20,0),c.healthBar=c.addChild(game.add.graphics(0,0)),c.healthBar.lineStyle(3,16767232,1),c.healthBar.moveTo(0,0),c.healthBar.lineTo(20*(c.health/c.maxHealth),0),c.healthBarBack.visible=!1,c.healthBar.visible=!1,c.animations.add("spiderLeft",[6,7,8,9,10,11],10,!0),c.animations.add("spiderRight",[18,19,20,21,22,23],10,!0),c.animations.add("climbUp",[0,1,2,3,4,5],10,!0),c.animations.add("climbDown",[12,13,14,15,16,17],10,!0)},spiderUpdate:function(){spiders.forEach(function(a){a.body.velocity.x=0,a.body.velocity.y=0,a.collide?(game.physics.arcade.moveToObject(a,player,60*baddieSpeedAdjuster-a.health/baddieHpAdjuster),player.y>a.y?a.animations.play("climbDown"):a.animations.play("climbUp")):(game.physics.arcade.moveToObject(a,player,146*baddieSpeedAdjuster-2*a.health/baddieHpAdjuster),player.body.x<a.body.x?a.animations.play("spiderLeft"):a.animations.play("spiderRight"))})},spiderClimb:function(a,b){a.collide=!0,game.time.events.add(.5*Phaser.Timer.SECOND,function(){a.collide=!1})},swordZombieCreate:function(a,b,c){if("green"==c){var d=swordZombies.create(a,b,"swordZombie");d.health=14*baddieHpAdjuster,d.maxHealth=14*baddieHpAdjuster,d.colour="green"}else"red"==c&&(d=swordZombies.create(a,b,"swordZombie"),d.health=23*baddieHpAdjuster,d.maxHealth=23*baddieHpAdjuster,d.colour="red");game.physics.arcade.enable(d),d.body.collideWorldBounds=!0,d.isAlive=!0,d.collide=!1,d.collideTimer=0,d.healthBarBack=d.addChild(game.add.graphics(0,0)),d.healthBarBack.lineStyle(3,12203264,1),d.healthBarBack.moveTo(0,0),d.healthBarBack.lineTo(20,0),d.healthBar=d.addChild(game.add.graphics(0,0)),d.healthBar.lineStyle(3,16767232,1),d.healthBar.moveTo(0,0),d.healthBar.lineTo(20*(d.health/d.maxHealth),0),d.healthBarBack.visible=!1,d.healthBar.visible=!1,d.animations.add("swordZombieLeft",[0,1,2],15,!0),d.animations.add("swordZombieRight",[3,4,5],15,!0),d.animations.add("swordZombieLeftRed",[6,7,8],15,!0),d.animations.add("swordZombieRightRed",[9,10,11],15,!0)},swordZombieUpdate:function(){swordZombies.forEach(function(a){a.body.velocity.x=0,a.body.velocity.y=0,game.physics.arcade.collide(a,platforms),"green"==a.colour?(0==a.collide?game.physics.arcade.moveToObject(a,player,140*baddieSpeedAdjuster):game.physics.arcade.moveToXY(a,832-player.x+a.x,640-player.y+a.y,40),player.body.x<a.body.x?a.animations.play("swordZombieLeft"):a.animations.play("swordZombieRight")):"red"==a.colour&&(0==a.collide?game.physics.arcade.moveToObject(a,player,165*baddieSpeedAdjuster):game.physics.arcade.moveToXY(a,832-player.x+a.x,640-player.y+a.y,40),player.body.x<a.body.x?a.animations.play("swordZombieLeftRed"):a.animations.play("swordZombieRightRed"))})},swordZombieSteer:function(a,b){0==a.collide&&game.time.now>a.collideTimer&&(a.collideTimer=game.time.now+3e3,a.collide=!0,game.time.events.add(.65*Phaser.Timer.SECOND,function(){a.collide=!1}))},skeletonCreate:function(a,b,c){if("grey"==c){var d=skeletons.create(a,b,"skeleton");d.health=18*baddieHpAdjuster,d.maxHealth=18*baddieHpAdjuster,d.colour="grey"}else"red"==c?(d=skeletons.create(a,b,"skeleton"),d.health=28*baddieHpAdjuster,d.maxHealth=28*baddieHpAdjuster,d.colour="red",d.tint=12203264):"redBoss"==c&&(d=skeletons.create(a,b,"skeleton"),d.health=325*baddieHpAdjuster,d.maxHealth=325*baddieHpAdjuster,d.colour="redBoss",d.tint=12203264,d.scale.x=2.5,d.scale.y=2.5,d.bossTimer=0,d.bossDamageTimer=0,d.isAlive=!0);game.physics.arcade.enable(d),d.body.collideWorldBounds=!0,d.collide=!1,d.healthBarBack=d.addChild(game.add.graphics(0,0)),d.healthBarBack.lineStyle(3,12203264,1),d.healthBarBack.moveTo(0,0),d.healthBarBack.lineTo(20,0),d.healthBar=d.addChild(game.add.graphics(0,0)),d.healthBar.lineStyle(3,16767232,1),d.healthBar.moveTo(0,0),d.healthBar.lineTo(20*(d.health/d.maxHealth),0),d.healthBarBack.visible=!1,d.healthBar.visible=!1,d.animations.add("skeletonLeft",[3,4,5],10,!0),d.animations.add("skeletonRight",[6,7,8],10,!0),d.animations.add("stomp",[0,1,2],10,!0),d.animations.add("smash",[9,10],10,!0)},skeletonUpdate:function(){var a=this;skeletons.forEach(function(b){b.body.velocity.x=0,b.body.velocity.y=0,game.physics.arcade.collide(b,platforms),b.collide?(b.animations.stop(),b.animations.play("smash")):Math.abs(player.x-b.x)+Math.abs(player.y-b.y)<275||"redBoss"==b.colour?("grey"==b.colour?game.physics.arcade.moveToObject(b,player,178*baddieSpeedAdjuster-2*b.health/baddieHpAdjuster):"red"==b.colour?game.physics.arcade.moveToObject(b,player,232*baddieSpeedAdjuster-2*b.health/baddieHpAdjuster):"redBoss"==b.colour&&game.physics.arcade.moveToObject(b,player,190*baddieSpeedAdjuster-.1*b.health/baddieHpAdjuster),player.body.x<b.body.x?b.animations.play("skeletonLeft"):b.animations.play("skeletonRight")):b.health<b.maxHealth?("grey"==b.colour?game.physics.arcade.moveToObject(b,player,175*baddieSpeedAdjuster-2*b.health/baddieHpAdjuster):"red"==b.colour&&game.physics.arcade.moveToObject(b,player,223*baddieSpeedAdjuster-2*b.health/baddieHpAdjuster),player.body.x<b.body.x?b.animations.play("skeletonLeft"):b.animations.play("skeletonRight")):b.animations.play("stomp"),"redBoss"==b.colour&&b.bossTimer<game.time.now&&flameCount<3&&b.isAlive&&(a.flameCreate(b.x,b.y),flameCount++,baddieCount+=6,b.bossTimer=game.time.now+2e3)})},skeletonSmash:function(a,b){a.collide=!0,game.time.events.add(.5*Phaser.Timer.SECOND,function(){b.destroy();var c=game.add.audio("woodSmash");c.play(),a.collide=!1})},mummyCreate:function(a,b){if("wasteland"==backgroundScene){var c=mummies.create(a,b,"mummy");c.animations.add("mummyLeft",[9,10,11],10,!0),c.animations.add("mummyRight",[3,4,5],10,!0),c.animations.add("smash",[12,7],10,!0)}else{var c=mummies.create(a,b,"golem");c.animations.add("golemLeft",[9,10,11],10,!0),c.animations.add("golemRight",[6,7,8],10,!0),c.animations.add("smashLeft",[10,12],4,!0),c.animations.add("smashRight",[7,13],4,!0)}c.health=35*baddieHpAdjuster,c.maxHealth=35*baddieHpAdjuster,game.physics.arcade.enable(c),c.body.collideWorldBounds=!0,c.collide=!1,c.healthBarBack=c.addChild(game.add.graphics(0,0)),c.healthBarBack.lineStyle(3,12203264,1),c.healthBarBack.moveTo(0,0),c.healthBarBack.lineTo(20,0),c.healthBar=c.addChild(game.add.graphics(0,0)),c.healthBar.lineStyle(3,16767232,1),c.healthBar.moveTo(0,0),c.healthBar.lineTo(20*(c.health/c.maxHealth),0),c.healthBarBack.visible=!1,c.healthBar.visible=!1},mummyUpdate:function(){mummies.forEach(function(a){a.body.velocity.x=0,a.body.velocity.y=0,game.physics.arcade.collide(a,platforms),a.collide?(a.animations.stop(),"wasteland"==backgroundScene?a.animations.play("smash"):a.x<player.x?a.animations.play("smashRight"):a.animations.play("smashLeft")):(baddieCount/baddieTotal<.75||Math.abs(player.x-a.x)+Math.abs(player.y-a.y)<150?game.physics.arcade.moveToObject(a,player,210*baddieSpeedAdjuster-4*a.health/baddieHpAdjuster):player.y<320?game.physics.arcade.moveToXY(a,player.x,player.y+150,225-4*a.health):game.physics.arcade.moveToXY(a,player.x,player.y-150,225-4*a.health),player.body.x<a.body.x?"wasteland"==backgroundScene?a.animations.play("mummyLeft"):a.animations.play("golemLeft"):"wasteland"==backgroundScene?a.animations.play("mummyRight"):a.animations.play("golemRight"))})},mummySmash:function(a,b){a.collide=!0,game.time.events.add(.5*Phaser.Timer.SECOND,function(){b.destroy();var c=game.add.audio("woodSmash");c.play(),a.collide=!1})},flameCreate:function(a,b){var c=flames.create(a,b,"flame");c.health=15*baddieHpAdjuster,c.maxHealth=15*baddieHpAdjuster,game.physics.arcade.enable(c),c.body.collideWorldBounds=!0,c.body.immovable=!0,c.isAlive=!0,c.timer=10+1200*Math.random(),c.animations.add("flicker",[0,1,2,3,4,5,6,7,8,9,10,11],10,!0),c.healthBarBack=c.addChild(game.add.graphics(0,0)),c.healthBarBack.lineStyle(3,12203264,1),c.healthBarBack.moveTo(0,0),c.healthBarBack.lineTo(20,0),c.healthBar=c.addChild(game.add.graphics(0,0)),c.healthBar.lineStyle(3,16767232,1),c.healthBar.moveTo(0,0),c.healthBar.lineTo(20*(c.health/c.maxHealth),0),c.healthBarBack.visible=!1,c.healthBar.visible=!1},flameUpdate:function(){flames.forEach(function(a){if(a.animations.play("flicker"),game.time.now>a.timer&&a.isAlive){var b=flameBullets.create(a.x,a.y,"flame");b.animations.add("fire",[0],!0),game.physics.arcade.moveToXY(b,player.x,player.y,160),b.lifespan=6900,b.animations.play("fire"),a.timer=game.time.now+flameBulletSpacing,flameShot.play()}})},treeBeastCreate:function(a,b){var c=treeBeasts.create(a,b,"treeBeast");c.health=44*baddieHpAdjuster,c.maxHealth=44*baddieHpAdjuster,c.frame=0,c.shadow=c.addChild(game.add.sprite(17,11,"treeShadow")),c.shadow.alpha=.35,game.physics.arcade.enable(c),c.body.immovable=!0,c.isAlive=!0,c.active=!1,c.animations.add("reveal",[0,1,2],3,!1),c.animations.add("wiggle",[3,4,5,5,4,3],10,!0),c.rootTimer=game.time.now+1e3+5e3*Math.random(),c.healthBarBack=c.addChild(game.add.graphics(0,0)),c.healthBarBack.lineStyle(3,12203264,1),c.healthBarBack.moveTo(0,0),c.healthBarBack.lineTo(20,0),c.healthBar=c.addChild(game.add.graphics(0,0)),c.healthBar.lineStyle(3,16767232,1),c.healthBar.moveTo(0,0),c.healthBar.lineTo(20*(c.health/c.maxHealth),0),c.healthBarBack.visible=!1,c.healthBar.visible=!1},evilRootWarning:function(a,b){var c=game.add.sprite(a,b,"evilRoot");c.animations.add("sprout",[0,0,0,1,2,3],4,!1),c.animations.play("sprout");var d=this;game.time.events.add(1.5*Phaser.Timer.SECOND,function(){c.destroy(),d.evilRootCreate(c.x,c.y)})},treeBeastUpdate:function(){var a=this;treeBeasts.forEach(function(b){if(1==b.active?b.animations.play("wiggle"):(Math.abs(player.x-(b.x+52))+Math.abs(player.y-(b.y+26))<110||b.health<b.maxHealth)&&0==b.active&&(b.animations.play("reveal"),game.time.events.add(1*Phaser.Timer.SECOND,function(){b.animations.stop(),b.active=!0,b.animations.play("wiggle")})),b.isAlive&&b.rootTimer<game.time.now){var c=Math.floor(20*Math.random())-10,d=c+player.x,e=c+player.y;a.evilRootWarning(d,e),b.rootTimer=game.time.now+15e3*Math.random()}})},evilRootCreate:function(a,b){var c=evilRoots.create(a,b,"evilRoot");c.animations.add("wave",[4,3,5,3,4],10,!0),c.animations.add("retreat",[3,2,1,0],4,!1),c.timer=game.time.now+5e3},evilRootUpdate:function(){evilRoots.forEach(function(a){a.timer>game.time.now?a.animations.play("wave"):(a.animations.play("retreat"),game.time.events.add(1*Phaser.Timer.SECOND,function(){a.destroy()}))})},evilwizardCreate:function(a,b){var c=evilwizards.create(a,b,"evilWizard");c.health=37*baddieHpAdjuster,c.maxHealth=37*baddieHpAdjuster,game.physics.arcade.enable(c),c.body.collideWorldBounds=!0,c.timer=game.time.now,c.chargeTimer=game.time.now+1e3,c.shotTimer=game.time.now+3e3,c.sfxTimer=c.shotTimer,c.stopTimer=game.time.now+7e3,c.isAlive=!0,c.healthBarBack=c.addChild(game.add.graphics(0,0)),c.healthBarBack.lineStyle(3,12203264,1),c.healthBarBack.moveTo(0,0),c.healthBarBack.lineTo(20,0),c.healthBar=c.addChild(game.add.graphics(0,0)),c.healthBar.lineStyle(3,16767232,1),c.healthBar.moveTo(0,0),c.healthBar.lineTo(20*(c.health/c.maxHealth),0),c.healthBarBack.visible=!1,c.healthBar.visible=!1},evilwizardUpdate:function(){evilwizards.forEach(function(a){a.body.velocity.x=0,a.body.velocity.y=0,game.physics.arcade.collide(a,platforms);var b=0,c=0;if(b=player.x<400?player.x+100:player.x-100,c=player.y<300?player.y+100:player.y-100,game.time.now>a.timer&&a.isAlive){var d=game.add.audio("teleport");d.play(),a.x=b,a.y=c,a.timer=game.time.now+1e4}if(game.time.now>a.chargeTimer&&a.isAlive){if(4==a.frame)var e=game.add.sprite(16,18,"blueCharge");else e=game.add.sprite(0,18,"blueCharge");e.animations.add("chargeUp",[0,1,2,3,4,4],2,!1),e.animations.play("chargeUp"),a.addChild(e),a.chargeTimer=game.time.now+1e4,game.time.events.add(3*Phaser.Timer.SECOND,function(){a.removeChild(e),e.destroy()})}if(game.time.now>a.sfxTimer&&a.isAlive&&(beamSFX.play(),a.sfxTimer=game.time.now+1e4),game.time.now>a.shotTimer&&a.isAlive){var f=iceBeams.getFirstExists(!1);12==a.frame||4==a.frame?f.reset(a.x+24,a.y+18):f.reset(a.x+8,a.y+36),f.pivot.setTo(.25,.5),f.animations.add("beam",[0,1,2,3],4,!1),game.physics.arcade.moveToXY(f,player.x,player.y,600),f.rotation=game.physics.arcade.moveToXY(f,player.x,player.y,600),f.lifespan=1650,f.animations.play("beam"),a.shotTimer=game.time.now+120,game.time.events.add(4*Phaser.Timer.SECOND,function(){iceBeams.forEach(function(a){a.kill()})})}game.time.now>a.stopTimer&&(a.shotTimer=game.time.now+6e3,a.sfxTimer=a.shotTimer,a.stopTimer=game.time.now+1e4),player.body.x<a.body.x?a.shotTimer<game.time.now+121?a.frame=17:a.frame=10:a.shotTimer<game.time.now+121?a.frame=12:a.frame=4})},swampCreatureCreate:function(a,b){var c=swampCreatures.create(a,b,"swampCreature");c.health=35*baddieHpAdjuster,c.maxHealth=35*baddieHpAdjuster,game.physics.arcade.enable(c),c.body.collideWorldBounds=!0,c.crouchTimer=game.time.now,c.jumpTimer=game.time.now+2e3,c.shotTimer1=game.time.now+5e3,c.shotTimer2=game.time.now+5500,c.shotTimer3=game.time.now+6e3,c.shotTimer4=game.time.now+6500,c.shotTimer5=game.time.now+7e3,c.isAlive=!0,c.body.immovable=!0,c.healthBarBack=c.addChild(game.add.graphics(0,0)),c.healthBarBack.lineStyle(3,12203264,1),c.healthBarBack.moveTo(0,0),c.healthBarBack.lineTo(20,0),c.healthBar=c.addChild(game.add.graphics(0,0)),c.healthBar.lineStyle(3,16767232,1),c.healthBar.moveTo(0,0),c.healthBar.lineTo(20*(c.health/c.maxHealth),0),c.healthBarBack.visible=!1,c.healthBar.visible=!1,c.animations.add("swampCreatureLeft",[9,10,11],10,!0),c.animations.add("swampCreatureRight",[3,4,5],10,!0)},swampCreatureUpdate:function(){swampCreatures.forEach(function(a){if(game.time.now>a.crouchTimer&&a.isAlive&&(a.body.velocity.x=0,a.body.velocity.y=0,a.animations.stop(),a.frame=6,a.crouchTimer=game.time.now+1e4),game.time.now>a.jumpTimer&&a.isAlive&&(a.body.immovable=!1,a.body.velocity.x=0,a.body.velocity.y=0,a.frame=7,game.physics.arcade.moveToXY(a,player.x,player.y,350),a.jumpTimer=game.time.now+1e4),game.time.now>a.shotTimer1&&a.isAlive){a.body.immovable=!0,a.body.velocity.x=0,a.body.velocity.y=0,player.body.x<a.body.x?a.frame=10:a.frame=4;var b=waterShots.getFirstExists(!1);b.reset(a.x+10,a.y+10),b.lifespan=3500,game.physics.arcade.moveToXY(b,player.x+25,player.y+15,300),b.rotation=game.physics.arcade.moveToXY(b,player.x,player.y,300),waterShotSFX.play(),a.shotTimer1=game.time.now+1e4}game.time.now>a.shotTimer2&&a.isAlive&&(a.body.velocity.x=0,a.body.velocity.y=0,b=waterShots.getFirstExists(!1),b.reset(a.x+10,a.y+10),b.lifespan=3500,game.physics.arcade.moveToXY(b,player.x+15,player.y+25,300),b.rotation=game.physics.arcade.moveToXY(b,player.x,player.y,300),waterShotSFX.play(),a.shotTimer2=game.time.now+1e4),game.time.now>a.shotTimer3&&a.isAlive&&(a.body.velocity.x=0,a.body.velocity.y=0,b=waterShots.getFirstExists(!1),b.reset(a.x+10,a.y+10),b.lifespan=3500,game.physics.arcade.moveToXY(b,player.x+5,player.y-15,300),b.rotation=game.physics.arcade.moveToXY(b,player.x,player.y,300),waterShotSFX.play(),a.shotTimer3=game.time.now+1e4),game.time.now>a.shotTimer4&&a.isAlive&&(a.body.velocity.x=0,a.body.velocity.y=0,b=waterShots.getFirstExists(!1),b.reset(a.x+10,a.y+10),b.lifespan=3500,game.physics.arcade.moveToXY(b,player.x-15,player.y-25,300),b.rotation=game.physics.arcade.moveToXY(b,player.x,player.y,300),waterShotSFX.play(),a.shotTimer4=game.time.now+1e4),game.time.now>a.shotTimer5&&a.isAlive&&(a.body.velocity.x=0,a.body.velocity.y=0,b=waterShots.getFirstExists(!1),b.reset(a.x+10,a.y+10),b.lifespan=3500,game.physics.arcade.moveToXY(b,player.x-25,player.y+15,300),b.rotation=game.physics.arcade.moveToXY(b,player.x,player.y,300),waterShotSFX.play(),a.shotTimer5=game.time.now+1e4)})},zombieBirdCreate:function(a,b){var c=zombieBirds.create(a,b,"zombieBird");c.health=13*baddieHpAdjuster,c.maxHealth=13*baddieHpAdjuster,c.scale.x=.4,c.scale.y=.4,game.physics.arcade.enable(c),c.body.collideWorldBounds=!0,c.moveRight=!0,c.moveRightTimer=game.time.now,c.moveLeftTimer=game.time.now+5e3,c.moveUp=!0,c.moveUpTimer=game.time.now,c.moveDownTimer=game.time.now+3e3,c.healthBarBack=c.addChild(game.add.graphics(0,0)),c.healthBarBack.scale.x=2.5,c.healthBarBack.scale.y=2.5,c.healthBarBack.lineStyle(3,12203264,1),c.healthBarBack.moveTo(0,0),c.healthBarBack.lineTo(20,0),c.healthBar=c.addChild(game.add.graphics(0,0)),c.healthBar.scale.x=2.5,c.healthBar.scale.y=2.5,c.healthBar.lineStyle(3,16767232,1),c.healthBar.moveTo(0,0),c.healthBar.lineTo(20*(c.health/c.maxHealth),0),c.healthBarBack.visible=!1,c.healthBar.visible=!1,c.animations.add("zombieBirdLeft",[0,1,2,3],10,!0),c.animations.add("zombieBirdRight",[4,5,6,7],10,!0)},zombieBirdUpdate:function(){zombieBirds.forEach(function(a){a.body.velocity.x=0,a.body.velocity.y=0,game.physics.arcade.collide(a,platforms),game.time.now>a.moveRightTimer&&(a.moveRight=!0,a.moveRightTimer=game.time.now+1e4),game.time.now>a.moveLeftTimer&&(a.moveRight=!1,a.moveLeftTimer=game.time.now+1e4),game.time.now>a.moveUpTimer&&(a.moveUp=!0,a.moveUpTimer=game.time.now+6e3),game.time.now>a.moveDownTimer&&(a.moveUp=!1,a.moveDownTimer=game.time.now+6e3),Math.abs(player.x-a.x)+Math.abs(player.y-a.y)<250?(game.physics.arcade.moveToObject(a,player,146*baddieSpeedAdjuster-2*a.health/baddieHpAdjuster),player.body.x<a.body.x?a.animations.play("zombieBirdLeft"):a.animations.play("zombieBirdRight")):0==a.moveRight?(a.animations.play("zombieBirdLeft"),0==a.moveRight&&(a.body.velocity.x-=50,1==a.moveUp?a.body.velocity.y+=15:a.body.velocity.y-=15)):(a.animations.play("zombieBirdRight"),a.moveRight&&(a.body.velocity.x+=50,1==a.moveUp?a.body.velocity.y+=15:a.body.velocity.y-=15))})},miniZombieBirdCreate:function(a,b){var c=miniZombieBirds.getFirstExists(!1);c.reset(a,b),c.health=10*baddieHpAdjuster,c.maxHealth=10*baddieHpAdjuster,game.physics.arcade.enable(c),c.body.collideWorldBounds=!0,c.healthBarBack=c.addChild(game.add.graphics(0,0)),c.healthBarBack.lineStyle(3,12203264,1),c.healthBarBack.moveTo(0,0),c.healthBarBack.lineTo(20,0),c.healthBar=c.addChild(game.add.graphics(0,0)),c.healthBar.lineStyle(3,16767232,1),c.healthBar.moveTo(0,0),c.healthBar.lineTo(20*(c.health/c.maxHealth),0),c.healthBarBack.visible=!1,c.healthBar.visible=!1,c.animations.add("miniZombieBirdLeft",[0,1,2,3],10,!0),c.animations.add("miniZombieBirdRight",[4,5,6,7],10,!0)},miniZombieBirdUpdate:function(){miniZombieBirds.forEach(function(a){a.body.velocity.x=0,a.body.velocity.y=0,game.physics.arcade.collide(a,platforms),game.physics.arcade.moveToObject(a,player,201*baddieSpeedAdjuster-2*a.health/baddieHpAdjuster),player.body.x<a.body.x?a.animations.play("miniZombieBirdLeft"):a.animations.play("miniZombieBirdRight")})},bossZombieBirdCreate:function(a,b){var c=bossZombieBirds.create(a,b,"zombieBird");c.health=400*baddieHpAdjuster,c.maxHealth=400*baddieHpAdjuster,c.damageTimer=0,c.createMiniTimer=0,c.isAlive=!0,game.physics.arcade.enable(c),c.body.collideWorldBounds=!0,c.healthBarBack=c.addChild(game.add.graphics(0,0)),c.healthBarBack.lineStyle(3,12203264,1),c.healthBarBack.moveTo(0,0),c.healthBarBack.lineTo(20,0),c.healthBar=c.addChild(game.add.graphics(0,0)),c.healthBar.lineStyle(3,16767232,1),c.healthBar.moveTo(0,0),c.healthBar.lineTo(20*(c.health/c.maxHealth),0),c.healthBarBack.visible=!1,c.healthBar.visible=!1,c.animations.add("bossZombieBirdLeft",[0,1,2,3],10,!0),c.animations.add("bossZombieBirdRight",[4,5,6,7],10,!0)},bossZombieBirdUpdate:function(){var a=this;bossZombieBirds.forEach(function(b){b.body.velocity.x=0,b.body.velocity.y=0,game.physics.arcade.collide(b,platforms),game.physics.arcade.moveToObject(b,player,150*baddieSpeedAdjuster-.1*b.health/baddieHpAdjuster),player.body.x<b.body.x?b.animations.play("bossZombieBirdLeft"):b.animations.play("bossZombieBirdRight"),game.time.now>b.createMiniTimer&&b.isAlive&&(a.miniZombieBirdCreate(b.x,b.y),b.createMiniTimer=game.time.now+3e3,baddieCount+=2)})},bossZombieBirdSmash:function(a,b){b.destroy();var c=game.add.audio("woodSmash");c.play();var d=this;game.time.events.add(.6*Phaser.Timer.SECOND,function(){d.rubbleCreate(b.x,b.y)})},bossMummyCreate:function(a,b){var c=bossMummies.create(a,b,"mummy");c.health=750*baddieHpAdjuster,c.maxHealth=750*baddieHpAdjuster,c.scale.x=2,c.scale.y=2,c.damageTimer=0,c.summonTimer=game.time.now+1e3,c.isAlive=!0,game.physics.arcade.enable(c),c.body.collideWorldBounds=!0,c.healthBarBack=c.addChild(game.add.graphics(0,0)),c.healthBarBack.lineStyle(3,12203264,1),c.healthBarBack.moveTo(0,0),c.healthBarBack.lineTo(20,0),c.healthBar=c.addChild(game.add.graphics(0,0)),c.healthBar.lineStyle(3,16767232,1),c.healthBar.moveTo(0,0),c.healthBar.lineTo(20*(c.health/c.maxHealth),0),c.healthBarBack.visible=!1,c.healthBar.visible=!1,c.animations.add("bossMummyLeft",[9,10,11],10,!0),c.animations.add("bossMummyRight",[3,4,5],10,!0),c.animations.add("bossMummySummon",[7,12,12,7,12,12,7,12,12,12,12],22,!0)},bossMummyUpdate:function(){var a=this;bossMummies.forEach(function(b){b.body.velocity.x=0,b.body.velocity.y=0,game.physics.arcade.collide(b,platforms),game.time.now>b.summonTimer&&b.isAlive&&player.isAlive&&(b.summon=!0,a.risenZombieCreate(0,0),a.risenZombieCreate(200,0),a.risenZombieCreate(400,0),a.risenZombieCreate(600,0),a.risenZombieCreate(800,0),a.risenZombieCreate(0,600),a.risenZombieCreate(200,600),a.risenZombieCreate(400,600),a.risenZombieCreate(600,600),a.risenZombieCreate(800,600),b.summonTimer=game.time.now+7500,game.time.events.add(.5*Phaser.Timer.SECOND,function(){b.summon=!1})),0==b.summon?(game.physics.arcade.moveToObject(b,player,185*baddieSpeedAdjuster-.1*b.health/baddieHpAdjuster),player.body.x<b.body.x?b.animations.play("bossMummyLeft"):b.animations.play("bossMummyRight")):b.animations.play("bossMummySummon")})},bossMummySmash:function(a,b){b.destroy();var c=game.add.audio("woodSmash");c.play();var d=this;game.time.events.add(.6*Phaser.Timer.SECOND,function(){d.rubbleCreate(b.x,b.y)})},risenZombieCreate:function(a,b){var c=game.add.sprite(a,b,"zombieRising");c.animations.add("rise",[3,4,5],3,!1),c.animations.play("rise");var d=this;game.time.events.add(1*Phaser.Timer.SECOND,function(){d.zombieRisingSFX(),d.baddieCreate(c.x,c.y,"red"),c.destroy(),baddieCount++})},vampireCreate:function(a,b){var c=vampires.create(a,b,"vampire");c.health=44*baddieHpAdjuster,c.maxHealth=44*baddieHpAdjuster,game.physics.arcade.enable(c),c.body.collideWorldBounds=!0,c.visible=!0,c.healthBarBack=c.addChild(game.add.graphics(0,0)),c.healthBarBack.lineStyle(3,12203264,1),c.healthBarBack.moveTo(0,0),c.healthBarBack.lineTo(20,0),c.healthBar=c.addChild(game.add.graphics(0,0)),c.healthBar.lineStyle(3,16767232,1),c.healthBar.moveTo(0,0),c.healthBar.lineTo(20*(c.health/c.maxHealth),0),c.healthBarBack.visible=!1,c.healthBar.visible=!1,c.animations.add("vampireLeft",[9,10,11],15,!0),c.animations.add("vampireRight",[3,4,5],15,!0)},vampireUpdate:function(){vampires.forEach(function(a){a.body.velocity.x=0,a.body.velocity.y=0,game.physics.arcade.collide(a,platforms),game.physics.arcade.moveToObject(a,player,155*baddieSpeedAdjuster),player.body.x<a.body.x?a.animations.play("vampireLeft"):a.animations.play("vampireRight")})},vampireEvade:function(){var a=this;vampires.forEach(function(b){b.visible=!1;var c=game.add.sprite(b.x,b.y,"smokeAnimation");if(c.animations.add("disperse",[0,1,2,3],16,!0),c.animations.play("disperse"),player.x<600)var d=75*(1+Math.random());else d=-75*(1+Math.random());if(player.y<450)var e=75*(1+Math.random());else e=-75*(1+Math.random());game.time.events.add(.25*Phaser.Timer.SECOND,function(){c.destroy(),c=game.add.sprite(player.x+d,player.y+e,"smokeAnimation"),c.animations.add("disperse",[0,1,2,3],16,!0),c.animations.play("disperse"),a.decoyCreate(c.x+.5*d,c.y-.5*e),a.decoyCreate(c.x-.5*d,c.y+.5*e)}),game.time.events.add(.5*Phaser.Timer.SECOND,function(){c.destroy(),b.visible=!0,b.x=c.x,b.y=c.y})})},decoyCreate:function(a,b){var c=game.add.sprite(a,b,"smokeAnimation");c.animations.add("disperse",[0,1,2,3],16,!0),c.animations.play("disperse"),game.time.events.add(.25*Phaser.Timer.SECOND,function(){c.destroy();var d=decoys.create(a,b,"vampire");game.physics.arcade.enable(d),d.body.collideWorldBounds=!0,d.visible=!0,d.animations.add("decoyLeft",[9,10,11],15,!0),d.animations.add("decoyRight",[3,4,5],15,!0)})},decoyUpdate:function(){decoys.forEach(function(a){a.body.velocity.x=0,a.body.velocity.y=0,game.physics.arcade.collide(a,platforms),game.physics.arcade.moveToObject(a,player,155*baddieSpeedAdjuster),player.body.x<a.body.x?a.animations.play("decoyLeft"):a.animations.play("decoyRight")})},bossFinalCreate:function(a,b){var c=bossFinals.create(a,b,"evilWizard");c.health=999*baddieHpAdjuster,c.maxHealth=999*baddieHpAdjuster,game.physics.arcade.enable(c),c.body.collideWorldBounds=!0,c.timer=game.time.now,c.chargeTimer=game.time.now+1e3,c.shotTimer=game.time.now+3e3,c.sfxTimer=c.shotTimer,c.stopTimer=game.time.now+7e3,c.summonTimer=game.time.now+8e3,c.damageTimer=0,c.summoned=!1,c.isAlive=!0,c.scale.x=2,c.scale.y=2,c.healthBarBack=c.addChild(game.add.graphics(0,0)),c.healthBarBack.lineStyle(3,12203264,1),c.healthBarBack.moveTo(0,0),c.healthBarBack.lineTo(20,0),c.healthBar=c.addChild(game.add.graphics(0,0)),c.healthBar.lineStyle(3,16767232,1),c.healthBar.moveTo(0,0),c.healthBar.lineTo(20*(c.health/c.maxHealth),0),c.healthBarBack.visible=!1,c.healthBar.visible=!1,c.animations.add("bossFinalLeft",[3,4,5],10,!0),c.animations.add("bossFinalRight",[6,7,8],10,!0),c.animations.add("bossFinalSummonLeft",[17,16,18,19],16,!1),c.animations.add("bossFinalSummonRight",[12,13,14,15],16,!1)},bossFinalUpdate:function(){var a=this;bossFinals.forEach(function(b){b.body.velocity.x=0,b.body.velocity.y=0,game.physics.arcade.collide(b,platforms);var c=0,d=0;if(c=player.x<400?player.x+100:player.x-100,d=player.y<300?player.y+100:player.y-100,game.time.now>b.timer&&b.isAlive){var e=game.add.audio("teleport");e.play(),b.x=c,b.y=d,b.timer=game.time.now+1e4}if(game.time.now>b.chargeTimer&&b.isAlive){if(4==b.frame)var f=game.add.sprite(16,18,"blueCharge");else f=game.add.sprite(0,18,"blueCharge");f.animations.add("chargeUp",[0,1,2,3,4,4],2,!1),f.animations.play("chargeUp"),b.addChild(f),b.chargeTimer=game.time.now+1e4,game.time.events.add(3*Phaser.Timer.SECOND,function(){b.removeChild(f),f.destroy()})}if(game.time.now>b.sfxTimer&&b.isAlive&&(beamSFX.play(),b.sfxTimer=game.time.now+1e4),game.time.now>b.shotTimer&&b.isAlive){var g=iceBeams.getFirstExists(!1);12==b.frame||4==b.frame?g.reset(b.x+42,b.y+36):g.reset(b.x+10,b.y+56),g.pivot.setTo(.25,.5),g.animations.add("beam",[0,1,2,3],4,!1),game.physics.arcade.moveToXY(g,player.x,player.y,600),g.rotation=game.physics.arcade.moveToXY(g,player.x,player.y,600),g.lifespan=1650,g.animations.play("beam"),b.shotTimer=game.time.now+120,game.time.events.add(4*Phaser.Timer.SECOND,function(){iceBeams.forEach(function(a){a.kill()})})}game.time.now>b.summonTimer&&b.isAlive&&0==b.summoned&&(player.body.x<b.body.x?b.animations.play("bossFinalSummonLeft"):b.animations.play("bossFinalSummonRight"),b.summoned=!0,game.time.events.add(.25*Phaser.Timer.SECOND,function(){a.bossFinalSummon(),b.summonTimer=game.time.now+9750,b.summoned=!1})),game.time.now>b.stopTimer&&(b.shotTimer=game.time.now+6e3,b.sfxTimer=b.shotTimer,b.stopTimer=game.time.now+1e4),player.body.x<b.body.x&&0==b.summoned?b.shotTimer<game.time.now+121?b.frame=17:b.frame=10:player.body.x>b.body.x&&0==b.summoned&&(b.shotTimer<game.time.now+121?b.frame=12:b.frame=4)})},bossFinalSummon:function(){Math.random()>.66?(this.mummyCreate(400,0),this.skeletonCreate(400,580,"grey"),this.swordZombieCreate(780,300,"green"),baddieCount+=16):Math.random()>.33?(this.baddieCreate(400,0,"red"),this.skeletonCreate(400,580,"red"),this.swordZombieCreate(780,300,"red"),baddieCount+=10):(this.mummyCreate(400,0),this.mummyCreate(400,580),baddieCount+=14)},coinCreate:function(a,b,c){var d;"red"==c?(d=stars.create(a,b,"ChestRed"),d.contents=2):"blue"==c?(d=stars.create(a,b,"ChestBlue"),d.contents=5):"green"==c?(d=stars.create(a,b,"ChestGreen"),d.contents=10):"yellow"==c&&(d=stars.create(a,b,"ChestYellow"),d.contents=25)},collectStar:function(a,b){collectSFX.play();var c=1+5*Math.random(),d=Math.round(b.contents+c*b.contents),e=game.add.sprite(b.x,b.y,"coin");e.animations.add("rotate",[0,1,2,3,4,5,6,7,8,9,10,11],12,!0),e.animations.play("rotate");var f=game.add.bitmapText(e.x+6,e.y+8,"font","",12);f.text=d,f.tint="black",game.time.events.add(1*Phaser.Timer.SECOND,function(){if(e.destroy(),f.destroy(),c>1.24);else if(c<=1.06){var a=game.add.sprite(e.x,e.y,"wand"),b=game.add.bitmapText(a.x-6,a.y+12,"fontBorder","",13);b.text="Weaponsmith +",weaponsmithDropReward+=weaponsmithDRBoost,game.time.events.add(1*Phaser.Timer.SECOND,function(){a.destroy(),b.text=""})}else if(c<=1.12){var d=game.add.sprite(e.x,e.y,"armour"),g=game.add.bitmapText(d.x,d.y+12,"fontBorder","",13);g.text="Armourer +",armourerDropReward+=armourerDRBoost,game.time.events.add(1*Phaser.Timer.SECOND,function(){d.destroy(),g.text=""})}else if(c<=1.18){var h=game.add.sprite(e.x,e.y,"ring"),i=game.add.bitmapText(h.x-2,h.y+12,"fontBorder","",13);i.text="Enchanter +",enchanterDropReward+=enchanterDRBoost,game.time.events.add(1*Phaser.Timer.SECOND,function(){h.destroy(),i.text=""})}else if(c<=1.24){var j=game.add.sprite(e.x,e.y,"buff"),k=game.add.bitmapText(j.x+4,j.y+12,"fontBorder","",13);k.text="Trainer +",trainerDropReward+=trainerDRBoost,game.time.events.add(1*Phaser.Timer.SECOND,function(){j.destroy(),k.text=""})}}),coins+=d,coins>=1e6?coinsText.text=Math.round(coins/1e3)/1e3+"M":coinsText.text=coins,mana++,manaText.text="MP: "+mana+"/"+maxMana,manaCrop.x=80*(1-mana/maxMana),manaBar.updateCrop(),b.destroy()},badTouch:function(){var a=Math.floor((1+stage/32)*baddieDamageAdjuster);if(health>a){health-=a,hpCrop.x=80*(1-health/maxHealth),hpBar.updateCrop();var b=game.add.audio("grunt");b.play(),healthText.text="HP: "+health+"/"+maxHealth,invulnerableTimer=game.time.now+invulnerableSpacing}else this.playerDeath()},badTouchTwo:function(){var a=Math.floor((2+.04*stage)*baddieDamageAdjuster);if(health>a){health-=a,hpCrop.x=80*(1-health/maxHealth),hpBar.updateCrop();var b=game.add.audio("grunt");b.play(),healthText.text="HP: "+health+"/"+maxHealth,invulnerableTimer=game.time.now+invulnerableSpacing,50==stage&&0==bossZombieKilled&&this.badTouch();
}else this.playerDeath()},freeze:function(){game.time.now>freezeTimer&&(runSpeed=2*(runSpeed/3),freezeTimer=game.time.now+4e3,game.time.events.add(3*Phaser.Timer.SECOND,function(){runSpeed*=1.5}))},moveStar:function(a,b){b.y+=50},moveEvilWizard:function(a,b){b.x+=20},fire:function(){var a=bullets.getFirstExists(!1);a.reset(player.x+10,player.y+15),a.animations.add("spin",[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25],13,!0);var b=game.add.emitter(game.world.centerX,game.world.centerY,20);b.makeParticles("bulletParticles",[0,1,2,3]),b.gravity.y=0,b.forEach(function(a){a.body.allowGravity=!1},this),b.start(!1,500,50),a.addChild(b),game.time.events.add(.5*Phaser.Timer.SECOND,function(){b.destroy()}),b.x=0,b.y=0,a.scale.x=.8,a.scale.y=.8,a.lifespan=832/shotSpeed*1e3,cursors.left.isDown||1==fireLeft?(game.physics.arcade.moveToXY(a,0,a.y,shotSpeed),a.animations.play("spin"),a.travel="left",b.minParticleSpeed.set(-shotSpeed,0),b.maxParticleSpeed.set(-shotSpeed,0),b.rotation=3.14,b.x=-14,b.y=-8):cursors.right.isDown||1==fireRight?(game.physics.arcade.moveToXY(a,832,a.y,shotSpeed),a.animations.play("spin"),a.travel="right",b.minParticleSpeed.set(shotSpeed,0),b.maxParticleSpeed.set(shotSpeed,0),b.rotation=3.14,b.x=14,b.y=-8):cursors.up.isDown||1==fireUp?(game.physics.arcade.moveToXY(a,a.x,0,shotSpeed),a.animations.play("spin"),a.travel="up",b.minParticleSpeed.set(0,-shotSpeed),b.maxParticleSpeed.set(0,-shotSpeed),b.rotation=3.14,b.x=-8,b.y=-14):(cursors.down.isDown||1==fireDown)&&(game.physics.arcade.moveToXY(a,a.x,600,shotSpeed),a.animations.play("spin"),a.travel="down",b.minParticleSpeed.set(0,shotSpeed),b.maxParticleSpeed.set(0,shotSpeed),b.rotation=3.14,b.x=-8,b.y=14),pewSound.play(),bulletTimer=game.time.now+bulletSpacing},sizzleSFX:function(){var a=game.add.audio("sizzle");a.play()},skeletonDeathSFX:function(){var a=game.add.audio("skeletonDeath");a.play()},spiderDeathSFX:function(){var a=game.add.audio("spiderDeath");a.play()},mummyDeathSFX:function(){var a=game.add.audio("mummyDeath");a.play()},zombieRisingSFX:function(){var a=game.add.audio("zombieRising");a.play()},maleDeathSFX:function(){var a=game.add.audio("maleDeath");a.play()},birdDeathSFX:function(){var a=game.add.audio("birdDeath");a.play()},woodSmashSFX:function(){var a=game.add.audio("woodSmash");a.play()},smallExplosion:function(a,b){var c=game.add.sprite(a,b,"explosionMini");c.animations.add("explosion",[0,1,2,3],30,!1),c.animations.play("explosion"),shortExplodeSFX.play(),game.time.events.add(.2*Phaser.Timer.SECOND,function(){c.destroy()})},bulletKill:function(a){a.kill()},badKill:function(a,b){if(this.smallExplosion(a.x,a.y),Math.random()>.66&&("left"==a.travel?b.x-=knockback:"right"==a.travel?b.x+=knockback:"up"==a.travel?b.y-=knockback:"down"==a.travel&&(b.y+=knockback)),a.kill(),b.health<=shotPower){if(Math.random()>.85&&"red"==b.colour?this.coinCreate(b.x+5,b.y+5,"blue"):Math.random()>.9?this.coinCreate(b.x+5,b.y+5,"blue"):this.coinCreate(b.x,b.y,"red"),Math.random()>.8){var c=game.add.sprite(b.x,b.y,"zombieRising");c.animations.add("rise",[0,1,2],3,!1),c.animations.play("rise");var d=this;game.time.events.add(1*Phaser.Timer.SECOND,function(){c.destroy(),d.zombieRisingSFX(),d.baddieCreate(b.x,b.y,"green"),baddieCount++})}b.destroy(),zombieDeathSFX.play();var e=game.add.sprite(b.x,b.y,"deathSheet");"red"==b.colour?(xp+=Math.floor(4*baddieXpAdjuster),e.frame=11):(xp+=Math.floor(3*baddieXpAdjuster),e.frame=10),game.time.events.add(1*Phaser.Timer.SECOND,function(){e.destroy()}),this.xpDisplayConvert(),baddieCount--,this.checkLevelUp(),this.checkStageComplete()}else b.health-=shotPower,b.healthBarBack.visible=!0,b.healthBar.visible=!0,b.healthBar.clear(),b.healthBar.lineStyle(3,16767232,1),b.healthBar.moveTo(0,0),b.healthBar.lineTo(20*(b.health/b.maxHealth),0)},bossZombieKill:function(a,b){if(this.smallExplosion(a.x,a.y),Math.random()>.66&&("left"==a.travel?b.x-=.1*knockback:"right"==a.travel?b.x+=.1*knockback:"up"==a.travel?b.y-=.1*knockback:"down"==a.travel&&(b.y+=.1*knockback)),a.kill(),game.time.now>b.damageTimer)if(b.damageTimer=game.time.now>b+400,b.health<=shotPower){this.coinCreate(b.x,b.y,"yellow"),this.coinCreate(b.x+15,b.y-2,"yellow"),this.coinCreate(b.x-15,b.y+2,"yellow");var c=game.add.sprite(b.x-10,b.y+10,"wand");weaponsmithDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){c.destroy()});var d=game.add.sprite(b.x+10,b.y+10,"armour");armourerDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){d.destroy()});var e=game.add.sprite(b.x+10,b.y-10,"ring");enchanterDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){e.destroy()});var f=game.add.sprite(b.x-10,b.y-10,"buff");trainerDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){f.destroy()}),Math.random()>.8&&"red"==b.colour?(this.coinCreate(b.x+5,b.y+5,"yellow"),this.coinCreate(b.x-5,b.y-5,"yellow")):Math.random()>.9&&(this.coinCreate(b.x+5,b.y+5,"green"),this.coinCreate(b.x-5,b.y-5,"green")),Math.random()>.8&&(this.baddieCreate(b.x,b.y,"red"),baddieCount++),b.destroy(),bossZombieKilled=!0,zombieDeathSFX.play();var g=game.add.sprite(b.x,b.y,"deathSheet");"red"==b.colour?(xp+=Math.floor(330*baddieXpAdjuster),g.frame=11):(xp+=Math.floor(220*baddieXpAdjuster),g.frame=10),g.scale.x=2.5,g.scale.y=2.5,game.time.events.add(1*Phaser.Timer.SECOND,function(){g.destroy()}),this.xpDisplayConvert(),baddieCount-=.1*stageMilestone+57,this.checkLevelUp(),this.checkStageComplete()}else b.health-=shotPower,b.timer+b.interval<=game.time.now&&(this.baddieCreate(b.x,b.y,"red"),b.timer=game.time.now,baddieCount++),b.healthBarBack.visible=!0,b.healthBar.visible=!0,b.healthBar.clear(),b.healthBar.lineStyle(3,16767232,1),b.healthBar.moveTo(0,0),b.healthBar.lineTo(20*(b.health/b.maxHealth),0)},bossZombieBirdKill:function(a,b){if(this.smallExplosion(a.x,a.y),Math.random()>.66&&("left"==a.travel?b.x-=.1*knockback:"right"==a.travel?b.x+=.1*knockback:"up"==a.travel?b.y-=.1*knockback:"down"==a.travel&&(b.y+=.1*knockback)),a.kill(),game.time.now>b.damageTimer)if(b.damageTimer=game.time.now>b+400,b.health<=shotPower){this.coinCreate(b.x,b.y,"yellow"),this.coinCreate(b.x+15,b.y-2,"yellow"),this.coinCreate(b.x-15,b.y+2,"yellow"),this.coinCreate(b.x+5,b.y+5,"yellow"),this.coinCreate(b.x-5,b.y-5,"yellow");var c=game.add.sprite(b.x-10,b.y+10,"wand");weaponsmithDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){c.destroy()});var d=game.add.sprite(b.x+10,b.y+10,"armour");armourerDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){d.destroy()});var e=game.add.sprite(b.x+10,b.y-10,"ring");enchanterDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){e.destroy()});var f=game.add.sprite(b.x-10,b.y-10,"buff");trainerDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){f.destroy()}),Math.random()>.5&&(this.coinCreate(b.x+15,b.y+5,"yellow"),this.coinCreate(b.x-5,b.y-15,"yellow")),b.destroy(),b.isAlive=!1,this.birdDeathSFX();var g=game.add.sprite(b.x,b.y,"deathSheet");xp+=Math.floor(450*baddieXpAdjuster),g.frame=12,game.time.events.add(1*Phaser.Timer.SECOND,function(){g.destroy()}),this.xpDisplayConvert(),baddieCount-=.1*stageMilestone+45,this.checkLevelUp(),this.zombieBirdCreate(b.x,b.y),this.zombieBirdCreate(b.x+30,b.y),this.zombieBirdCreate(b.x,b.y+30),this.zombieBirdCreate(b.x+30,b.y+30),this.miniZombieBirdCreate(b.x,b.y),this.miniZombieBirdCreate(b.x+20,b.y),this.miniZombieBirdCreate(b.x+40,b.y),this.miniZombieBirdCreate(b.x,b.y+20),this.miniZombieBirdCreate(b.x+30,b.y+20)}else b.health-=shotPower,b.healthBarBack.visible=!0,b.healthBar.visible=!0,b.healthBar.clear(),b.healthBar.lineStyle(3,16767232,1),b.healthBar.moveTo(0,0),b.healthBar.lineTo(20*(b.health/b.maxHealth),0)},bossMummyKill:function(a,b){if(this.smallExplosion(a.x,a.y),Math.random()>.66&&("left"==a.travel?b.x-=.1*knockback:"right"==a.travel?b.x+=.1*knockback:"up"==a.travel?b.y-=.1*knockback:"down"==a.travel&&(b.y+=.1*knockback)),a.kill(),game.time.now>b.damageTimer)if(b.damageTimer=game.time.now>b+400,b.health<=shotPower){this.coinCreate(b.x,b.y,"yellow"),this.coinCreate(b.x+15,b.y-2,"yellow"),this.coinCreate(b.x-15,b.y+2,"yellow"),this.coinCreate(b.x+5,b.y+5,"yellow"),this.coinCreate(b.x-5,b.y-5,"yellow"),this.coinCreate(b.x-5,b.y,"yellow");var c=game.add.sprite(b.x-10,b.y+10,"wand");weaponsmithDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){c.destroy()});var d=game.add.sprite(b.x+10,b.y+10,"armour");armourerDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){d.destroy()});var e=game.add.sprite(b.x+10,b.y-10,"ring");enchanterDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){e.destroy()});var f=game.add.sprite(b.x-10,b.y-10,"buff");trainerDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){f.destroy()}),Math.random()>.5&&(this.coinCreate(b.x+15,b.y+5,"yellow"),this.coinCreate(b.x-5,b.y-15,"yellow"),this.coinCreate(b.x-15,b.y-15,"yellow")),b.destroy(),b.isAlive=!1,bossMummyKilled=!0,this.mummyDeathSFX();var g=game.add.sprite(b.x,b.y,"deathSheet");xp+=Math.floor(650*baddieXpAdjuster),g.frame=5,g.scale.x=2,g.scale.y=2,game.time.events.add(1*Phaser.Timer.SECOND,function(){g.destroy()}),this.xpDisplayConvert(),baddieCount-=.1*stageMilestone+97,this.checkLevelUp(),this.checkStageComplete()}else b.health-=shotPower,b.healthBarBack.visible=!0,b.healthBar.visible=!0,b.healthBar.clear(),b.healthBar.lineStyle(3,16767232,1),b.healthBar.moveTo(0,0),b.healthBar.lineTo(20*(b.health/b.maxHealth),0)},bossFinalKill:function(a,b){if(this.smallExplosion(a.x,a.y),Math.random()>.66&&("left"==a.travel?b.x-=.1*knockback:"right"==a.travel?b.x+=.1*knockback:"up"==a.travel?b.y-=.1*knockback:"down"==a.travel&&(b.y+=.1*knockback)),a.kill(),game.time.now>b.damageTimer)if(b.damageTimer=game.time.now>b+400,b.health<=shotPower){this.coinCreate(b.x,b.y,"yellow"),this.coinCreate(b.x+15,b.y-2,"yellow"),this.coinCreate(b.x-15,b.y+2,"yellow"),this.coinCreate(b.x+5,b.y+5,"yellow"),this.coinCreate(b.x-5,b.y-5,"yellow"),this.coinCreate(b.x-5,b.y,"yellow"),this.coinCreate(b.x-15,b.y-15,"yellow"),this.coinCreate(b.x-5,b.y-15,"yellow");var c=game.add.sprite(b.x-10,b.y+10,"wand");weaponsmithDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){c.destroy()});var d=game.add.sprite(b.x+10,b.y+10,"armour");armourerDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){d.destroy()});var e=game.add.sprite(b.x+10,b.y-10,"ring");enchanterDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){e.destroy()});var f=game.add.sprite(b.x-10,b.y-10,"buff");trainerDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){f.destroy()}),Math.random()>.5&&(this.coinCreate(b.x+15,b.y+5,"yellow"),this.coinCreate(b.x-5,b.y-15,"yellow"),this.coinCreate(b.x-15,b.y-15,"yellow"),this.coinCreate(b.x-5,b.y+10,"yellow")),b.destroy(),b.isAlive=!1,bossFinalKilled=!0,this.maleDeathSFX();var g=game.add.sprite(b.x,b.y,"deathSheet");xp+=Math.floor(900*baddieXpAdjuster),g.frame=3,g.scale.x=2,g.scale.y=2,game.time.events.add(1*Phaser.Timer.SECOND,function(){g.destroy()}),this.xpDisplayConvert(),baddieCount-=100,this.checkLevelUp(),this.checkStageComplete()}else b.health-=shotPower,b.healthBarBack.visible=!0,b.healthBar.visible=!0,b.healthBar.clear(),b.healthBar.lineStyle(3,16767232,1),b.healthBar.moveTo(0,0),b.healthBar.lineTo(20*(b.health/b.maxHealth),0)},spiderKill:function(a,b){if(this.smallExplosion(a.x,a.y),Math.random()>.66&&("left"==a.travel?b.x-=knockback:"right"==a.travel?b.x+=knockback:"up"==a.travel?b.y-=knockback:"down"==a.travel&&(b.y+=knockback)),a.kill(),b.health<=shotPower){Math.random()>.85?this.coinCreate(b.x+5,b.y+5,"blue"):this.coinCreate(b.x,b.y,"red"),b.kill();var c=game.add.sprite(b.x,b.y,"deathSheet");c.frame=7,game.time.events.add(1*Phaser.Timer.SECOND,function(){c.destroy()}),this.spiderDeathSFX(),xp+=Math.floor(5*baddieXpAdjuster),this.xpDisplayConvert(),baddieCount-=3,this.checkLevelUp(),this.checkStageComplete()}else b.health-=shotPower,b.healthBarBack.visible=!0,b.healthBar.visible=!0,b.healthBar.clear(),b.healthBar.lineStyle(3,16767232,1),b.healthBar.moveTo(0,0),b.healthBar.lineTo(20*(b.health/b.maxHealth),0)},swordZombieKill:function(a,b){if(this.smallExplosion(a.x,a.y),Math.random()>.66&&("left"==a.travel?b.x-=knockback:"right"==a.travel?b.x+=knockback:"up"==a.travel?b.y-=knockback:"down"==a.travel&&(b.y+=knockback)),a.kill(),b.health<=shotPower){Math.random()>.7||"red"==b.colour?this.coinCreate(b.x+5,b.y+5,"blue"):this.coinCreate(b.x,b.y,"red"),b.kill(),b.isAlive=!1;var c=game.add.sprite(b.x,b.y,"deathSheet");"red"==b.colour?(c.frame=16,xp+=Math.floor(9*baddieXpAdjuster)):(c.frame=14,xp+=Math.floor(6*baddieXpAdjuster)),game.time.events.add(1*Phaser.Timer.SECOND,function(){c.destroy()}),zombieDeathSFX.play(),this.xpDisplayConvert(),baddieCount-=4,this.checkLevelUp(),this.checkStageComplete()}else b.health-=shotPower,b.healthBarBack.visible=!0,b.healthBar.visible=!0,b.healthBar.clear(),b.healthBar.lineStyle(3,16767232,1),b.healthBar.moveTo(0,0),b.healthBar.lineTo(20*(b.health/b.maxHealth),0)},skeletonKill:function(a,b){if(this.smallExplosion(a.x,a.y),Math.random()>.66&&("left"==a.travel?b.x-=knockback:"right"==a.travel?b.x+=knockback:"up"==a.travel?b.y-=knockback:"down"==a.travel&&(b.y+=knockback)),a.kill(),"redBoss"!=b.colour||game.time.now>b.bossDamageTimer)if("redBoss"==b.colour&&(b.bossDamageTimer=game.time.now+400),b.health<=shotPower){if(this.coinCreate(b.x,b.y,"blue"),Math.random()>.7&&"grey"==b.colour)this.coinCreate(b.x+5,b.y+5,"red");else if(Math.random()>.6&&"red"==b.colour)this.coinCreate(b.x+5,b.y+5,"blue");else if("redBoss"==b.colour){this.coinCreate(b.x+5,b.y+5,"yellow"),this.coinCreate(b.x-5,b.y-5,"yellow"),this.coinCreate(b.x+15,b.y-2,"yellow"),this.coinCreate(b.x-15,b.y+2,"yellow");var c=game.add.sprite(b.x-10,b.y+10,"wand");weaponsmithDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){c.destroy()});var d=game.add.sprite(b.x+10,b.y+10,"armour");armourerDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){d.destroy()});var e=game.add.sprite(b.x+10,b.y-10,"ring");enchanterDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){e.destroy()});var f=game.add.sprite(b.x-10,b.y-10,"buff");trainerDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){f.destroy()})}b.destroy();var g=game.add.sprite(b.x,b.y,"deathSheet");g.frame=6,game.time.events.add(1*Phaser.Timer.SECOND,function(){g.destroy()}),this.skeletonDeathSFX(),"red"==b.colour?(xp+=Math.floor(8*baddieXpAdjuster),g.tint=12203264):"redBoss"==b.colour?(b.isAlive=!1,xp+=Math.floor(325*baddieXpAdjuster),g.tint=12203264,g.scale.x=2.5,g.scale.y=2.5,bossSkeletonKilled=!0):xp+=Math.floor(6*baddieXpAdjuster),this.xpDisplayConvert(),baddieCount-="redBoss"==b.colour?.1*stageMilestone+77:5,this.checkLevelUp(),this.checkStageComplete()}else b.health-=shotPower,b.healthBarBack.visible=!0,b.healthBar.visible=!0,b.healthBar.clear(),b.healthBar.lineStyle(3,16767232,1),b.healthBar.moveTo(0,0),b.healthBar.lineTo(20*(b.health/b.maxHealth),0)},flameKill:function(a,b){this.smallExplosion(a.x,a.y),a.kill(),b.health<=shotPower?(Math.random()>.65?this.coinCreate(b.x+5,b.y+5,"blue"):this.coinCreate(b.x,b.y,"red"),b.destroy(),b.isAlive=!1,this.sizzleSFX(),xp+=Math.floor(8*baddieXpAdjuster),this.xpDisplayConvert(),baddieCount-=6,this.checkLevelUp(),this.checkStageComplete(),70==stage&&flameCount--):(b.health-=shotPower,b.healthBarBack.visible=!0,b.healthBar.visible=!0,b.healthBar.clear(),b.healthBar.lineStyle(3,16767232,1),b.healthBar.moveTo(0,0),b.healthBar.lineTo(20*(b.health/b.maxHealth),0))},mummyKill:function(a,b){if(this.smallExplosion(a.x,a.y),Math.random()>.75&&("left"==a.travel?b.x-=knockback:"right"==a.travel?b.x+=knockback:"up"==a.travel?b.y-=knockback:"down"==a.travel&&(b.y+=knockback)),a.kill(),b.health<=shotPower){if(Math.random()>.67?this.coinCreate(b.x+5,b.y+5,"green"):this.coinCreate(b.x,b.y,"blue"),b.destroy(),"wasteland"==backgroundScene){var c=game.add.sprite(b.x,b.y,"deathSheet");c.frame=5}else{var c=game.add.sprite(b.x,b.y,"golem");c.frame=14}game.time.events.add(1*Phaser.Timer.SECOND,function(){c.destroy()}),this.mummyDeathSFX(),xp+=Math.floor(9*baddieXpAdjuster),this.xpDisplayConvert(),baddieCount-=7,this.checkLevelUp(),this.checkStageComplete()}else b.health-=shotPower,b.healthBarBack.visible=!0,b.healthBar.visible=!0,b.healthBar.clear(),b.healthBar.lineStyle(3,16767232,1),b.healthBar.moveTo(0,0),b.healthBar.lineTo(20*(b.health/b.maxHealth),0)},zombieBirdKill:function(a,b){if(this.smallExplosion(a.x,a.y),Math.random()>.5&&("left"==a.travel?b.x-=knockback:"right"==a.travel?b.x+=knockback:"up"==a.travel?b.y-=knockback:"down"==a.travel&&(b.y+=knockback)),a.kill(),b.health<=shotPower){this.miniZombieBirdCreate(b.x,b.y+50),this.miniZombieBirdCreate(b.x,b.y-50),player.x<b.x?this.miniZombieBirdCreate(b.x+50,b.y):this.miniZombieBirdCreate(b.x-50,b.y),Math.random()>.7?this.coinCreate(b.x+5,b.y+5,"green"):this.coinCreate(b.x,b.y,"blue"),b.destroy();var c=game.add.sprite(b.x,b.y,"deathSheet");c.frame=12,game.time.events.add(1*Phaser.Timer.SECOND,function(){c.destroy()}),this.birdDeathSFX(),xp+=Math.floor(8*baddieXpAdjuster),this.xpDisplayConvert(),baddieCount-=2,this.checkLevelUp(),this.checkStageComplete()}else b.health-=shotPower,b.healthBarBack.visible=!0,b.healthBar.visible=!0,b.healthBar.clear(),b.healthBar.lineStyle(3,16767232,1),b.healthBar.moveTo(0,0),b.healthBar.lineTo(20*(b.health/b.maxHealth),0)},miniZombieBirdKill:function(a,b){if(this.smallExplosion(a.x,a.y),Math.random()>.4&&("left"==a.travel?b.x-=knockback:"right"==a.travel?b.x+=knockback:"up"==a.travel?b.y-=knockback:"down"==a.travel&&(b.y+=knockback)),a.kill(),b.health<=shotPower){Math.random()>.75?this.coinCreate(b.x+5,b.y+5,"green"):this.coinCreate(b.x,b.y,"blue"),b.kill(),b.healthBar.destroy(),b.healthBarBack.destroy();var c=game.add.sprite(b.x,b.y,"deathSheet");c.frame=4,game.time.events.add(1*Phaser.Timer.SECOND,function(){c.destroy()}),this.birdDeathSFX(),xp+=Math.floor(6*baddieXpAdjuster),this.xpDisplayConvert(),baddieCount-=2,this.checkLevelUp(),this.checkStageComplete()}else b.health-=shotPower,b.healthBarBack.visible=!0,b.healthBar.visible=!0,b.children.length>0&&(b.healthBar.clear(),b.healthBar.lineStyle(3,16767232,1),b.healthBar.moveTo(0,0),b.healthBar.lineTo(20*(b.health/b.maxHealth),0))},swampCreatureKill:function(a,b){if(this.smallExplosion(a.x,a.y),a.kill(),b.health<=shotPower){this.coinCreate(b.x,b.y,"green"),Math.random()>.5&&this.coinCreate(b.x+5,b.y+5,"blue"),b.destroy();var c=game.add.sprite(b.x,b.y,"deathSheet");c.frame=13,game.time.events.add(1*Phaser.Timer.SECOND,function(){c.destroy()});var d=game.add.audio("swampCreatureDeath");d.play(),b.isAlive=!1,xp+=Math.floor(14*baddieXpAdjuster),this.xpDisplayConvert(),baddieCount-=9,this.checkLevelUp(),this.checkStageComplete()}else b.health-=shotPower,b.healthBarBack.visible=!0,b.healthBar.visible=!0,b.healthBar.clear(),b.healthBar.lineStyle(3,16767232,1),b.healthBar.moveTo(0,0),b.healthBar.lineTo(20*(b.health/b.maxHealth),0)},treeBeastKill:function(a,b){this.smallExplosion(a.x,a.y),a.kill(),b.health<=shotPower?(this.coinCreate(b.x,b.y,"green"),Math.random()>.5&&this.coinCreate(b.x+5,b.y+5,"blue"),b.destroy(),b.isAlive=!1,this.woodSmashSFX(),xp+=Math.floor(14*baddieXpAdjuster),this.xpDisplayConvert(),baddieCount-=60==stage&&0==bossTreeBeastKilled?4.8:9,this.checkLevelUp(),this.checkStageComplete()):(b.health-=shotPower,b.healthBarBack.visible=!0,b.healthBar.visible=!0,b.healthBar.clear(),b.healthBar.lineStyle(3,16767232,1),b.healthBar.moveTo(0,0),b.healthBar.lineTo(20*(b.health/b.maxHealth),0))},evilwizardKill:function(a,b){if(this.smallExplosion(a.x,a.y),a.kill(),b.health<=shotPower){this.coinCreate(b.x,b.y,"yellow"),Math.random()>.5&&this.coinCreate(b.x+5,b.y+5,"green"),b.destroy();var c=game.add.sprite(b.x,b.y,"deathSheet");c.frame=3,game.time.events.add(1*Phaser.Timer.SECOND,function(){c.destroy()}),this.maleDeathSFX(),b.isAlive=!1,xp+=Math.floor(19*baddieXpAdjuster),this.xpDisplayConvert(),baddieCount-=10,this.checkLevelUp(),this.checkStageComplete()}else b.health-=shotPower,b.healthBarBack.visible=!0,b.healthBar.visible=!0,b.healthBar.clear(),b.healthBar.lineStyle(3,16767232,1),b.healthBar.moveTo(0,0),b.healthBar.lineTo(20*(b.health/b.maxHealth),0)},vampireKill:function(a,b){if(this.smallExplosion(a.x,a.y),a.kill(),b.visible)if(b.health<=shotPower){this.coinCreate(b.x-5,b.y-5,"green"),this.coinCreate(b.x,b.y,"yellow"),Math.random()>.4&&this.coinCreate(b.x+5,b.y+5,"yellow"),b.destroy();var c=game.add.sprite(b.x,b.y,"deathSheet");c.frame=15,game.time.events.add(1*Phaser.Timer.SECOND,function(){c.destroy()}),this.maleDeathSFX(),b.isAlive=!1,xp+=Math.floor(25*baddieXpAdjuster),this.xpDisplayConvert(),baddieCount-=11,this.checkLevelUp(),this.checkStageComplete()}else b.health-=shotPower,this.vampireEvade(),b.healthBarBack.visible=!0,b.healthBar.visible=!0,b.healthBar.clear(),b.healthBar.lineStyle(3,16767232,1),b.healthBar.moveTo(0,0),b.healthBar.lineTo(20*(b.health/b.maxHealth),0)},decoyKill:function(a,b){b.destroy()},checkStageComplete:function(){var a=!1;baddieCount<=0&&stage%100==0&&0==bossFinalKilled&&0==a?(this.finalBossIntro(),a=!0):baddieCount<=0&&0==doorAvailable&&(player.x<150&&player.y<250?(game.add.sprite(750,70,"doorway"),door=game.add.sprite(750,70,"animateddoor")):(game.add.sprite(5,70,"doorway"),door=game.add.sprite(5,70,"animateddoor")),doorAvailable=!0,manaRegenEndLevelAdjust=250,runSpeedEndLevelAdjust=100,door.animations.add("openDoor",[0,1,2,3],4,!1),game.physics.arcade.enable(door),door.body.immovable=!0,stage-100*Math.floor(stage/100)==60&&(bossTreeBeastKilled=!0),stage-100*Math.floor(stage/100)==80&&(bossZombieBirdKilled=!0),stage%100==0&&(a=!1))},finalBossIntro:function(){beamSFX=game.add.audio("shotSFX");var a=game.add.sprite(750,70,"animateddoor");flameShot=game.add.audio("flameShot");var b,c;game.time.events.add(1*Phaser.Timer.SECOND,function(){b=game.add.sprite(750,115,"flame"),b.scale.x=2,b.scale.y=1.5,b.animations.add("flicker",[0,1,2,3,4,5,6,7,8,9,10,11],10,!0),b.animations.play("flicker"),c=game.add.sprite(785,115,"flame"),c.scale.x=2,c.scale.y=1.5,c.animations.add("flicker",[0,1,2,3,4,5,6,7,8,9,10,11],10,!0),c.animations.play("flicker"),flameShot.play()}),game.time.events.add(3*Phaser.Timer.SECOND,function(){a.kill()});var d=this;game.time.events.add(4*Phaser.Timer.SECOND,function(){b.kill(),c.kill(),d.bossFinalCreate(832-player.x,640-player.y),baddieCount+=100})},doorOpen:function(){door.animations.play("openDoor");var a=game.add.audio("creakylightwoodendoor1");a.play(),manaRegenEndLevelAdjust=0,runSpeedEndLevelAdjust=0,player.kill(),door.destroy(),doorAvailable=!1;var b=this;game.time.events.add(2*Phaser.Timer.SECOND,function(){b.startNextLevel()})},manaRegen:function(){game.time.now>manaRegenTimer&&mana<maxMana&&(mana++,manaRegenTimer=game.time.now+manaRegenInterval,manaText.text="MP: "+mana+"/"+maxMana,manaCrop.x=80*(1-mana/maxMana),manaBar.updateCrop())},questComplete:function(){questEndTime=game.time.now,null!=timerMana&&timerMana.running&&timerMana.stop(),null!=timerBeam&&timerBeam.running&&timerBeam.stop(),kongregate.stats.submit("Player Level",playerLevel),gameMusic.destroy(),game.world.removeAll(),game.state.start("city")},checkLevelUp:function(){for(;xp>=nextLevelXp;){levelUpImage=game.add.sprite(132,15,"levelUp"),levelUpImage.animations.add("flash",[0,1,2],6,!0),levelUpImage.animations.play("flash");var a=game.add.audio("levelUpSound");a.play(),game.time.events.add(1*Phaser.Timer.SECOND,function(){levelUpImage.destroy()}),xp-=nextLevelXp,nextLevelXp+=Math.round(8+.75*playerLevel),maxHealth++,maxMana++,shotPower+=.025,health++,hpCrop.x=80*(1-health/maxHealth),hpBar.updateCrop(),mana=maxMana,manaCrop.x=80*(1-mana/maxMana),manaBar.updateCrop(),playerLevel++,this.xpDisplayConvert(),manaText.text="MP: "+mana+"/"+maxMana,healthText.text="HP: "+health+"/"+maxHealth,playerLevelText.text=playerLevel}},startNextLevel:function(){gameMusic.destroy(),stage%100==0&&(baddieAdjuster+=90,baddieTotal-=baddieAdjuster,baddieDamageAdjuster++,baddieHpAdjuster++,baddieXpAdjuster+=.5,baddieSpeedAdjuster+=.1,bossZombieKilled=!1,bossTreeBeastKilled=!1,bossSkeletonKilled=!1,bossZombieBirdKilled=!1,bossMummyKilled=!1,bossFinalKilled=!1),stage++,starTotal+=.75,baddieTotal++,baddieCount=baddieTotal,baddieCreated=0,chestCreated=0,flameCount=0,evilwizardCount=0,zombieBirdCount=0,swampCreatureCount=0,game.world.removeAll(),array=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130],sceneryCount=0,this.create()},playerDeath:function(){player.kill(),gameMusic.destroy(),this.maleDeathSFX();var a=game.add.sprite(player.x,player.y,"deathSheet");a.frame=0;var b=game.add.audio("teleport");if(game.time.events.add(1*Phaser.Timer.SECOND,function(){a.destroy();var c=game.add.sprite(a.x+5,a.y+5,"playerTeleport");c.animations.add("teleport",[0,1,2,3],8,!1),c.animations.play("teleport"),b.play(),game.time.events.add(.5*Phaser.Timer.SECOND,function(){c.destroy()})}),player.isAlive=!1,healthText.text="HP: 0/"+maxHealth,stage>bestStage){for(;stage>bestStage;)bestStage++,reward+=bestStage;reward*=stage<50?1.1:.15+(500-stage)/500,levelRecordBackground.x=96,levelRecord.text="Congratulations!",levelRecord2.text="New Highest Stage Record!",levelRecord3.text="        You receive "+Math.floor(10*reward)+" XP and "+Math.floor(15*reward)+" Coins!",xp+=Math.floor(10*reward),this.xpDisplayConvert(),this.checkLevelUp(),coins+=Math.floor(15*reward),coins>=1e6?coinsText.text=Math.round(coins/1e3)/1e3+"M":coinsText.text=coins,reward=0}questEndCoins=coins,questTotalCoins=questEndCoins-questStartCoins,resultBackground.x=96,resultText.text=" Your Majesty, it is time to come home!",resultText2.text=" You found "+questTotalCoins+" coins on your quest.";game.add.button(300,250,"blankButton",this.questComplete,this),game.add.bitmapText(340,280,"font","Yes, return home",16);1==first&&(assistant="welcomeBack",first=!1)},beamWeaponActivate:function(){manaCost=1,bulletSpacing/=13.5,shotPower+=.002*shotSpeed,beamWeapon=!1,beamSprite.frame=0;var a=this;game.time.events.add(4*Phaser.Timer.SECOND,function(){manaCost=5,bulletSpacing*=13.5,shotPower-=.002*shotSpeed,a.beamWeaponTimer()})},beamWeaponTimer:function(){timerBeam=game.time.create(),timerBeamEvent=timerBeam.add(5*Phaser.Timer.MINUTE,this.endBeamTimer,this),timerBeam.start(),timerBeam.updateTimer=0},beamTimerUpdate:function(){if(null!=timerBeam&&timerBeam.running&&game.time.now>timerBeam.updateTimer){beamSprite.frame=0;var a={font:"21px courier bolder",fill:"#f99a08",stroke:"black",strokeThickness:1.5};beamText.setStyle(a),beamText.x=234,beamText.y=602,beamText.text=this.formatTime(Math.round(.001*(timerBeamEvent.delay-timerBeam.ms))),timerBeam.updateTimer=game.time.now+1e3}},endBeamTimer:function(){timerBeam.stop(),beamWeapon=!0,beamSprite.frame=1;var a={font:"18px courier bolder",fill:"#f99a08",stroke:"black",strokeThickness:1.5};beamText.setStyle(a),beamText.x=230,beamText.y=604,beamText.text="SPACE",timerBeam.updateTimer=0},manaRefillActivate:function(){mana=maxMana,manaRefillAvailable=!1,bottleSprite.frame=0,bottleText.text="",this.manaRefillTimer()},manaRefillTimer:function(){timerMana=game.time.create(),timerManaEvent=timerMana.add(5*Phaser.Timer.MINUTE,this.endManaRefillTimer,this),timerMana.start(),timerMana.updateTimer=0},manaRefillTimerUpdate:function(){if(null!=timerMana&&timerMana.running&&game.time.now>timerMana.updateTimer){bottleSprite.frame=0,bottleText.x=532,bottleText.y=603;var a={font:"18px courier bolder",fill:"#f99a08",stroke:"black",strokeThickness:1.5};bottleText.setStyle(a),bottleText.text=this.formatTime(Math.round(.001*(timerManaEvent.delay-timerMana.ms))),timerMana.updateTimer=game.time.now+1e3}},endManaRefillTimer:function(){timerMana.stop(),manaRefillAvailable=!0,bottleSprite.frame=1,bottleText.x=543,bottleText.y=601;var a={font:"24px courier bolder",fill:"#f99a08",stroke:"black",strokeThickness:1.5};bottleText.setStyle(a),bottleText.text="Q",timerMana.updateTimer=0},formatTime:function(a){var b="0"+Math.floor(a/60),c="0"+(a-60*b);return b.substr(-2)+":"+c.substr(-2)},treeCreate:function(a,b){var c=platforms.create(a,b,"tree");c.body.setSize(35,20,0,33),c.body.immovable=!0,c.Shadow=c.addChild(game.add.sprite(-18,11,"treeShadow")),c.Shadow.alpha=.35},xpDisplayConvert:function(){xpDisplay=xp>=1e3?Math.round(xp/100)/10+"k":Math.round(xp),nextLevelXpDisplay=nextLevelXp>=1e3?Math.round(nextLevelXp/100)/10+"k":Math.round(nextLevelXp),xpText.text="XP: "+xpDisplay+"/"+nextLevelXpDisplay,xpCrop.x=80*(1-xp/nextLevelXp),xpBar.updateCrop()},manaWarnHighlightShow:function(){if(0==manaWarn){var a=game.add.sprite(0,0,"hudManaWarning");a.scale.setTo(1.1,1.1),manaWarn=!0,a.alpha=.1,game.add.tween(a).to({alpha:1},100,Phaser.Easing.Quadratic.In,!0,0,Number.MAX_VALUE,!0),game.time.events.add(.25*Phaser.Timer.SECOND,function(){a.kill(),manaWarn=!1})}},gofull:function(){game.scale.startFullScreen(!1)}},game=new Phaser.Game(832,640,Phaser.CANVAS,"");game.state.add("boot",bootState),game.state.add("preload",preloadState),game.state.add("menu",menuState),game.state.add("credits",creditsState),game.state.add("intro",introState),game.state.add("play",playState),game.state.add("city",cityState),game.state.add("shop",shopState),game.state.add("tutorial",tutorialState),game.state.add("defence",defenceState),game.state.add("reset",resetState),game.state.start("boot");var canvasElement=document.getElementById("canvasID"),canvasWidth=canvasElement.style.width,username,isGuest;kongregateAPI.loadAPI(function(){window.kongregate=kongregateAPI.getAPI(),isGuest=kongregate.services.isGuest(),username=isGuest?"guest":kongregate.services.getUsername()});